<!DOCTYPE html>
<html lang="en" data-theme="neptune-vibe">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TrackFlow - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        /* NeptuneVibe Theme Variables (Light Mode) */
        :root {
            --bg-primary: linear-gradient(to bottom right, #34495e, #5d7ea6); /* Richer, slightly brighter gradient */
            --bg-secondary: rgba(44, 62, 80, 0.9); /* Darker, slightly transparent for glass effect */
            --text-primary: #E0E0E0; /* Light grey for main text */
            --modal-text: #ffffff;
            --text-secondary: #B0B0B0; /* Medium grey for secondary text */
            --accent-color: #8e44ad; /* Deeper purple accent */
            --accent-color-hover: #9b59b6; /* Lighter purple hover */
            --border-color: rgba(120, 120, 120, 0.4); /* Darker, transparent border */
            --shadow-color: rgba(0, 0, 0, 0.5); /* More prominent shadow */
            --input-bg: rgba(60, 60, 60, 0.7); /* Darker, transparent for inputs */
            
            --nav-bg: linear-gradient(90deg, #2c3e50, #34495e, #3e5770); /* Darker sidebar background */
            --nav-text: var(--text-primary); /* Sidebar text */
            --footer-bg: rgba(30, 40, 50, 0.8); /* Darker footer background */
            --footer-text: var(--text-secondary); /* Footer text */

            --table-header-bg: rgba(70, 80, 90, 0.7); /* Darker table header */
            --table-header-text: var(--text-primary); /* Table header text */
            --table-row-even: rgba(50, 60, 70, 0.8); /* Darker even row */
            --table-row-hover: rgba(65, 75, 85, 0.8); /* Darker row hover */

            /* Status Colors */
            --status-present: #28A745; /* Green */
            --status-absent: #DC3545; /* Red */
            --status-weekend: #6C757D; /* Grey */
            --status-holiday: #FFC107; /* Yellow */
            --status-govt-holiday: #17A2B8; /* Cyan */
            --status-sick-leave: #FD7E14; /* Orange */

            --status-present-bg: rgba(40, 167, 69, 0.2); /* Deeper */
            --status-absent-bg: rgba(220, 53, 69, 0.2); /* Deeper */
            --status-weekend-bg: rgba(108, 117, 125, 0.2); /* Deeper */
            --status-holiday-bg: rgba(255, 193, 7, 0.2); /* Deeper */
            --status-govt-holiday-bg: rgba(23, 162, 184, 0.2); /* Deeper */
            --status-sick-leave-bg: rgba(253, 126, 20, 0.2); /* Deeper */

            /* Chart Colors */
            --chart-color-present: #2ecc71; /* Use accent color for present */
            --chart-color-absent: #e74c3c; /* Red for absent */

            /* Alert/Warning Colors */
            --alert-info: #3498db;
            --alert-success: #27ae60;
            --alert-warning: #f39c12;
            --alert-error: #e74c3c;

            --transition-speed: 0.3s ease-in-out; 
            --border-radius-base: 8px; 
            --border-radius-large: 12px; 

            /* Sidebar specific */
            --sidebar-width-expanded: 220px; 
            --sidebar-width-collapsed: 60px; 
            --notes-sidebar-width: 280px; /* New notes sidebar width */
        }

        /* Dark Theme Variables */
        html[data-theme="dark"] {
            --bg-primary: linear-gradient(to bottom right, #0f172a, #1e293b); /* Truly dark, subtle gradient */
            --bg-secondary: rgba(25, 35, 45, 0.9); /* Darker, slightly transparent for glass effect */
            --text-primary: #F8F8F8; /* Lighter grey for main text */
            --text-secondary: #C0C0C0; /* Medium grey for secondary text */
            --accent-color: #a78bfa; /* Brighter purple accent */
            --accent-color-hover: #c4b5fd; /* Lighter purple hover */
            --border-color: rgba(150, 150, 150, 0.3); /* Lighter, transparent border */
            --shadow-color: rgba(0, 0, 0, 0.6); /* More prominent shadow */
            --input-bg: rgba(40, 50, 60, 0.7); /* Darker, transparent for inputs */
            --modal-text: #F8F8F8; /* White for modal text */
            
            --nav-bg: rgba(15, 23, 42, 0.95); /* Dark sidebar background */
            --nav-text: var(--text-primary);
            --footer-bg: rgba(15, 23, 42, 0.95); /* Dark footer background */
            --footer-text: var(--text-secondary);

            --table-header-bg: rgba(30, 40, 50, 0.7); /* Darker table header */
            --table-header-text: var(--text-primary);
            --table-row-even: rgba(25, 35, 45, 0.8); /* Darker even row */
            --table-row-hover: rgba(35, 45, 55, 0.8); /* Darker row hover */

            /* Status Colors for Dark Theme */
            --status-present: #34d399; /* Green */
            --status-absent: #ef4444; /* Red */
            --status-weekend: #9ca3af; /* Grey */
            --status-holiday: #facc15; /* Yellow */
            --status-govt-holiday: #3b82f6; /* Cyan */
            --status-sick-leave: #f97316; /* Orange */

            --status-present-bg: rgba(52, 211, 153, 0.2); 
            --status-absent-bg: rgba(239, 68, 68, 0.2); 
            --status-weekend-bg: rgba(156, 163, 175, 0.2); 
            --status-holiday-bg: rgba(250, 204, 21, 0.2); 
            --status-govt-holiday-bg: rgba(59, 130, 246, 0.2); 
            --status-sick-leave-bg: rgba(249, 115, 22, 0.2); 

            --chart-color-present: var(--accent-color);
            --chart-color-absent: var(--alert-error);

            /* Frosted glass effect for dark theme */
            .main-header.scrolled,
            .modal-content,
            .notes-list-sidebar { /* Added notes sidebar */
                backdrop-filter: blur(12px) brightness(0.7); /* More blur, slightly darker */
                background-color: rgba(15, 23, 42, 0.7); /* More transparent dark */
            }
            .section-card, .summary-card, .month-selector-card, .chart-container-card,
            #attendanceTable, #historyAttendanceTable, .auth-container,
            .working-days-cola-category-wrapper .summary-card,
            .total-hours-box,
            .dashboard-slideshow-card,
            .note-content-area, .notes-list-sidebar { /* Added new cards and notes sections */
                background-color: rgba(25, 35, 45, 0.8); /* Darker, slightly transparent */
                border: 1px solid rgba(150, 150, 150, 0.3);
            }
            .premium-button.secondary {
                background-color: rgba(50, 60, 70, 0.7);
                border: 1px solid rgba(100, 110, 120, 0.5);
            }
            .premium-button.secondary:hover {
                background-color: rgba(70, 80, 90, 0.5);
            }
        }

        /* Windows 11 Vibe Theme Variables (Premium) */
        html[data-theme="windows-11-vibe"] {
            --bg-primary: linear-gradient(to bottom right, #e0e7ff, #c3dafe); /* Soft blue gradient */
            --bg-secondary: rgba(255, 255, 255, 0.7); /* Frosted white for glass effect */
            --text-primary: #1a202c; /* Dark text */
            --modal-text: #1a202c;
            --text-secondary: #4a5568; /* Medium dark text */
            --accent-color: #6366f1; /* Royal blue accent */
            --accent-color-hover: #818cf8; /* Lighter royal blue hover */
            --border-color: rgba(150, 150, 150, 0.2); /* Light, subtle border */
            --shadow-color: rgba(0, 0, 0, 0.1); /* Soft shadow */
            --input-bg: rgba(255, 255, 255, 0.8); /* Light, transparent for inputs */
            
            --nav-bg: rgba(255, 255, 255, 0.8); /* Light sidebar background */
            --nav-text: var(--text-primary);
            --footer-bg: rgba(255, 255, 255, 0.8); /* Light footer background */
            --footer-text: var(--text-secondary);

            --table-header-bg: rgba(240, 244, 255, 0.8); /* Light table header */
            --table-header-text: var(--text-primary);
            --table-row-even: rgba(247, 250, 252, 0.8); /* Lighter even row */
            --table-row-hover: rgba(237, 242, 247, 0.8); /* Lighter row hover */

            /* Status Colors for Windows 11 Theme */
            --status-present: #10b981; /* Green */
            --status-absent: #ef4444; /* Red */
            --status-weekend: #9ca3af; /* Grey */
            --status-holiday: #facc15; /* Yellow */
            --status-govt-holiday: #3b82f6; /* Blue */
            --status-sick-leave: #f97316; /* Orange */

            --status-present-bg: rgba(16, 185, 129, 0.1); 
            --status-absent-bg: rgba(239, 68, 68, 0.1); 
            --status-weekend-bg: rgba(156, 163, 175, 0.1); 
            --status-holiday-bg: rgba(250, 204, 21, 0.1); 
            --status-govt-holiday-bg: rgba(59, 130, 246, 0.1); 
            --status-sick-leave-bg: rgba(249, 115, 22, 0.1); 

            --chart-color-present: var(--accent-color);
            --chart-color-absent: var(--alert-error);

            /* Frosted glass effect for Windows 11 theme */
            .main-header, .main-header.scrolled,
            .modal-content,
            .notes-list-sidebar {
                backdrop-filter: blur(15px) saturate(180%); /* Stronger blur, more vibrant */
                background-color: rgba(255, 255, 255, 0.7); /* More transparent white */
                border: 1px solid rgba(200, 200, 200, 0.3);
            }
            .section-card, .summary-card, .month-selector-card, .chart-container-card,
            #attendanceTable, #historyAttendanceTable, .auth-container,
            .working-days-cola-category-wrapper .summary-card,
            .total-hours-box,
            .dashboard-slideshow-card,
            .note-content-area, .notes-list-sidebar {
                background-color: rgba(255, 255, 255, 0.8); /* Lighter, slightly transparent */
                border: 1px solid rgba(200, 200, 200, 0.3);
                box-shadow: -5px 0px 0px var(--shadow-color);
            }
            .premium-button.secondary {
                background-color: rgba(240, 244, 255, 0.7);
                border: 1px solid rgba(200, 200, 200, 0.5);
            }
            .premium-button.secondary:hover {
                background-color: rgba(230, 235, 245, 0.5);
            }
            .premium-button {
                box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);
            }
            .premium-button:hover {
                box-shadow: 0 6px 16px rgba(99, 102, 241, 0.3);
            }
            .auth-container h1.premium-heading {
                color: var(--accent-color);
                text-shadow: none;
            }
            .sidebar-menu a:hover,
            .sidebar-menu a.active {
                box-shadow: 0 2px 8px rgba(99, 102, 241, 0.2);
            }
            .sidebar-toggle {
                box-shadow: 0 2px 10px rgba(99, 102, 241, 0.2);
            }
            .total-hours-box::before {
                border: 6px solid var(--accent-color);
            }
            .calendar-date.today {
                border: 3px solid var(--accent-color);
                box-shadow: 0 0 0 2px var(--accent-color), inset 0 1px 3px rgba(0,0,0,0.05);
            }
            .cola-eligibility-status {
                text-shadow: none;
            }
            .dashboard-slideshow-container {
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            }
            .dashboard-slideshow-card h3 {
                text-shadow: none;
            }
            .slideshow-dot.active {
                background-color: var(--accent-color);
            }
            .user-menu-dropdown {
                background-color: var(--bg-secondary);
                border: 1px solid var(--border-color);
                box-shadow: 0 8px 20px var(--shadow-color);
            }
            .user-menu-item:hover {
                background-color: rgba(0, 0, 0, 0.05);
            }
            .user-menu-item .user-info h4 {
                color: var(--text-primary);
            }
            .user-menu-item .user-info p {
                color: var(--text-secondary);
            }
            .notes-list-sidebar .note-item.active {
                background-color: var(--accent-color);
                color: #FFFFFF;
            }
            .notes-list-sidebar .note-item.active h4,
            .notes-list-sidebar .note-item.active p {
                color: #FFFFFF;
            }
            .notes-list-sidebar .note-item:hover {
                background-color: rgba(0, 0, 0, 0.05);
            }
            .note-content-area textarea {
                background-color: var(--input-bg);
                color: var(--text-primary);
                border: 1px solid var(--border-color);
            }
        }

        /* Animated Logo Colors */
        @keyframes colorChangeNewIcon {
            0% { color: var(--accent-color); } 
            25% { color: var(--status-present); } 
            50% { color: var(--status-govt-holiday); } 
            75% { color: var(--status-holiday); } 
            100% { color: var(--accent-color); } 
        }

        .animated-new-icon {
            animation: colorChangeNewIcon 6s infinite ease-in-out;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            line-height: 1.6; /* Increased line height for better readability */
            overflow-x: hidden;
            background: var(--bg-primary); 
            font-size: 0.9rem; /* Slightly larger base font size */
            min-height: 100vh;
            transition: background var(--transition-speed), color var(--transition-speed);
        }

        h1, h2, h3, h4 {
            font-family: 'Inter', sans-serif;
            color: var(--text-primary);
            font-weight: 700; /* Bolder headings */
            transition: color var(--transition-speed);
        }
        h1 { font-size: 2rem; } 
        h2 { font-size: 1.6rem; } 
        h3 { font-size: 1.3rem; } 
        h4 { font-size: 1.1rem; } 

        .premium-button {
            background-color: var(--accent-color);
            color: #FFFFFF; 
            padding: 10px 16px; /* Larger padding */
            border: none;
            border-radius: var(--border-radius-base); 
            font-size: 0.9rem; /* Slightly larger font */
            font-weight: 600; /* Bolder font */
            cursor: pointer;
            transition: all var(--transition-speed); 
            box-shadow: 0 4px 12px var(--shadow-color); /* More prominent shadow */
            letter-spacing: 0.5px; /* Increased letter spacing */
            outline: none;
            text-transform: uppercase; /* Uppercase text */
        }

        .premium-button:hover {
            background-color: var(--accent-color-hover); 
            box-shadow: 0 6px 16px rgba(0,0,0,0.15); 
            transform: translateY(-2px); /* More pronounced lift */
        }

        .premium-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .premium-button.secondary {
            background-color: var(--input-bg); 
            color: var(--accent-color);
            box-shadow: 0 2px 8px var(--shadow-color); 
            border: 1px solid var(--border-color); 
        }

        .premium-button.secondary:hover {
            background-color: var(--border-color); 
            color: var(--accent-color-hover);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .premium-button.delete-button {
            background-color: var(--alert-error); 
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.15); 
        }

        .premium-button.delete-button:hover {
            background-color: #C82333; 
            box-shadow: 0 6px 16px rgba(244, 67, 54, 0.2);
        }

        /* --- Login Page Specific Styles --- */
        .login-page-body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-primary);
            background: var(--bg-primary); 
        }

        .auth-container {
            background-color: var(--bg-secondary);
            padding: 30px; /* Larger padding */
            border-radius: var(--border-radius-large); 
            box-shadow: 0 15px 40px var(--shadow-color); /* More prominent shadow */
            text-align: center;
            width: 90%;
            max-width: 450px; /* Slightly wider for better input display */
            animation: fadeInScale 0.6s ease-out; /* Slower animation */
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            gap: 20px; /* Increased gap */
            backdrop-filter: blur(8px); /* Frosted glass effect */
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: translateY(-30px) scale(0.95); } /* More pronounced initial state */
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .auth-container h1.premium-heading {
            font-size: 2.2rem; /* Larger heading */
            margin-bottom: 8px; 
            color: var(--accent-color);
            text-shadow: 0 2px 4px rgba(0,0,0,0.2); /* Subtle text shadow */
        }

        .auth-container .sub-heading {
            font-size: 1rem; /* Larger sub-heading */
            margin-bottom: 20px; 
            color: var(--text-secondary);
            font-weight: 400;
        }

        .auth-form {
            display: flex;
            flex-direction: column;
            gap: 18px; /* Increased gap */
            animation: slideIn 0.4s ease-out forwards; /* Slower animation */
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); } 
            to { opacity: 1; transform: translateY(0); }
        }

        .input-group {
            text-align: left;
            position: relative;
            margin-bottom: 0; 
        }

        .input-group label {
            display: block;
            margin-bottom: 6px; /* Increased margin */
            font-weight: 600; /* Bolder label */
            color: var(--text-primary);
            font-size: 0.9rem; /* Slightly larger font */
        }

        .input-group input[type="email"],
        .input-group input[type="password"], 
        .input-group input[type="text"],
        .input-group input[type="date"],
        .input-group select,
        .input-group textarea { /* Added textarea */
            width: 100%;
            padding: 12px 15px; /* Larger padding */
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-base); 
            font-size: 1rem; /* Larger font */
            transition: all var(--transition-speed);
            background-color: var(--input-bg); 
            color: var(--text-primary); 
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.1); /* More prominent inset shadow */
            outline: none;
        }
        .input-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .input-group input::placeholder,
        .input-group textarea::placeholder { /* Added textarea */
            color: var(--text-secondary);
            opacity: 0.7; /* Slightly more opaque placeholder */
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus { /* Added textarea */
            border-color: var(--accent-color);
            box-shadow: 0 0 0 4px rgba(142, 68, 173, 0.4); /* More prominent focus shadow */
        }

        .input-group input.error,
        .input-group textarea.error { /* Added textarea */
            border-color: var(--alert-error);
            box-shadow: 0 0 0 4px rgba(231, 76, 60, 0.4);
        }

        .input-group .error-message {
            color: var(--alert-error);
            font-size: 0.8rem; /* Slightly larger error message */
            margin-top: 6px; 
            display: none;
        }

        .input-group input.error + .error-message,
        .input-group textarea.error + .error-message { /* Added textarea */
            display: block;
        }
        .login-note {
            font-size: 0.8rem; /* Slightly larger login note */
            color: var(--text-secondary);
            margin-top: -12px;
            margin-bottom: 8px;
            text-align: left;
        }
        .login-note strong {
            color: var(--text-primary);
        }

        /* --- App Layout --- */
        .app-layout {
            display: flex;
            min-height: 100vh; /* Full viewport height */
            background: var(--bg-primary); 
            margin-top: 60px; /* Space for fixed header */
            flex-direction: column; /* Default to column for mobile first */
        }
        @media (min-width: 1200px) {
            .app-layout {
                flex-direction: row; /* Row layout for larger screens */
            }
        }

        /* --- Fixed Header (New Position) --- */
        .main-header {
            width: 100%;
            background-color: var(--bg-secondary);
            padding: 12px 25px; /* Larger padding */
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px var(--shadow-color); /* More prominent shadow */
            position: fixed; 
            top: 0;
            left: 0;
            z-index: 1000; 
            transition: all var(--transition-speed); /* Smooth transition for all properties */
            border-bottom: 1px solid var(--border-color);
            height: 60px; 
            backdrop-filter: blur(5px); /* Frosted glass effect */
        }
        .main-header.scrolled {
            background-color: rgba(30, 40, 50, 0.98); /* More opaque when scrolled */
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
            backdrop-filter: blur(10px); /* More blur when scrolled */
            transform: translateY(-5px); /* Subtle minimize effect */
            height: 55px; /* Slightly smaller height */
        }
        html[data-theme="windows-11-vibe"] .main-header.scrolled {
            background-color: rgba(255, 255, 255, 0.85);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .main-header .page-title-display {
            font-size: 1.5rem; /* Larger title */
            margin: 0;
            padding: 0;
            border-bottom: none;
            color: var(--text-primary);
            font-weight: 700;
            text-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px; /* Increased gap */
            position: relative; /* For user menu dropdown */
        }

        .header-notification-icon {
            color: var(--text-secondary);
            font-size: 1.1rem; /* Slightly larger icon */
            cursor: pointer;
            transition: color var(--transition-speed), transform 0.2s ease;
        }
        .header-notification-icon:hover {
            color: var(--accent-color);
            transform: scale(1.1);
        }

        .theme-toggle-button {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            border-radius: var(--border-radius-base);
            transition: all var(--transition-speed);
        }
        .theme-toggle-button:hover {
            color: var(--accent-color);
            background-color: rgba(255,255,255,0.05);
        }
        .theme-toggle-button i {
            font-size: 1.1rem;
        }

        /* User Menu Dropdown */
        .user-menu-toggle {
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s ease;
        }
        .user-menu-toggle:hover {
            transform: scale(1.05);
        }
        .user-menu-toggle img {
            width: 36px; /* Larger profile picture */
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-color);
            transition: border-color var(--transition-speed);
        }
        .user-menu-toggle span {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.9rem;
            display: none; /* Hidden by default, shown on larger screens */
        }
        @media (min-width: 768px) {
            .user-menu-toggle span {
                display: inline;
            }
        }

        .user-menu-dropdown {
            position: absolute;
            top: 100%; /* Position below the toggle button */
            right: 0;
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-base);
            box-shadow: 0 8px 20px var(--shadow-color);
            min-width: 280px; /* Wider dropdown */
            max-height: 300px;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: opacity 0.3s ease, transform 0.3s ease, visibility 0.3s ease;
            z-index: 100;
            padding: 10px 0;
            backdrop-filter: blur(8px);
        }
        .user-menu-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .user-menu-item {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            gap: 12px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border-bottom: 1px solid rgba(120, 120, 120, 0.1); /* Subtle separator */
        }
        .user-menu-item:last-child {
            border-bottom: none;
        }
        .user-menu-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        .user-menu-item img {
            width: 40px; /* Larger profile picture in dropdown */
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-color);
        }
        .user-menu-item .user-info {
            text-align: left;
        }
        .user-menu-item .user-info h4 {
            font-size: 0.95rem;
            margin: 0;
            color: var(--text-primary);
        }
        .user-menu-item .user-info p {
            font-size: 0.8rem;
            margin: 0;
            color: var(--text-secondary);
        }


        /* --- Sidebar --- */
        #sidebar {
            width: var(--sidebar-width-expanded);
            background-color: var(--nav-bg);
            box-shadow: 2px 0 10px var(--shadow-color); /* More prominent shadow */
            padding: 20px 0; /* Larger padding */
            display: flex;
            flex-direction: column;
            transition: width var(--transition-speed), background-color var(--transition-speed);
            position: sticky;
            top: 60px; 
            left: 0;
            height: calc(100vh - 60px); 
            overflow-y: auto;
            flex-shrink: 0;
            z-index: 100;
            border-right: 1px solid var(--border-color); /* Subtle border */
        }

        #sidebar.collapsed {
            width: var(--sidebar-width-collapsed);
            padding: 20px 0;
            align-items: center;
        }

        #sidebar .sidebar-header {
            display: flex;
            align-items: center;
            gap: 8px; /* Increased gap */
            padding: 0 20px 15px 20px; /* Larger padding */
            margin-bottom: 20px; /* Increased margin */
            border-bottom: 1px solid var(--border-color);
            transition: padding var(--transition-speed), opacity var(--transition-speed);
        }

        #sidebar.collapsed .sidebar-header {
            padding: 0 0 15px 0;
            justify-content: center;
        }

        #sidebar .sidebar-header .logo-text {
            font-size: 1.4rem; /* Larger font size */
            font-weight: 700;
            color: var(--text-primary);
            transition: opacity var(--transition-speed), transform var(--transition-speed);
        }

        #sidebar.collapsed .sidebar-header .logo-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
            transform: translateX(-20px); /* More pronounced slide */
        }

        #sidebar .sidebar-header .logo-icon {
            width: 32px; /* Larger icon */
            height: 32px;
            fill: currentColor; 
            transition: fill var(--transition-speed), transform 0.3s ease; /* Slower transition */
        }
        #sidebar .sidebar-header .logo-icon:hover {
            transform: rotate(15deg) scale(1.1); /* More pronounced rotation and scale */
        }

        #sidebar .sidebar-menu {
            list-style: none;
            flex-grow: 1; 
        }

        #sidebar .sidebar-menu-item {
            margin-bottom: 8px; /* Increased margin */
        }

        #sidebar .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 12px; /* Increased gap */
            padding: 12px 20px; /* Larger padding */
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem; /* Slightly larger font */
            border-radius: var(--border-radius-base);
            margin: 0 10px; /* Increased margin */
            transition: all var(--transition-speed);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #sidebar .sidebar-menu a:hover,
        #sidebar .sidebar-menu a.active {
            background-color: var(--accent-color);
            color: #FFFFFF;
            box-shadow: 0 2px 8px rgba(142, 68, 173, 0.3); /* More prominent shadow */
            transform: translateY(-2px); /* More pronounced lift */
        }
        #sidebar .sidebar-menu a:hover i,
        #sidebar .sidebar-menu a.active i {
            color: #FFFFFF;
        }

        #sidebar .sidebar-menu a i {
            font-size: 1rem; /* Slightly larger icon */
            color: var(--text-secondary);
            transition: color var(--transition-speed);
            flex-shrink: 0;
        }

        #sidebar.collapsed .sidebar-menu a {
            justify-content: center;
            padding: 12px 0;
            margin: 0 10px;
        }
        #sidebar.collapsed .sidebar-menu a span {
            display: none;
        }
        
        #sidebar .sidebar-footer {
            display: none; /* Removed footer from sidebar */
        }

        #sidebar .sidebar-toggle {
            position: absolute;
            top: 20px; /* Adjusted position */
            right: -15px; /* Adjusted position */
            background-color: var(--accent-color); /* Use accent color */
            color: #FFFFFF;
            border: none;
            width: 32px; /* Larger toggle button */
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); /* More prominent shadow */
            font-size: 0.9rem; 
            transition: all var(--transition-speed);
            z-index: 101; 
        }
        #sidebar.collapsed .sidebar-toggle {
            right: -15px; 
            transform: rotate(180deg);
        }
        #sidebar .sidebar-toggle:hover {
            background-color: var(--accent-color-hover);
            transform: scale(1.05); /* More pronounced scale */
        }
        #sidebar .sidebar-toggle i {
            transition: transform var(--transition-speed);
        }

        /* --- Main Content Area --- */
        .main-content-wrapper {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto; /* Ensure main content can scroll */
        }

        /* Dashboard Profile Section */
        #dashboardProfileSection {
            background-color: var(--bg-secondary);
            padding: 30px; /* Larger padding */
            margin-bottom: 20px; /* Increased margin */
            border-radius: var(--border-radius-large);
            box-shadow: -5px 0px 0px var(--shadow-color);
            border: 1px solid var(--border-color);
            width: 100%;
            max-width: 950px; /* Wider for profile details */
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px; /* Increased gap */
            text-align: center;
            transition: all var(--transition-speed);
            backdrop-filter: blur(5px); /* Frosted glass effect */
        }
        #dashboardProfileSection:hover {
            transform: translateY(-3px); /* More pronounced lift */
            box-shadow: 0px 0px 10px var(--shadow-color);
        }
        #dashboardProfileSection .user-photo {
            width: 210px; /* Larger photo */
            height: 210px;
            border-radius: 30%;
            object-fit: cover;
            border: 4px solid var(--accent-color); /* Thicker border */
            transition: border-color var(--transition-speed), transform 0.3s ease;
        }
        #dashboardProfileSection .user-photo:hover {
            transform: scale(1.03);
        }
        #dashboardProfileSection .user-details h2 {
            font-size: 2rem; /* Larger font size */
            margin-bottom: 8px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        #dashboardProfileSection .user-details p {
            font-size: 1.1rem; /* Larger font size */
            color: var(--text-secondary);
            margin-bottom: 20px;
        }
        #dashboardProfileSection .profile-details-grid {
            box-shadow: 0px 0px 19px var(--shadow-color);
            padding: 5px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); /* Wider columns */
            gap: 15px; /* Increased gap */
            width: 100%;
            max-width: 700px;
            text-align: left;
        }
        #dashboardProfileSection .detail-item {
            font-size: 1rem; /* Larger font size */
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 10px; /* Increased gap */
            padding: 8px 0;
            background-color: var(--input-bg); /* Subtle background for each item */
            border-radius: var(--border-radius-base);
            padding-left: 15px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        #dashboardProfileSection .detail-item strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        #dashboardProfileSection .detail-item i {
            font-size: 1.1rem; /* Larger icon */
            color: var(--accent-color);
        }

        /* New Dashboard Cards Layout (Full Width Rows) */
        .working-days-cola-category-wrapper {
            display: flex;
            flex-direction: row; 
            gap: 20px; /* Increased gap */
            width: 100%; 
            max-width: 950px; /* Match profile section width */
            margin-bottom: 20px; /* Added margin-bottom */
        }
        .working-days-cola-category-wrapper .summary-card {
            width: 100%; 
            max-width: none; 
            text-align: left;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: auto; 
            padding: 20px 25px; /* Larger padding */
            border-radius: var(--border-radius-large);
            box-shadow: 0 4px 15px var(--shadow-color);
            border: 1px solid var(--border-color);
            transition: all var(--transition-speed);
            backdrop-filter: blur(5px);
        }
        .working-days-cola-category-wrapper .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: -3px 3px 1px var(--border-color);
        }
        .working-days-cola-category-wrapper .summary-card h4 {
            font-size: 1rem; /* Larger font size */
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
        }
        .working-days-cola-category-wrapper .summary-card .value {
            font-size: 1.8rem; /* Larger value font size */
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 15px;
            text-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .working-days-cola-category-wrapper .summary-card .details-button {
            display: none; /* Removed details button */
        }

        /* Dashboard Slideshow */
        .dashboard-slideshow-container {
            width: 100%;
            max-width: 950px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
            border-radius: var(--border-radius-large);
            box-shadow: 0 8px 25px var(--shadow-color);
            border: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
            backdrop-filter: blur(8px);
            min-height: 500px; /* Ensure minimum height */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .dashboard-slideshow-card {
            width: 100%;
            padding: 30px;
            text-align: center;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 0.8s ease-in-out, transform 0.8s ease-in-out;
            transform: translateX(100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .dashboard-slideshow-card.active {
            opacity: 1;
            transform: translateX(0);
        }

        .dashboard-slideshow-card.prev {
            transform: translateX(-100%);
        }

        .dashboard-slideshow-card h3 {
            font-size: 1.8rem;
            color: var(--accent-color);
            margin-bottom: 15px;
            text-shadow: 0 1px 4px rgba(0,0,0,0.1);
        }

        .dashboard-slideshow-card p {
            font-size: 1rem;
            color: var(--text-primary);
            margin-bottom: 10px;
            line-height: 1.8;
        }

        .dashboard-slideshow-card strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .dashboard-slideshow-card ul {
            list-style-type: none;
            padding: 0;
            margin-top: 15px;
            text-align: left;
            width: 100%;
            max-width: 400px;
        }

        .dashboard-slideshow-card ul li {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .dashboard-slideshow-card ul li i {
            color: var(--accent-color);
            font-size: 1.1rem;
        }

        .slideshow-nav-dots {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .slideshow-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.4);
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        .slideshow-dot.active {
            background-color: var(--accent-color);
            transform: scale(1.2);
        }

        /* Attendance Page Layout */
        #attendancePageSection {
            flex-grow: 1;
            padding: 20px 25px; /* Larger padding */
            background: var(--bg-primary); 
            transition: background var(--transition-speed);
            display: none; 
            flex-direction: column;
            align-items: center;
            gap: 25px; /* Increased spacing between sections */
        }
        #attendancePageSection .top-row-cards {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            justify-content: center; /* Center items */
            gap: 20px; /* Spacing between cards */

        }
        #attendancePageSection .month-selector-card,
        #attendancePageSection .chart-container-card,
        #attendancePageSection .calendar-card,
        #attendancePageSection .total-hours-box {
            flex: 1; /* Allow cards to grow and shrink */
            min-width: 220px; /* Minimum width for cards */
            max-width: 100%; /* Ensure they don't exceed container */
            padding: 20px;
            box-shadow: 0 4px 15px var(--shadow-color);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-large);
            background-color: var(--bg-secondary);
            backdrop-filter: blur(5px);
            transition: all var(--transition-speed);
        }
        #attendancePageSection .month-selector-card:hover,
        #attendancePageSection .chart-container-card:hover,
        #attendancePageSection .calendar-card:hover,
        #attendancePageSection .total-hours-box:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0,0,0,0.1);
        }

        #attendancePageSection .month-selector-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center content vertically */
        }
        #attendancePageSection .month-selector-card h4 {
            margin-bottom: 15px;
            font-size: 1.2rem;
            color: var(--accent-color);
        }
        #attendancePageSection .month-selector-card select {
            width: 90%;
            max-width: 250px; /* Adjusted max-width */
            margin-bottom: 15px;
            padding: 10px 12px;
            border-radius: var(--border-radius-base);
            background-color: var(--input-bg);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            font-size: 0.95rem;
            transition: all var(--transition-speed);
        }
        #attendancePageSection .month-selector-card select:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.3);
        }
        .date-range-display p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        .date-range-display strong {
            color: var(--text-primary);
        }

        #attendancePageSection .chart-container-card {
            height: 100%; 
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chart-percentage-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--accent-color);
            pointer-events: none; /* Allow clicks to pass through to chart */
            text-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Total Hours Box */
        .total-hours-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 250px; /* Fixed size for circular design */
            text-align: center;
            position: relative;
            overflow: hidden;
            margin: 0; /* Removed auto margin for row layout */
            flex-shrink: 0; /* Prevent shrinking in flex row */
        }
        /*.total-hours-box::before {*/
        /*    content: '';*/
        /*    position: absolute;*/
        /*    top: 110px; */
        /*    left: 15px;*/
        /*    right: 15px;*/
        /*    bottom: 15px;*/
        /*    border: 6px solid var(--accent-color);*/
        /*    border-radius: 50%;*/
        /*    opacity: 0.2; */
        /*    height: 200px;*/
        /*    transition: border-color var(--transition-speed);*/
        /*}*/
        .total-hours-box .value {
            font-size: 3.5rem; /* Larger font size */
            font-weight: 700;
            color: var(--accent-color);
            z-index: 1;
            text-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .total-hours-box h4 {
            font-size: 1.2rem; /* Larger font size */
            color: var(--text-primary);
            margin-top: 12px;
            z-index: 1;
        }


        /* Monthly Summary (5+5 boxes) */
        .monthly-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* 5 cards per row, slightly larger min-width */
            gap: 15px; /* Increased gap */
            width: 100%;
            max-width: 950px;
            margin-top: 25px;
        }
        .monthly-summary-grid .summary-card {
            background-color: var(--bg-secondary);
            padding: 20px; /* Larger padding */
            border-radius: var(--border-radius-large);
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            text-align: center;
            transition: all var(--transition-speed);
            backdrop-filter: blur(5px);
        }
        .monthly-summary-grid .summary-card:hover {
            transform: translateY(-3px); /* More pronounced lift */
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        .monthly-summary-grid .summary-card h4 {
            font-size: 0.95rem; /* Slightly larger font */
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 600;
        }
        .monthly-summary-grid .summary-card .value {
            font-size: 1.5rem; /* Larger value font size */
            font-weight: 700;
            color: var(--text-primary);
            text-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }


        /* Calendar Styles */
        .calendar-card {
            padding: 20px; /* Larger padding */
            border-radius: var(--border-radius-large);
            box-shadow: 0 4px 15px var(--shadow-color);
            border: 1px solid var(--border-color);
            transition: all var(--transition-speed);
            backdrop-filter: blur(5px);
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px; /* Increased margin */
        }
        .calendar-header button {
            background: none;
            border: none;
            font-size: 1.2rem; /* Larger icon */
            color: var(--accent-color);
            cursor: pointer;
            padding: 8px; /* Larger padding */
            border-radius: var(--border-radius-base);
            transition: background-color var(--transition-speed), transform 0.2s ease;
        }
        .calendar-header button:hover {
            background-color: var(--border-color);
            transform: scale(1.1);
        }
        .calendar-header h3 {
            font-size: 1.4rem; /* Larger font size */
            margin: 0;
            color: var(--text-primary);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px; /* Increased gap */
            text-align: center;
        }
        .calendar-day-name {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem; /* Slightly larger font */
        }
        .calendar-date {
            padding: 10px 8px; /* Larger padding */
            border-radius: var(--border-radius-base);
            font-size: 0.9rem; /* Slightly larger font */
            font-weight: 500;
            color: var(--text-primary);
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.15s ease-out; /* Slower transition */
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        .calendar-date:hover {
            transform: scale(1.07); /* More pronounced scale */
            background-color: rgba(255,255,255,0.08);
        }
        .calendar-date.empty {
            visibility: hidden;
        }
        .calendar-date.current-month {
            background-color: var(--input-bg);
        }
        .calendar-date.today {
            border: 3px solid var(--accent-color); /* Thicker border */
            font-weight: 700;
            box-shadow: 0 0 0 2px var(--accent-color), inset 0 1px 3px rgba(0,0,0,0.05);
        }
        /* Calendar Status Colors */
        .calendar-date.status-present { background-color: var(--status-present-bg); border: 1px solid var(--status-present); }
        .calendar-date.status-absent { background-color: var(--status-absent-bg); border: 1px solid var(--status-absent); }
        .calendar-date.status-weekend { background-color: var(--status-weekend-bg); border: 1px solid var(--status-weekend); }
        .calendar-date.status-holiday { background-color: var(--status-holiday-bg); border: 1px solid var(--status-holiday); }
        .calendar-date.status-government_holiday { background-color: var(--status-govt-holiday-bg); border: 1px solid var(--status-govt-holiday); }
        .calendar-date.status-sick_leave { background-color: var(--status-sick-leave-bg); border: 1px solid var(--status-sick-leave); }


        /* Scrolling Content Area */
        .dashboard-scrolling-content {
            flex-grow: 1;
            padding: 20px 25px; 
            background: var(--bg-primary); 
            min-height: calc(100vh - 60px); 
            transition: background var(--transition-speed);
            overflow-y: auto; 
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 25px; /* Increased gap */
        }
        @media (max-width: 768px) {
            .dashboard-scrolling-content {
                padding: 15px;
            }
        }
        
        .section-card {
            background-color: var(--bg-secondary);
            padding: 25px; /* Larger padding */
            border-radius: var(--border-radius-large);
            box-shadow: 0 6px 20px var(--shadow-color); 
            border: 1px solid var(--border-color);
            transition: all var(--transition-speed);
            width: 100%;
            max-width: 1100px; /* Consistent width */
            backdrop-filter: blur(5px);
        }
        .section-card:hover {
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .section-card h2 {
            font-size: 1.4rem; /* Larger font size */
            margin-bottom: 12px; 
            padding-bottom: 8px; 
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary); 
            text-align: left; 
            text-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* --- Saved Entries Table --- */
        .table-responsive {
            overflow-x: auto;
        }

        #attendanceTable, #historyAttendanceTable {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 15px; /* Increased margin */
            background-color: var(--bg-secondary); 
            box-shadow: 0 4px 15px var(--shadow-color); 
            border-radius: var(--border-radius-large);
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all var(--transition-speed);
            backdrop-filter: blur(5px);
        }

        #attendanceTable thead, #historyAttendanceTable thead {
            background-color: var(--table-header-bg); 
            color: var(--table-header-text);
            transition: all var(--transition-speed);
        }

        #attendanceTable th,
        #attendanceTable td,
        #historyAttendanceTable th,
        #historyAttendanceTable td {
            padding: 10px 12px; /* Larger padding */
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-primary); 
            transition: all var(--transition-speed);
            font-size: 0.8rem; /* Slightly larger font */
        }

        #attendanceTable th, #historyAttendanceTable th {
            font-weight: 700; /* Bolder font */
            text-transform: uppercase;
            font-size: 0.85rem; /* Slightly larger font */
            letter-spacing: 0.5px; /* Increased letter spacing */
        }

        #attendanceTable tbody tr:nth-child(even), #historyAttendanceTable tbody tr:nth-child(even) {
            background-color: var(--table-row-even); 
            transition: all var(--transition-speed);
        }

        #attendanceTable tbody tr:hover, #historyAttendanceTable tbody tr:hover {
            background-color: var(--table-row-hover); 
            cursor: pointer;
            transition: background-color var(--transition-speed), transform 0.1s ease;
            transform: translateY(-1px);
        }

        /* Status Background Colors for Table Rows */
        .status-present-row { background-color: var(--status-present-bg) !important; }
        .status-absent-row { background-color: var(--status-absent-bg) !important; }
        .status-weekend-row { background-color: var(--status-weekend-bg) !important; }
        .status-holiday-row { background-color: var(--status-holiday-bg) !important; }
        .status-government_holiday-row { background-color: var(--status-govt-holiday-bg) !important; }
        .status-sick_leave-row { background-color: var(--status-sick-leave-bg) !important; }

        .table-actions button {
            background-color: var(--accent-color); 
            color: #FFFFFF;
            border: none; 
            padding: 6px 10px; /* Larger padding */
            border-radius: 5px; /* Slightly larger border-radius */
            cursor: pointer;
            font-size: 0.7rem; /* Slightly larger font */
            margin-right: 5px; 
            transition: all 0.2s ease; /* Slower transition */
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1); 
        }

        .table-actions button:hover {
            background-color: var(--accent-color-hover);
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        .table-actions .delete-button { 
            background-color: var(--alert-error);
            box-shadow: 0 2px 6px rgba(244, 67, 54, 0.15);
        }

        .table-actions .delete-button:hover {
            background-color: #C82333;
            box-shadow: 0 3px 8px rgba(244, 67, 54, 0.2);
        }

        /* Specific Status Colors (Text Only) */
        .status-present { color: var(--status-present); font-weight: 700; transition: color var(--transition-speed); }
        .status-absent { color: var(--status-absent); font-weight: 700; transition: color var(--transition-speed); }
        .status-weekend { color: var(--status-weekend); font-weight: 700; transition: color var(--transition-speed); }
        .status-holiday { color: var(--status-holiday); font-weight: 700; transition: color var(--transition-speed); }
        .status-government_holiday { color: var(--status-govt-holiday); font-weight: 700; transition: color var(--transition-speed); }
        .status-sick_leave { color: var(--status-sick-leave); font-weight: 700; transition: color var(--transition-speed); }
        
        /* Edit/Delete Modal specific styles */
        #editDeleteModal .modal-content .input-group {
            margin-bottom: 12px; /* Increased margin */
        }
        #editDeleteModal .modal-content .input-group label {
            margin-bottom: 5px; /* Increased margin */
            color: var(--text-primary); 
            font-weight: 600;
        }
        #editDeleteModal .modal-content .input-group input,
        #editDeleteModal .modal-content .input-group select {
            width:100%; 
            padding: 10px 12px; /* Larger padding */
            border-radius: var(--border-radius-base);
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); 
            color: var(--modal-text); 
            background-color: var(--input-bg);
            font-size: 0.9rem; /* Slightly larger font */
        }
        #editDeleteModal .modal-content .input-group input::placeholder,
        #editDeleteModal .modal-content .input-group select {
            color: var(--modal-text); 
            opacity: 0.8;
        }
        #editDeleteModal .modal-content .modal-buttons {
            display: flex; 
            justify-content: flex-end; 
            gap: 10px; /* Increased gap */
            margin-top: 20px; /* Increased margin */
        }
        #editDeleteModal .modal-content .modal-buttons .premium-button {
            padding: 10px 15px; /* Larger padding */
            font-size: 0.85rem; /* Slightly larger font */
        }

        /* Custom Alert/Confirm Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6); /* Darker overlay */
            justify-content: center;
            align-items: center;
            animation: fadeInOverlay 0.3s ease-out; /* Slower animation */
            backdrop-filter: blur(5px); /* More blur */
        }
        @keyframes fadeInOverlay {
            from { background-color: rgba(0,0,0,0); backdrop-filter: blur(0px); }
            to { background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        }

        .modal-content {
            background-color: var(--bg-secondary);
            padding: 25px; /* Larger padding */
            border-radius: var(--border-radius-large);
            box-shadow: 0 15px 30px var(--shadow-color); /* More prominent shadow */
            width: 90%;
            max-width: 450px; /* Wider modal */
            position: relative;
            animation: zoomIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; /* Slower animation */
            border: 1px solid var(--border-color);
            transition: all var(--transition-speed);
            backdrop-filter: blur(8px); /* More blur */
        }
        .modal.closing .modal-content {
            animation: zoomOut 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; 
        }
        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.7); } /* More pronounced initial scale */
            to { opacity: 1; transform: scale(1); }
        }
        @keyframes zoomOut {
            from { opacity: 1; transform: scale(1); } 
            to { opacity: 0; transform: scale(0.7); }
        }

        .modal-content h2 {
            margin-top: 0;
            margin-bottom: 15px; /* Increased margin */
            font-size: 1.6rem; /* Larger font size */
            text-align: center;
            color: var(--modal-text);
            text-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .modal-content p, .modal-content h4, .modal-content ul li{
          color: var(--text-primary); 
        }
      

        .modal-content .close-button {
            color: var(--text-secondary);
            font-size: 26px; /* Larger close button */
            font-weight: 600;
            position: absolute;
            top: 15px; 
            right: 15px; 
            cursor: pointer;
            transition: all 0.25s ease; /* Slower transition */
        }

        .modal-content .close-button:hover,
        .modal-content .close-button:focus {
            color: var(--accent-color);
            transform: rotate(90deg) scale(1.1); /* More pronounced rotation and scale */
        }

        #customAlertModal .modal-content,
        #customConfirmModal .modal-content {
            padding: 25px; 
            max-width: 400px; 
            border-left: 6px solid var(--alert-info); /* Thicker border */
            animation: zoomIn 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; 
            transition: border-color var(--transition-speed);
            box-shadow: 0 10px 25px var(--shadow-color); 
            background-color: var(--bg-secondary); 
        }

        #customAlertModal h2,
        #customConfirmModal h2 {
            font-size: 1.4rem; /* Larger font size */
            margin-bottom: 12px; 
            color: var(--text-primary); 
        }

        #customAlertModal p,
        #customConfirmModal p {
            font-size: 0.9rem; /* Slightly larger font */
            margin-bottom: 18px; 
            color: var(--text-secondary); 
        }

        #customAlertModal .modal-buttons,
        #customConfirmModal .modal-buttons {
            display: flex;
            justify-content: flex-end; 
            gap: 10px; 
        }

        #customAlertModal .modal-buttons .premium-button,
        #customConfirmModal .modal-buttons .premium-button {
            padding: 10px 15px; 
            font-size: 0.85rem; 
        }

        /* Help Modal Specific Styles */
        .help-modal-content {
            padding: 35px; /* Larger padding */
            animation: zoomIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; /* Slower animation */
            background-color: var(--bg-secondary);
        }

        .help-modal-content h2 {
            font-size: 1.8rem; /* Larger font size */
            margin-bottom: 15px; 
            color: var(--text-primary); 
        }

        .help-modal-content p {
            font-size: 1rem; /* Larger font size */
            color: var(--text-secondary); 
        }

        /* Profile Page Section Styles */
        #profilePageSection {
            flex-grow: 1;
            padding: 20px 25px;
            background: var(--bg-primary); 
            transition: background var(--transition-speed);
            display: none; 
            flex-direction: column; /* Changed to column for full width */
            align-items: center;
            gap: 25px; /* Gap between main content and sidebar */
            position: relative; /* For absolute positioning of sidebar */
        }
        #profilePageSection .profile-content-card {
            background-color: var(--bg-secondary);
            padding: 30px; /* Larger padding */
            border-radius: var(--border-radius-large);
            box-shadow: 0 6px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
            width: 100%;
            max-width: 700px; /* Adjusted max-width for main content */
            display: flex;
            flex-direction: column;
            gap: 20px; /* Increased gap */
            text-align: center;
            flex-shrink: 0; /* Prevent shrinking */
            backdrop-filter: blur(5px);
        }

        #profilePageSection .profile-content-card h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        #profilePageSection .profile-picture-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px; /* Increased gap */
            margin-bottom: 25px;
        }
        #profilePageSection .user-photo-preview {
            width: 160px; /* Larger preview */
            height: 160px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color);
            transition: border-color var(--transition-speed), transform 0.2s ease;
        }
        #profilePageSection .user-photo-preview:hover {
            transform: scale(1.05);
        }
        #profilePageSection .photo-suggestions {
            display: flex;
            gap: 12px; /* Increased gap */
            flex-wrap: wrap;
            justify-content: center;
        }
        #profilePageSection .photo-suggestions img {
            width: 55px; /* Larger suggestions */
            height: 55px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
        }
        #profilePageSection .photo-suggestions img:hover {
            transform: scale(1.15);
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.3);
        }
        #profilePageSection .photo-remove-btn {
            background-color: var(--alert-error);
            color: #FFFFFF;
        }

        /* History Page Section */
        #historySection {
            flex-grow: 1; 
            padding: 20px 25px; 
            background: var(--bg-primary); 
            transition: background var(--transition-speed);
            display: none; 
            flex-direction: column; 
            align-items: center;
            gap: 25px; /* Increased gap */
        }

        #historySection .date-range-inputs {
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 15px; /* Increased gap */
            margin-bottom: 20px; 
            width: 100%;
            max-width: 950px;
            background-color: var(--bg-secondary);
            padding: 25px; /* Larger padding */
            border-radius: var(--border-radius-large);
            box-shadow: 0 6px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
        }

        #historySection .date-range-inputs .input-group {
            min-width: 200px; /* Wider input group */
            flex-grow: 1; 
        }

        #historySection .date-range-inputs .input-group label {
            color: var(--text-primary); 
            font-size: 0.9rem; /* Slightly larger font */
            font-weight: 600;
        }
        #historySection .date-range-inputs .input-group input {
            color: var(--text-primary); 
            background-color: var(--input-bg);
            padding: 10px 12px; /* Larger padding */
            font-size: 0.95rem; /* Slightly larger font */
            border-radius: var(--border-radius-base);
            border: 1px solid var(--border-color);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        #historySection .date-range-inputs button {
            max-width: 180px; /* Wider button */
            margin-top: 15px; 
            padding: 10px 15px; 
            font-size: 0.9rem; 
            flex-grow: 1;
        }

        #historyDetailedEntries {
            margin-top: 0 !important; 
        }

        /* --- Footer --- */
        #mainFooter {
            background-color: var(--footer-bg);
            color: var(--footer-text);
            padding: 25px 20px; /* Increased padding */
            text-align: center;
            font-size: 0.85rem; /* Slightly larger font */
            border-top: 1px solid var(--border-color);
            transition: background-color var(--transition-speed), color var(--transition-speed);
            margin-top: auto; /* Pushes footer to the bottom */
            width: 100%;
            backdrop-filter: blur(5px);
        }
        #mainFooter .social-links {
            margin-bottom: 15px; /* Increased margin */
            display: flex;
            justify-content: center;
            gap: 20px; /* Increased gap */
        }
        #mainFooter .social-links a {
            color: var(--footer-text);
            font-size: 1.3rem; /* Larger icons */
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #mainFooter .social-links a:hover {
            color: var(--accent-color);
            transform: translateY(-3px) scale(1.1);
        }
        #mainFooter .contact-info {
            margin-bottom: 15px;
            line-height: 1.8;
        }
        #mainFooter .contact-info p {
            margin: 0;
            color: var(--footer-text);
        }
        #mainFooter .contact-info strong {
            color: var(--text-primary);
        }
        #mainFooter .credit-note {
            margin-top: 15px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* COLA Progress Bar */
        .cola-progress-bar-container {
            width: 100%;
            background-color: rgba(255,255,255,0.15); /* Slightly more visible background */
            border-radius: var(--border-radius-base);
            overflow: hidden;
            margin-top: 12px;
            height: 15px; /* Taller bar */
            position: relative;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .cola-progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--status-present), var(--accent-color)); /* Gradient for progress */
            width: 0%;
            transition: width 0.8s ease-out; /* Slower, smoother transition */
            border-radius: var(--border-radius-base);
        }
        .cola-eligibility-status {
            font-size: 0.9rem; /* Slightly larger font */
            font-weight: 600;
            color: var(--status-present);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .cola-eligibility-status i {
            font-size: 1.1rem; /* Slightly larger icon */
        }

        /* Page Transition Animation */
        .page-transition {
            animation: fadeInSlideUp 0.6s ease-out forwards; /* Slower, more dynamic animation */
        }
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Notes Section Styles */
        #notesPageSection {
            flex-grow: 1;
            padding: 20px 25px;
            background: var(--bg-primary);
            transition: background var(--transition-speed);
            display: none;
            flex-direction: row; /* Layout for notes: sidebar + content */
            gap: 25px;
            align-items: flex-start;
        }
        #notesPageSection.active {
            display: flex;
        }

        .notes-list-sidebar {
            width: var(--notes-sidebar-width);
            background-color: var(--bg-secondary);
            padding: 20px;
            border-radius: var(--border-radius-large);
            box-shadow: 0 6px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
            flex-shrink: 0;
            max-height: calc(100vh - 100px);
            overflow-y: auto;
            transition: all var(--transition-speed);
            backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .notes-list-sidebar h3 {
            font-size: 1.5rem;
            color: var(--accent-color);
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }
        .notes-list-sidebar .add-note-button {
            width: 100%;
            margin-bottom: 10px;
        }
        .notes-list-sidebar .note-item {
            padding: 12px 15px;
            border-radius: var(--border-radius-base);
            background-color: var(--input-bg);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
        }
        .notes-list-sidebar .note-item:hover {
            background-color: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .notes-list-sidebar .note-item.active {
            background-color: var(--accent-color);
            color: #FFFFFF;
            box-shadow: 0 4px 12px rgba(142, 68, 173, 0.3);
            transform: translateY(-2px);
        }
        .notes-list-sidebar .note-item.active h4,
        .notes-list-sidebar .note-item.active p {
            color: #FFFFFF;
        }
        .notes-list-sidebar .note-item h4 {
            font-size: 1rem;
            margin-bottom: 5px;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .notes-list-sidebar .note-item p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .note-content-area {
            flex-grow: 1;
            background-color: var(--bg-secondary);
            padding: 30px;
            border-radius: var(--border-radius-large);
            box-shadow: 0 6px 20px var(--shadow-color);
            border: 1px solid var(--border-color);
            transition: all var(--transition-speed);
            backdrop-filter: blur(5px);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .note-content-area h2 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            text-align: center;
        }
        .note-content-area .input-group {
            margin-bottom: 0;
        }
        .note-content-area .input-group label {
            font-size: 1rem;
            margin-bottom: 8px;
        }
        .note-content-area .note-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            #sidebar {
                width: 100%;
                height: auto;
                position: relative;
                box-shadow: 0 2px 10px var(--shadow-color);
                border-radius: 0 0 var(--border-radius-large) var(--border-radius-large);
                padding-bottom: 0;
                top: 0; 
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }
            #sidebar.collapsed {
                width: 100%;
                align-items: flex-start;
            }
            #sidebar .sidebar-toggle {
                position: static; 
                margin: 15px auto; /* Center toggle button */
                transform: none !important; 
            }
            #sidebar.collapsed .sidebar-toggle {
                transform: none;
            }
            #sidebar .sidebar-header{
                padding: 15px 20px;
                width: 100%;
                flex-direction: row;
                justify-content: center;
                gap: 15px;
            }
            #sidebar .sidebar-menu {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                padding: 15px 0;
            }
            #sidebar .sidebar-menu-item {
                margin: 8px;
            }
            #sidebar .sidebar-menu a {
                padding: 10px 15px;
                font-size: 0.85rem;
                margin: 0;
            }
            #sidebar .sidebar-menu a span {
                display: inline;
            }
            #sidebar .sidebar-menu a i {
                margin-right: 8px;
            }
            #sidebar.collapsed .sidebar-menu a {
                justify-content: flex-start;
            }

            .main-content-wrapper {
                width: 100%;
            }

            #dashboardProfileSection,
            .working-days-cola-category-wrapper,
            #attendancePageSection .month-selector-card,
            #attendancePageSection .chart-container-card,
            #attendancePageSection .calendar-card,
            .total-hours-box,
            .monthly-summary-grid,
            #dailyEntriesSection,
            #historySection .date-range-inputs,
            #historyDetailedEntries,
            .dashboard-slideshow-container {
                max-width: 100%; 
                padding: 20px;
            }
            #dashboardProfileSection .profile-details-grid {
                grid-template-columns: 1fr; 
                text-align: center;
            }
            #dashboardProfileSection .detail-item {
                justify-content: center;
            }
            .monthly-summary-grid {
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
            }

            #attendancePageSection .top-row-cards {
                flex-direction: column; /* Stack cards vertically on smaller screens */
                align-items: center;
            }
            #attendancePageSection .month-selector-card,
            #attendancePageSection .chart-container-card,
            #attendancePageSection .calendar-card,
            #attendancePageSection .total-hours-box {
                width: 100%;
                max-width: 400px; /* Limit width for stacked cards */
            }
            #attendancePageSection .total-hours-box {
                width: 280px; /* Maintain circular size */
                height: 280px;
            }

            #profilePageSection {
                flex-direction: column; /* Stack profile content and sidebar */
                align-items: center;
            }
            #profilePageSection .profile-content-card {
                max-width: 100%;
            }
            
            #notesPageSection {
                flex-direction: column;
                align-items: center;
            }
            .notes-list-sidebar {
                width: 100%;
                max-width: 600px;
                position: relative;
                top: auto;
                max-height: none;
            }
            .note-content-area {
                width: 100%;
                max-width: 600px;
            }
        }

        @media (max-width: 768px) {
            #sidebar .sidebar-toggle {
                left: 50%;
                transform: translateX(-50%) !important;
                top: 15px;
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }
            #sidebar.collapsed .sidebar-toggle {
                transform: translateX(-50%);
            }

            .main-header {
                padding: 10px 15px;
                height: 55px; 
            }
            .app-layout {
                margin-top: 55px;
                min-height: calc(100vh - 55px);
            }
            #sidebar {
                height: calc(100vh - 55px);
            }
            .main-header .page-title-display {
                font-size: 1.2rem;
            }

            #dashboardProfileSection .user-details h2 {
                font-size: 1.6rem;
            }
            #dashboardProfileSection .user-details p {
                font-size: 1rem;
            }
            #dashboardProfileSection .detail-item {
                font-size: 0.9rem;
            }

            .working-days-cola-category-wrapper {
                gap: 15px; 
            }
            .working-days-cola-category-wrapper .summary-card {
                padding: 18px 20px;
            }
            .working-days-cola-category-wrapper .summary-card .value {
                font-size: 1.6rem;
            }

            #attendancePageSection .chart-container-card {
                height: 280px;
            }
            .total-hours-box {
                width: 220px;
                height: 220px;
            }
            .total-hours-box .value {
                font-size: 3rem;
            }
            .total-hours-box h4 {
                font-size: 1.1rem;
            }
            .monthly-summary-grid {
                grid-template-columns: 1fr; 
            }

            .dashboard-scrolling-content {
                padding: 15px;
            }
            .section-card {
                padding: 20px;
            }
            .section-card h2 {
                font-size: 1.2rem;
            }

            #attendanceTable th,
            #attendanceTable td,
            #historyAttendanceTable th,
            #historyAttendanceTable td {
                padding: 8px 10px;
                font-size: 0.7rem;
            }
            .table-actions button {
                padding: 5px 8px;
                font-size: 0.65rem;
            }

            .notes-list-sidebar {
                padding: 15px;
            }
            .notes-list-sidebar h3 {
                font-size: 1.3rem;
            }
            .note-content-area {
                padding: 25px;
            }
            .note-content-area h2 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header (Moved to the very top) -->
    <header class="main-header" id="mainHeader">
        <span class="page-title-display" id="pageTitleDisplay">Dashboard</span>

        <div class="header-actions">
            <button id="themeToggle" class="theme-toggle-button">
                <i class="fas fa-moon"></i> <span>Dark Mode</span>
            </button>
            <i class="fas fa-bell header-notification-icon"></i>
            
            <!-- User Menu Toggle -->
            <button id="userMenuToggle" class="user-menu-toggle">
                <img id="headerUserPhoto" src="https://placehold.co/36x36/A767E9/FFFFFF?text=U" alt="User Photo">
                <span id="headerUsernameDisplay">User</span>
            </button>

            <!-- User Menu Dropdown -->
            <div id="userMenuDropdown" class="user-menu-dropdown">
                <!-- User list will be populated here by JavaScript -->
            </div>
        </div>
    </header>

    <!-- Login/Registration Section -->
    <div id="authSection" class="login-page-body">
        <div class="auth-container">
            <h1 class="premium-heading">Welcome to TrackFlow!</h1> 
            <p class="sub-heading">Please login with your LevernGear account.</p>

            <form id="gmailLoginForm" class="auth-form active">
                <div class="input-group">
                    <label for="gmailEmail">Email Address</label>
                    <input type="email" id="gmailEmail" placeholder="Enter your LevernGear email" required>
                    <span class="login-note">Email must include @leverngear.com</span>
                    <span class="error-message" id="gmailEmailError"></span>
                </div>
                <div class="input-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required>
                    <span class="login-note">Password must be <strong>pranto</strong></span>
                    <span class="error-message" id="loginPasswordError"></span>
                </div>
                <button type="submit" class="premium-button">Login</button>
            </form>
        </div>
    </div>

    <!-- Main Activity Page Section (Initially hidden) -->
    <div id="mainActivitySection" style="display: none;" class="app-layout">
        <!-- Sidebar -->
        <aside id="sidebar">
            <button id="sidebarToggle" class="sidebar-toggle">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="sidebar-header">
                <!-- New Animated SVG Icon -->
                <svg class="logo-icon animated-new-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M10 20H4V14H10V20ZM10 12H4V4H10V12ZM12 2H22V12H12V2ZM12 14H22V22H12V14Z"/>
                    <path fill="var(--accent-color)" d="M10 20H4V14H10V20ZM10 12H4V4H10V12ZM12 2H22V12H12V2ZM12 14H22V22H12V14Z"/>
                </svg>
                <span class="logo-text">TrackFlow</span>
            </div>

            <ul class="sidebar-menu">
                <li class="sidebar-menu-item"><a href="#" id="homeNavLink" class="active"><i class="fas fa-th-large"></i> <span>Dashboard</span></a></li>
                <li class="sidebar-menu-item"><a href="#" id="attendanceNavLink"><i class="fas fa-calendar-check"></i> <span>Attendance</span></a></li>
                <li class="sidebar-menu-item"><a href="#" id="historyNavLink"><i class="fas fa-history"></i> <span>History</span></a></li>
                <li class="sidebar-menu-item"><a href="#" id="notesNavLink"><i class="fas fa-clipboard"></i> <span>Notes</span></a></li> <!-- New Notes Nav Link -->
                <li class="sidebar-menu-item"><a href="#" id="personalProfileBtn"><i class="fas fa-user-circle"></i> <span>My Profile</span></a></li>
                <li class="sidebar-menu-item"><a href="#" id="Users" title="Will Comming Soon/Under Constraction"><i class="fa-solid fa-users"></i> <span>Users</span></a></li>
                <li class="sidebar-menu-item"><a href="#" id="helpNavLink"><i class="fas fa-question-circle"></i> <span>Help</span></a></li>
                <li class="sidebar-menu-item"><a href="#" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
            </ul>
        </aside>

        <div class="main-content-wrapper">
            <!-- Dashboard Page Section -->
            <div id="dashboardPageSection" class="dashboard-scrolling-content">
                <!-- User Profile Section (Moved from sidebar to dashboard main content) -->
                <section id="dashboardProfileSection" class="section-card page-transition">
                    <img id="dashboardUserPhoto" src="https://placehold.co/150x150/A767E9/FFFFFF?text=U" alt="User Photo" class="user-photo">
                    <div class="user-details">
                        <h2 id="dashboardUsername">Sebastian L.</h2>
                        <p id="dashboardUserRole">HR Manager</p>
                    </div>
                    <div class="profile-details-grid">
                        <div class="detail-item"><i class="fas fa-clock"></i> <span>Joining: <strong><span id="dashboardJoiningDuration"></span></strong></span></div>
                        <div class="detail-item"><i class="fas fa-id-badge"></i> <span>LnG ID: <strong><span id="dashboardLngId"></span></strong></span></div>
                        <div class="detail-item"><i class="fas fa-user-tag"></i> <span>Emp.Type: <strong><span id="dashboardEmployeeType"></span></strong></span></div>
                        <div class="detail-item"><i class="fas fa-users"></i> <span>Team: <strong><span id="dashboardTeam"></span></strong></span></div>
                        <div class="detail-item"><i class="fas fa-briefcase"></i> <span>Desig.: <strong><span id="dashboardDesignation"></span></strong></span></div>
                    </div>
                </section>

                <!-- New: Working Days, COLA, Category Wrapper (Full Width Rows) -->
                <div class="working-days-cola-category-wrapper page-transition">
                    <div class="summary-card">
                        <h4>Total Working Days </br>* For the selected month</h4>
                        <span class="value" id="totalWorkingDaysDisplay">0 Days</span>
                        <!-- Details button removed -->
                    </div>
                    <div class="summary-card">
                        <h4>COLA Eligibility</h4>
                        <span class="value" id="colaEligibilityDisplay">Need present 0 days</span>
                        <div class="cola-progress-bar-container">
                            <div class="cola-progress-bar" id="colaProgressBar"></div>
                        </div>
                        <div class="cola-eligibility-status" id="colaEligibilityStatus"></div>
                        <!-- Details button removed -->
                    </div>
                    <div class="summary-card">
                        <h4>Category </br>* This will update after full month complete!</h4>
                        <span class="value" id="employeeCategoryDisplay">Category: A, Excellent</span>
                        <!-- Details button removed -->
                    </div>
                </div>

                <!-- New Animated Slideshow for Details -->
                <div class="dashboard-slideshow-container page-transition">
                    <div class="dashboard-slideshow-card" id="slideshowCard1">
                        <h3>Total Working Days Details</h3>
                        <p><strong>Selected Month:</strong> <span id="twdMonthDisplay"></span></p>
                        <p><strong>Total Days in Period:</strong> <span id="twdTotalDays"></span></p>
                        <p><strong>Total Sundays:</strong> <span id="twdTotalSundays"></span></p>
                        <p><strong>Total Holidays:</strong> <span id="twdTotalHolidays"></span></p>
                        <p><strong>Calculated Working Days (Excluding Sundays & Holidays):</strong> <span id="twdCalculatedWorkingDays"></span></p>
                    </div>
                    <div class="dashboard-slideshow-card" id="slideshowCard2">
                        <h3>COLA Eligibility Details</h3>
                        <p><strong>Selected Month:</strong> <span id="colaMonthDisplay"></span></p>
                        <p><strong>Total Calculated Working Days:</strong> <span id="colaTotalWorkingDays"></span></p>
                        <p><strong>Required Present Days:</strong> <span id="colaRequiredPresentDays"></span></p>
                        <p><strong>Your Present Days:</strong> <span id="colaYourPresentDays"></span></p>
                        <div class="cola-progress-bar-container" style="height: 20px; margin-top: 15px;">
                            <div class="cola-progress-bar" id="colaModalProgressBar" style="height: 100%;"></div>
                        </div>
                        <div class="cola-eligibility-status" id="colaModalEligibilityStatus" style="justify-content: center; margin-top: 10px; font-size: 1rem;"></div>
                        <h4 style="margin-top: 20px; text-align: center;">COLA Rules:</h4>
                        <ul style="list-style-type: none; padding-left: 0; font-size: 0.9rem; color: var(--text-secondary);">
                            <li><i class="fas fa-circle-info"></i> If Working days 27-26 days, Need present 22 days.</li>
                            <li><i class="fas fa-circle-info"></i> If working days 25-24 days, Need present 21 Days.</li>
                            <li><i class="fas fa-circle-info"></i> If working days below 24 days, Need Present 20 days.</li>
                        </ul>
                    </div>
                    <div class="dashboard-slideshow-card" id="slideshowCard3">
                        <h3>Employee Category Details</h3>
                        <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                            <thead>
                                <tr style="background-color: var(--table-header-bg);">
                                    <th style="padding: 8px; border: 1px solid var(--border-color); text-align: left;">Category</th>
                                    <th style="padding: 8px; border: 1px solid var(--border-color); text-align: left;">Treated As</th>
                                    <th style="padding: 8px; border: 1px solid var(--border-color); text-align: left;">Eligibility Working Hours %</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">A</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">Excellent</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">90%-100%</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">B</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">Very Good</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">85%-89%</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">C</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">Good</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">80%-84%</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">D</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">Need Improvement</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">75%-79%</td>
                                </tr>
                                <tr>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">E</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">Failure</td>
                                    <td style="padding: 8px; border: 1px solid var(--border-color);">Below 70% or equal to 74%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="slideshow-nav-dots"></div>
                </div>
            </div>

            <!-- Attendance Page Section (New) -->
            <div id="attendancePageSection" style="display: none;" class="page-transition">
                <div class="top-row-cards">
                    <div class="month-selector-card">
                        <h4>Select Month</h4>
                        <select id="monthSelectDropdown"></select>
                        <div class="date-range-display">
                            <p><strong>From:</strong> <span id="dateFrom"></span></p>
                            <p><strong>To:</strong> <span id="dateTo"></span></p>
                        </div>
                    </div>
                    <div class="chart-container-card">
                        <canvas id="monthlyAttendanceChart"></canvas>
                        <div class="chart-percentage-text" id="chartPercentageText"></div>
                    </div>
                    <!-- Total Hours Box -->
                    <div class="total-hours-box">
                        <span class="value" id="totalHoursCircularDisplay">0</span>
                        <h4>Total Hours</br> Worked</h4>
                    </div>
                    <div class="calendar-card">
                        <div class="calendar-header">
                            <button id="prevMonthBtn"><i class="fas fa-chevron-left"></i></button>
                            <h3 id="currentMonthYear"></h3>
                            <button id="nextMonthBtn"><i class="fas fa-chevron-right"></i></button>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <div class="calendar-day-name">Sun</div>
                            <div class="calendar-day-name">Mon</div>
                            <div class="calendar-day-name">Tue</div>
                            <div class="calendar-day-name">Wed</div>
                            <div class="calendar-day-name">Thu</div>
                            <div class="calendar-day-name">Fri</div>
                            <div class="calendar-day-name">Sat</div>
                            <!-- Dates will be populated here by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Monthly Summary (5+5 boxes) -->
                <section class="section-card monthly-summary-section">
                    <h2>Monthly Summary</h2>
                    <div class="monthly-summary-grid">
                        <div class="summary-card">
                            <h4>Total Hours</h4>
                            <span class="value" id="summaryTotalHours">0</span>
                        </div>
                        <div class="summary-card">
                            <h4>Late</h4>
                            <span class="value" id="summaryLate">00:00</span>
                        </div>
                        <div class="summary-card">
                            <h4>Absent</h4>
                            <span class="value" id="summaryAbsent">0</span>
                        </div>
                        <div class="summary-card">
                            <h4>Weekends</h4>
                            <span class="value" id="summaryWeekend">0</span>
                        </div>
                        <div class="summary-card">
                            <h4>Holidays</h4>
                            <span class="value" id="summaryHoliday">0</span>
                        </div>
                        <div class="summary-card">
                            <h4>Working Days</h4>
                            <span class="value" id="summaryWorkingDays">0</span>
                        </div>
                        <div class="summary-card">
                            <h4>Total Present</h4>
                            <span class="value" id="summaryTotalPresent">0</span>
                        </div>
                        <div class="summary-card">
                            <h4>Night Shifts</h4>
                            <span class="value" id="summaryNightShifts">0</span>
                        </div>
                        <div class="summary-card">
                            <h4>Day Shifts</h4>
                            <span class="value" id="summaryDayShifts">0</span>
                        </div>
                        <div class="summary-card">
                            <h4>Grace Used</h4>
                            <span class="value" id="summaryGrace">0</span>
                        </div>
                    </div>
                </section>

                <!-- Daily Entries Data -->
                <section id="dailyEntriesSection" class="section-card">
                    <h2>Daily Entries</h2>
                    <div class="table-responsive">
                        <table id="attendanceTable">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Day</th>
                                    <th>Status</th>
                                    <th>Hour</th>
                                    <th>Extra Hour</th>
                                    <th>Late</th>
                                    <th>Shift</th>
                                    <th>Grace</th>
                                    <th>Approval</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be populated here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <!-- History Page Section (Initially hidden) -->
            <section id="historySection" class="section-card page-transition" style="display: none;">
                <h2>Custom Report Generator</h2>
                <div class="date-range-inputs">
                    <div class="input-group">
                        <label for="historyDateFrom">From Date:</label>
                        <input type="date" id="historyDateFrom">
                    </div>
                    <div class="input-group">
                        <label for="historyDateTo">To Date:</label>
                        <input type="date" id="historyDateTo">
                    </div>
                    <button id="findHistoryResultBtn" class="premium-button">Generate Report</button>
                </div>
                
                <div id="historyDetailedEntries" class="table-responsive">
                    <h2>Detailed Entries</h2>
                    <table id="historyAttendanceTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Day</th>
                                <th>Status</th>
                                <th>Hour</th>
                                <th>Extra Hour</th>
                                <th>Late</th>
                                <th>Shift</th>
                                <th>Grace</th>
                                <th>Approval</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Detailed entries will be populated here -->
                        </tbody>
                    </table>
                </div>
            </section>
            
            <!-- My Profile Page Section (initially hidden) -->
            <section id="profilePageSection" class="page-transition" style="display: none;">
                <div class="profile-content-card">
                    <h2>Edit Profile</h2>
                    <div class="profile-picture-upload">
                        <img id="profilePicturePreview" src="https://placehold.co/160x160/DEE2E6/343A40?text=U" alt="Profile Picture Preview" class="user-photo-preview">
                        <input type="file" id="profilePictureInput" accept="image/*" style="display: none;">
                        <label for="profilePictureInput" class="premium-button secondary">Upload New Photo</label>
                        <button id="removeProfilePhotoBtn" class="premium-button delete-button" style="display: none;">Remove Photo</button>
                        <div class="photo-suggestions">
                            <img src="https://placehold.co/55x55/A6D1F5/000000?text=Boy1" alt="Suggested Photo Boy 1" data-url="https://placehold.co/160x160/A6D1F5/000000?text=Boy1">
                            <img src="https://placehold.co/55x55/C6E2FF/000000?text=Boy2" alt="Suggested Photo Boy 2" data-url="https://placehold.co/160x160/C6E2FF/000000?text=Boy2">
                            <img src="https://placehold.co/55x55/FFD9E2/000000?text=Girl1" alt="Suggested Photo Girl 1" data-url="https://placehold.co/160x160/FFD9E2/000000?text=Girl1">
                            <img src="https://placehold.co/55x55/FFC9E2/000000?text=Girl2" alt="Suggested Photo Girl 2" data-url="https://placehold.co/160x160/FFC9E2/000000?text=Girl2">
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="profileNameInput">Profile Name</label>
                        <input type="text" id="profileNameInput" placeholder="Enter your display name">
                    </div>
                    <div class="input-group">
                        <label for="usernameInput">Username</label>
                        <input type="text" id="usernameInput" placeholder="Enter your username">
                    </div>
                    <div class="input-group">
                        <label for="emailInput">Email Address</label>
                        <input type="email" id="emailInput" placeholder="Your email address">
                        <small style="color: var(--text-secondary); font-size: 0.75rem;">Changing email here will not change your primary login account.</small>
                    </div>
                    <div class="input-group">
                        <label for="profileJoiningDateInput">Joining Date</label>
                        <input type="date" id="profileJoiningDateInput">
                    </div>
                    <div class="input-group">
                        <label for="profileLngIdInput">LnG ID</label>
                        <input type="text" id="profileLngIdInput" placeholder="Your LnG ID">
                    </div>
                    <div class="input-group">
                        <label for="employeeTypeInput">Employee Type</label>
                        <input type="text" id="employeeTypeInput" value="Resource pool" placeholder="e.g., Resource pool">
                    </div>
                    <div class="input-group">
                        <label for="resourcefulTypeInput">Resourceful Type</label>
                        <input type="text" id="resourcefulTypeInput" value="Associate Department Operations" placeholder="e.g., Associate Department Operations">
                    </div>
                    <div class="input-group">
                        <label for="unitInput">Unit</label>
                        <input type="text" id="unitInput" value="Collection & Projects" placeholder="e.g., Collection & Projects">
                    </div>
                    <div class="input-group">
                        <label for="teamInput">Team</label>
                        <input type="text" id="teamInput" value="BCBS" placeholder="e.g., BCBS">
                    </div>
                    <div class="input-group">
                        <label for="designationInput">Designation</label>
                        <input type="text" id="designationInput" value="Junior Associate" placeholder="e.g., Junior Associate">
                    </div>
                    <button id="saveProfileBtn" class="premium-button">Save Changes</button>
                </div>
            </section>

            <!-- Notes Page Section (New) -->
            <section id="notesPageSection" class="page-transition" style="display: none;">
                <div class="notes-list-sidebar">
                    <h3>My Notes</h3>
                    <button id="addNewNoteBtn" class="premium-button add-note-button">
                        <i class="fas fa-plus"></i> Add New Note
                    </button>
                    <div id="notesList">
                        <!-- Notes will be populated here -->
                    </div>
                </div>
                <div class="note-content-area">
                    <h2 id="noteContentTitle">Select a Note or Add New</h2>
                    <div class="input-group">
                        <label for="noteTitleInput">Title</label>
                        <input type="text" id="noteTitleInput" placeholder="Note Title">
                    </div>
                    <div class="input-group">
                        <label for="noteBodyInput">Body</label>
                        <textarea id="noteBodyInput" placeholder="Write your note here..."></textarea>
                    </div>
                    <div class="note-actions">
                        <button id="deleteNoteBtn" class="premium-button delete-button" style="display: none;">Delete Note</button>
                        <button id="saveNoteBtn" class="premium-button" style="display: none;">Save Note</button>
                    </div>
                </div>
            </section>
        </div>
      </div>  
        <!-- Footer -->
        <footer id="mainFooter">
            <div class="social-links">
                <a href="https://www.facebook.com/prantorodrix" target="_blank" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.linkedin.com/in/prantorodrix" target="_blank" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://github.com/prantorodrix" target="_blank" aria-label="GitHub"><i class="fab fa-github"></i></a>
            </div>
            <div class="contact-info">
                <p>Mobile: <strong>+880 1700 000000</strong></p>
                <p>Email: <strong>prantorodrix@example.com</strong></p>
            </div>
            <p class="credit-note">Made by @PrantoRodrix</p>
        </footer>
    

    <!-- Edit/Delete Modal (Now handles Add/Edit/Delete) -->
    <div id="editDeleteModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeEditDeleteModal">&times;</span>
            <h2 id="editDeleteModalTitle"></h2>
            <div class="input-group">
                <label for="editDate">Date</label>
                <input type="date" id="editDate" readonly>
            </div>
            <div class="input-group">
                <label for="editStatus">Status</label>
                <select id="editStatus">
                    <option value="Present">Present</option>
                    <option value="Weekend">Weekend</option>
                    <option value="Absent">Absent</option>
                    <option value="Holiday">General Holiday</option>
                    <option value="Government_Holiday">Government Holiday</option>
                    <option value="Sick_Leave">Sick Leave</option>
                </select>
            </div>
            <div class="input-group" id="editHourGroup">
                <label for="editHour">Hours Worked</label>
                <input type="number" id="editHour" min="0" max="24" placeholder="e.g., 9">
            </div>
            <div class="input-group" id="editExtraHourGroup">
                <label for="editExtraHour">Extra Hours</label>
                <input type="number" id="editExtraHour" min="0" max="24" placeholder="e.g., 2">
            </div>
            <div class="input-group" id="editLateHourGroup">
                <label for="editLateHour">Late (HH:MM)</label>
                <input type="text" id="editLateHour" value="00:00" readonly>
            </div>
            <div class="input-group" id="editShiftTypeGroup">
                <label for="editShiftType">Shift Type</label>
                <select id="editShiftType">
                    <option value="Day">Day</option>
                    <option value="Night">Night</option>
                </select>
            </div>
            <div class="input-group" id="editGraceGroup">
                <label for="editGrace">Apply Grace Period</label>
                <select id="editGrace">
                    <option value="-">-</option>
                    <option value="Yes">Yes</option>
                </select>
                <small id="editGraceLimitMessage" style="color: var(--alert-error); display: none;">Grace limit reached for this month (5/5)</small>
            </div>
            <div class="input-group" id="editApprovalGroup">
                <label for="editApproval">Approval Status</label>
                <select id="editApproval">
                    <option value="-">-</option>
                    <option value="Approved">Approved</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button id="updateEntryBtn" class="premium-button"></button> <!-- Text updated by JS -->
                <button id="deleteEntryBtn" class="premium-button delete-button" style="display:none;">Delete Entry</button>
                <button id="cancelEditEntryBtn" class="premium-button secondary">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Custom Alert Modal (for general messages) -->
    <div id="customAlertModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeCustomAlertModal">&times;</span>
            <h2 id="customAlertTitle"></h2>
            <p id="customAlertMessage"></p>
            <div class="modal-buttons">
                <button id="customAlertOkBtn" class="premium-button">OK</button>
            </div>
        </div>
    </div>

    <!-- Custom Confirm Modal (for yes/no questions) -->
    <div id="customConfirmModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeCustomConfirmModal">&times;</span>
            <h2 id="customConfirmTitle"></h2>
            <p id="customConfirmMessage"></p>
            <div class="modal-buttons">
                <button id="customConfirmYesBtn" class="premium-button">Yes</button>
                <button id="customConfirmNoBtn" class="premium-button secondary">No</button>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeNotificationModal">&times;</span>
            <h2>Notifications</h2>
            <p>No Notification here </p>
            <div class="modal-buttons">
                <button id="notificationOkBtn" class="premium-button">OK</button>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content help-modal-content">
            <span class="close-button" id="closeHelpModal">&times;</span>
            <h2 id="helpModalTitle">Need Assistance?</h2>
            <p id="helpModalMessage">Feel free to contact support or refer to the documentation for any queries!</p>
        </div>
    </div>

    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            // Local Data Storage (Loaded from localStorage or initialized)
            let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
            let currentLoggedInUser = null; 
            const FIXED_PASSWORD = "pranto"; // Fixed password for all users

            // Save registeredUsers to localStorage
            function saveRegisteredUsers() {
                localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            }

            // Save currentLoggedInUser's specific data
            function saveCurrentUserData() {
                if (currentLoggedInUser) {
                    const userIndex = registeredUsers.findIndex(user => user.email === currentLoggedInUser.email);
                    if (userIndex !== -1) {
                        registeredUsers[userIndex] = currentLoggedInUser;
                    } else {
                        // If user not found (e.g., first run after localStorage clear), add them
                        registeredUsers.push(currentLoggedInUser);
                    }
                    saveRegisteredUsers();
                }
            }

            // --- Custom Alert/Confirm Modals DOM Elements ---
            const customAlertModal = document.getElementById('customAlertModal');
            const customAlertTitle = document.getElementById('customAlertTitle');
            const customAlertMessage = document.getElementById('customAlertMessage');
            const customAlertOkBtn = document.getElementById('customAlertOkBtn');
            const closeCustomAlertModal = document.getElementById('closeCustomAlertModal');

            const customConfirmModal = document.getElementById('customConfirmModal');
            const customConfirmTitle = document.getElementById('customConfirmTitle');
            const customConfirmMessage = document.getElementById('customConfirmMessage');
            const customConfirmYesBtn = document.getElementById('customConfirmYesBtn');
            const customConfirmNoBtn = document.getElementById('customConfirmNoBtn');
            const closeCustomConfirmModal = document.getElementById('closeCustomConfirmModal');
            let confirmCallback = null; 

            // Notification Modal Elements
            const notificationModal = document.getElementById('notificationModal');
            const closeNotificationModal = document.getElementById('closeNotificationModal');
            const notificationOkBtn = document.getElementById('notificationOkBtn');
            const headerNotificationIcon = document.querySelector('.header-actions .fa-bell');

            // Help Modal elements
            const helpModal = document.getElementById('helpModal');
            const closeHelpModal = helpModal ? helpModal.querySelector('.close-button') : null;

            // --- DOM Elements - Authentication Section ---
            const authSection = document.getElementById('authSection');
            const mainActivitySection = document.getElementById('mainActivitySection');
            const gmailLoginForm = document.getElementById('gmailLoginForm');
            const gmailEmailInput = document.getElementById('gmailEmail');
            const loginPasswordInput = document.getElementById('loginPassword'); // New password input
            const gmailEmailError = document.getElementById('gmailEmailError');
            const loginPasswordError = document.getElementById('loginPasswordError'); // New password error

            // --- DOM Elements - Main Activity Section ---
            let mainHeader; // New: Header element
            let sidebar, sidebarToggle;
            let pageTitleDisplay; 

            let personalProfileBtn, logoutBtn, profilePageSection, 
                profileNameInput, usernameInput, emailInput, profilePictureInput, profilePicturePreview, saveProfileBtn,
                profileJoiningDateInput, profileLngIdInput, removeProfilePhotoBtn, photoSuggestionImages;
            let employeeTypeInput, resourcefulTypeInput, unitInput, teamInput, designationInput; 

            // Dashboard Profile Section elements (New)
            let dashboardPageSection;
            let dashboardUserPhoto, dashboardUsername, dashboardUserRole,
                dashboardJoiningDuration, dashboardLngId, dashboardEmployeeType, dashboardTeam, dashboardDesignation;

            // Attendance Page elements (New)
            let attendancePageSection;
            let monthSelectDropdown, dateFromDisplay, dateToDisplay;
            let totalHoursCircularDisplay; // New element for total hours
            let summaryTotalHours, summaryLate, summaryAbsent, summaryWeekend, summaryHoliday, summaryWorkingDays, 
                summaryDayShifts, summaryNightShifts, summaryGrace, summaryTotalPresent;
            let attendanceTableBody; // Daily Entries Table

            let historyNavLink, helpNavLinkRef, attendanceNavLink, notesNavLink; // Added notesNavLink
            let historySection; 

            let historyDateFromInput, historyDateToInput, findHistoryResultBtn;
            let historyAttendanceTableBody;

            let monthlyChart = null;
            let chartPercentageText; 
            let currentMonthView = new Date(); 

            // Calendar elements
            let calendarGrid, currentMonthYearDisplay, prevMonthBtn, nextMonthBtn;

            // Theme Toggle
            let themeToggle;

            // New Dashboard Card Elements
            let totalWorkingDaysDisplay,
                colaEligibilityDisplay, colaProgressBar, colaEligibilityStatus,
                employeeCategoryDisplay;

            // Dashboard Slideshow elements
            let dashboardSlideshowContainer, slideshowCards, slideshowNavDots;
            let slideshowInterval;
            let currentSlideIndex = 0;

            // User Menu elements
            let userMenuToggle, userMenuDropdown, headerUserPhoto, headerUsernameDisplay;

            // Notes Section elements
            let notesPageSection, notesList, addNewNoteBtn, noteContentTitle, noteTitleInput, noteBodyInput, saveNoteBtn, deleteNoteBtn;
            let currentEditingNoteId = null;
            let autoSaveTimeout = null;

            // Footer
            let mainFooter;


            // --- Initial Setup and Auto-Login Simulation ---
            function initializeApp() {
                const lastLoggedInEmail = localStorage.getItem('lastLoggedInUserEmail');
                if (lastLoggedInEmail) {
                    const user = registeredUsers.find(u => u.email === lastLoggedInEmail);
                    if (user) {
                        currentLoggedInUser = user;
                        showMainActivitySection();
                        return; 
                    }
                }
                showAuthSection(); 
            }

            function showAuthSection() {
                authSection.style.display = 'flex';
                mainActivitySection.style.display = 'none';
                if (mainHeader) mainHeader.style.display = 'none'; // Hide header on login page
                if (mainFooter) mainFooter.style.display = 'none'; // Hide footer on login page
                setupAuthPage();
            }

            function showMainActivitySection() {
                authSection.style.display = 'none';
                mainActivitySection.style.display = 'flex'; 
                if (mainHeader) mainHeader.style.display = 'flex'; // Show header on main activity
                if (mainFooter) mainFooter.style.display = 'flex'; // Show footer on main activity
                queryMainAppElements(); 
                setupMainApp();
                updateUserProfileDisplay(); 
                populateMonthDropdown(); 
                setupMonthView(currentMonthView); 
                showSection('dashboard'); // Default to dashboard
                // Set initial theme based on localStorage
                const savedTheme = localStorage.getItem('theme') || 'neptune-vibe';
                document.documentElement.setAttribute('data-theme', savedTheme);
                if (themeToggle) {
                    updateThemeToggleButton(savedTheme);
                }
                updateUserMenuDropdown(); // Populate user menu on login
            }

            // --- Authentication Page Setup ---
            function setupAuthPage() {
                if (gmailLoginForm) {
                    gmailLoginForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        gmailEmailInput.classList.remove('error');
                        gmailEmailError.textContent = '';
                        loginPasswordInput.classList.remove('error');
                        loginPasswordError.textContent = '';

                        const email = gmailEmailInput.value.trim();
                        const password = loginPasswordInput.value;

                        if (!email) {
                            gmailEmailInput.classList.add('error');
                            gmailEmailError.textContent = 'Email address is required.';
                            return;
                        }

                        if (!email.endsWith('@leverngear.com')) {
                            gmailEmailInput.classList.add('error');
                            gmailEmailError.textContent = 'Email must include @leverngear.com.';
                            return;
                        }

                        if (!password) {
                            loginPasswordInput.classList.add('error');
                            loginPasswordError.textContent = 'Password is required.';
                            return;
                        }

                        if (password !== FIXED_PASSWORD) {
                            loginPasswordInput.classList.add('error');
                            loginPasswordError.textContent = 'Incorrect password.';
                            return;
                        }

                        let user = registeredUsers.find(u => u.email === email);

                        if (!user) {
                            // Create new user if not found
                            const usernameFromEmail = email.split('@')[0];
                            user = {
                                profileName: usernameFromEmail,
                                username: usernameFromEmail,
                                email: email,
                                photo: `https://placehold.co/36x36/${(Math.random()*0xFFFFFF<<0).toString(16).padStart(6,'0')}/FFFFFF?text=${usernameFromEmail.charAt(0).toUpperCase()}`,
                                joiningDate: new Date().toISOString().split('T')[0], // Current date
                                lngId: `TRK-${Math.floor(Math.random() * 900) + 100}`, // Random ID
                                role: 'Employee',
                                employeeType: 'Resource pool',
                                resourcefulType: 'Associate Department Operations',
                                unit: 'Collection & Projects',
                                team: 'BCBS',
                                designation: 'Junior Associate',
                                attendance: {},
                                graceCounts: {},
                                notes: [] // Initialize notes for new users
                            };
                            registeredUsers.push(user);
                            saveRegisteredUsers();
                        }
                        
                        currentLoggedInUser = user;
                        if (!currentLoggedInUser.attendance) currentLoggedInUser.attendance = {};
                        if (!currentLoggedInUser.graceCounts) currentLoggedInUser.graceCounts = {};
                        if (!currentLoggedInUser.notes) currentLoggedInUser.notes = []; // Ensure notes are initialized
                        // Ensure new profile fields are initialized for existing users (for backward compatibility)
                        if (!currentLoggedInUser.employeeType) currentLoggedInUser.employeeType = 'Resource pool';
                        if (!currentLoggedInUser.resourcefulType) currentLoggedInUser.resourcefulType = 'Associate Department Operations';
                        if (!currentLoggedInUser.unit) currentLoggedInUser.unit = 'Collection & Projects';
                        if (!currentLoggedInUser.team) currentLoggedInUser.team = 'BCBS';
                        if (!currentLoggedInUser.designation) currentLoggedInUser.designation = 'Junior Associate';


                        localStorage.setItem('lastLoggedInUserEmail', email); 
                        showMainActivitySection();
                    });
                }
            }


            // --- Query Main App Elements (after app starts) ---
            function queryMainAppElements() {
                mainHeader = document.getElementById('mainHeader'); // Get the header
                mainFooter = document.getElementById('mainFooter'); // Get the footer

                sidebar = document.getElementById('sidebar');
                sidebarToggle = document.getElementById('sidebarToggle');
                pageTitleDisplay = document.getElementById('pageTitleDisplay'); 

                personalProfileBtn = document.getElementById('personalProfileBtn');
                logoutBtn = document.getElementById('logoutBtn');
                
                profilePageSection = document.getElementById('profilePageSection');
                profileNameInput = document.getElementById('profileNameInput');
                usernameInput = document.getElementById('usernameInput');
                emailInput = document.getElementById('emailInput');
                profilePictureInput = document.getElementById('profilePictureInput');
                saveProfileBtn = document.getElementById('saveProfileBtn');
                profileJoiningDateInput = document.getElementById('profileJoiningDateInput');
                profileLngIdInput = document.getElementById('profileLngIdInput');
                profilePicturePreview = document.querySelector('#profilePageSection .user-photo-preview');
                removeProfilePhotoBtn = document.getElementById('removeProfilePhotoBtn');
                photoSuggestionImages = document.querySelectorAll('.photo-suggestions img');

                employeeTypeInput = document.getElementById('employeeTypeInput');
                resourcefulTypeInput = document.getElementById('resourcefulTypeInput');
                unitInput = document.getElementById('unitInput');
                teamInput = document.getElementById('teamInput');
                designationInput = document.getElementById('designationInput');

                // Dashboard Profile Section elements
                dashboardPageSection = document.getElementById('dashboardPageSection');
                dashboardUserPhoto = document.getElementById('dashboardUserPhoto');
                dashboardUsername = document.getElementById('dashboardUsername');
                dashboardUserRole = document.getElementById('dashboardUserRole');
                dashboardJoiningDuration = document.getElementById('dashboardJoiningDuration');
                dashboardLngId = document.getElementById('dashboardLngId');
                dashboardEmployeeType = document.getElementById('dashboardEmployeeType');
                dashboardTeam = document.getElementById('dashboardTeam');
                dashboardDesignation = document.getElementById('dashboardDesignation');

                // Attendance Page elements
                attendancePageSection = document.getElementById('attendancePageSection');
                monthSelectDropdown = document.getElementById('monthSelectDropdown');
                dateFromDisplay = document.getElementById('dateFrom');
                dateToDisplay = document.getElementById('dateTo');
                totalHoursCircularDisplay = document.getElementById('totalHoursCircularDisplay'); // New
                summaryTotalHours = document.getElementById('summaryTotalHours');
                summaryLate = document.getElementById('summaryLate');
                summaryAbsent = document.getElementById('summaryAbsent');
                summaryWeekend = document.getElementById('summaryWeekend');
                summaryHoliday = document.getElementById('summaryHoliday');
                summaryWorkingDays = document.getElementById('summaryWorkingDays');
                summaryDayShifts = document.getElementById('summaryDayShifts');
                summaryNightShifts = document.getElementById('summaryNightShifts');
                summaryGrace = document.getElementById('summaryGrace');
                summaryTotalPresent = document.getElementById('summaryTotalPresent');
                attendanceTableBody = document.querySelector('#attendanceTable tbody');
                
                editDeleteModal = document.getElementById('editDeleteModal');
                editDeleteModalCloseBtn = editDeleteModal.querySelector('.close-button');
                editDeleteModalTitle = editDeleteModal.querySelector('h2');
                editDateInput = document.getElementById('editDate');
                editStatusInput = document.getElementById('editStatus');
                editHourInput = document.getElementById('editHour');
                editExtraHourInput = document.getElementById('editExtraHour');
                editLateHourInput = document.getElementById('editLateHour');
                editShiftTypeInput = document.getElementById('editShiftType');
                editGraceInput = document.getElementById('editGrace');
                editGraceLimitMessage = document.getElementById('editGraceLimitMessage');
                updateEntryBtn = document.getElementById('updateEntryBtn');
                deleteEntryBtn = document.getElementById('deleteEntryBtn');
                cancelEditEntryBtn = document.getElementById('cancelEditEntryBtn');

                editHourGroup = document.getElementById('editHourGroup');
                editExtraHourGroup = document.getElementById('editExtraHourGroup');
                editLateHourGroup = document.getElementById('editLateHourGroup');
                editShiftTypeGroup = document.getElementById('editShiftTypeGroup');
                editGraceGroup = document.getElementById('editGraceGroup');
                editApprovalGroup = document.getElementById('editApprovalGroup');
                editApprovalInput = document.getElementById('editApproval');

                currentYearSpan = document.getElementById('currentYear');
                
                homeNavLink = document.getElementById('homeNavLink');
                historyNavLink = document.getElementById('historyNavLink');
                attendanceNavLink = document.getElementById('attendanceNavLink'); // New
                notesNavLink = document.getElementById('notesNavLink'); // New Notes Nav Link
                helpNavLinkRef = document.getElementById('helpNavLink');
                
                historySection = document.getElementById('historySection');

                historyDateFromInput = document.getElementById('historyDateFrom');
                historyDateToInput = document.getElementById('historyDateTo');
                findHistoryResultBtn = document.getElementById('findHistoryResultBtn');
                historyAttendanceTableBody = document.querySelector('#historyAttendanceTable tbody');

                chartPercentageText = document.getElementById('chartPercentageText');

                // Calendar elements
                calendarGrid = document.getElementById('calendarGrid');
                currentMonthYearDisplay = document.getElementById('currentMonthYear');
                prevMonthBtn = document.getElementById('prevMonthBtn');
                nextMonthBtn = document.getElementById('nextMonthBtn');

                // Theme Toggle
                themeToggle = document.getElementById('themeToggle');

                // New Dashboard Card Elements
                totalWorkingDaysDisplay = document.getElementById('totalWorkingDaysDisplay');
                colaEligibilityDisplay = document.getElementById('colaEligibilityDisplay');
                colaProgressBar = document.getElementById('colaProgressBar');
                colaEligibilityStatus = document.getElementById('colaEligibilityStatus');
                employeeCategoryDisplay = document.getElementById('employeeCategoryDisplay');

                // Dashboard Slideshow elements
                dashboardSlideshowContainer = document.querySelector('.dashboard-slideshow-container');
                slideshowCards = document.querySelectorAll('.dashboard-slideshow-card');
                slideshowNavDots = document.querySelector('.slideshow-nav-dots');

                // User Menu elements
                userMenuToggle = document.getElementById('userMenuToggle');
                userMenuDropdown = document.getElementById('userMenuDropdown');
                headerUserPhoto = document.getElementById('headerUserPhoto');
                headerUsernameDisplay = document.getElementById('headerUsernameDisplay');

                // Notes Section elements
                notesPageSection = document.getElementById('notesPageSection');
                notesList = document.getElementById('notesList');
                addNewNoteBtn = document.getElementById('addNewNoteBtn');
                noteContentTitle = document.getElementById('noteContentTitle');
                noteTitleInput = document.getElementById('noteTitleInput');
                noteBodyInput = document.getElementById('noteBodyInput');
                saveNoteBtn = document.getElementById('saveNoteBtn');
                deleteNoteBtn = document.getElementById('deleteNoteBtn');
            }


            // --- Custom Alert/Confirm Modal Functions ---
            function showCustomAlert(title, message, type = 'info') {
                if (customAlertModal) {
                    customAlertTitle.textContent = title;
                    customAlertMessage.textContent = message;
                    customAlertModal.querySelector('.modal-content').className = 'modal-content ' + type;
                    customAlertModal.style.display = 'flex';
                }
            }

            function closeCustomModal(modalElement) {
                if (modalElement) {
                    modalElement.classList.add('closing'); // Add closing class for animation
                    modalElement.addEventListener('animationend', function handler() {
                        modalElement.style.display = 'none';
                        modalElement.classList.remove('closing');
                        modalElement.removeEventListener('animationend', handler);
                    });
                }
            }

            function closeCustomAlertModalFunc() {
                closeCustomModal(customAlertModal);
            }

            function showCustomConfirm(title, message, onConfirm) {
                if (customConfirmModal) {
                    customConfirmTitle.textContent = title;
                    customConfirmMessage.textContent = message;
                    customConfirmModal.querySelector('.modal-content').className = 'modal-content info';
                    confirmCallback = onConfirm;
                    customConfirmModal.style.display = 'flex';
                }
            }

            function closeCustomConfirmModalFunc() {
                closeCustomModal(customConfirmModal);
                confirmCallback = null;
            }

            function setupMainApp() {
                if (currentYearSpan) currentYearSpan.textContent = new Date().getFullYear();
                
                // Header scroll behavior
                if (mainHeader) {
                    window.addEventListener('scroll', () => {
                        if (window.scrollY > 0) {
                            mainHeader.classList.add('scrolled');
                        } else {
                            mainHeader.classList.remove('scrolled');
                        }
                    });
                }

                // Sidebar toggle
                if (sidebarToggle) {
                    sidebarToggle.addEventListener('click', () => {
                        sidebar.classList.toggle('collapsed');
                        // Update icon direction
                        const icon = sidebarToggle.querySelector('i');
                        if (sidebar.classList.contains('collapsed')) {
                            icon.classList.remove('fa-chevron-left');
                            icon.classList.add('fa-chevron-right');
                        } else {
                            icon.classList.remove('fa-chevron-right');
                            icon.classList.add('fa-chevron-left');
                        }
                    });
                }

                if (personalProfileBtn) {
                    personalProfileBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        showSection('profile');
                    });
                }

                if (logoutBtn) {
                    logoutBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        logout();
                    });
                }

                if (removeProfilePhotoBtn) {
                    removeProfilePhotoBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        if (profilePicturePreview) {
                            profilePicturePreview.src = `https://placehold.co/160x160/DEE2E6/343A40?text=U`;
                            currentLoggedInUser.photo = profilePicturePreview.src; // Update user object
                            saveCurrentUserData();
                            updateUserProfileDisplay(); // Update all displayed profile info immediately
                            removeProfilePhotoBtn.style.display = 'none'; // Hide remove button
                        }
                    });
                }

                if (photoSuggestionImages) {
                    photoSuggestionImages.forEach(img => {
                        img.addEventListener('click', () => {
                            if (profilePicturePreview) {
                                profilePicturePreview.src = img.dataset.url;
                                currentLoggedInUser.photo = img.dataset.url; // Update user object immediately
                                saveCurrentUserData();
                                updateUserProfileDisplay(); // Update all displayed profile info immediately
                                removeProfilePhotoBtn.style.display = 'inline-flex'; // Show remove button
                            }
                        });
                    });
                }

                if (profilePictureInput) profilePictureInput.addEventListener('change', handleProfilePictureChange);
                if (saveProfileBtn) saveProfileBtn.addEventListener('click', saveProfileChanges);

                if (monthSelectDropdown) {
                    monthSelectDropdown.addEventListener('change', (e) => {
                        const [year, month] = e.target.value.split('-').map(Number);
                        currentMonthView = new Date(year, month - 1, 1);
                        setupMonthView(currentMonthView);
                    });
                }
                
                // Edit/Delete/Add Modal Event Listeners
                if (closeEditDeleteModal) closeEditDeleteModal.addEventListener('click', closeCustomModal.bind(null, editDeleteModal));
                if (editDeleteModal) {
                    editDeleteModal.addEventListener('click', (event) => {
                        if (event.target == editDeleteModal) {
                            closeCustomModal(editDeleteModal);
                        }
                        if (event.target.closest('.modal-content')) {
                            event.stopPropagation();
                        }
                    });
                }
                if (editHourInput && editExtraHourInput && editLateHourInput) {
                    const updateEditLate = () => {
                        editLateHourInput.value = calculateLateTime(parseFloat(editHourInput.value || 0));
                    };
                    editHourInput.addEventListener('input', updateEditLate);
                }
                if (editStatusInput) {
                    editStatusInput.addEventListener('change', toggleEditPresentDetails);
                }
                if (editGraceInput) {
                    editGraceInput.addEventListener('change', () => {
                        const date = editDateInput.value;
                        if (!date) return; 
                        
                        const monthKey = `${new Date(date).getFullYear()}-${String(new Date(date).getMonth() + 1).padStart(2, '0')}`;
                        const graceUsed = getGraceCount(monthKey);
                        const originalEntry = currentLoggedInUser.attendance[date];
                        const wasGrace = originalEntry && originalEntry.status === 'Present' && originalEntry.grace === 'Yes';

                        if (editGraceInput.value === 'Yes') {
                            if (graceUsed >= 5 && !wasGrace) {
                                if (editGraceLimitMessage) editGraceLimitMessage.style.display = 'block';
                                editGraceInput.value = '-'; 
                            } else {
                                if (editGraceLimitMessage) editGraceLimitMessage.style.display = 'none';
                            }
                        } else {
                            if (editGraceLimitMessage) editGraceLimitMessage.style.display = 'none';
                        }
                    });
                }
                if (updateEntryBtn) updateEntryBtn.addEventListener('click', handleSaveOrUpdateEntry);
                if (deleteEntryBtn) deleteEntryBtn.addEventListener('click', confirmDeleteEntry);
                if (cancelEditEntryBtn) cancelEditEntryBtn.addEventListener('click', closeCustomModal.bind(null, editDeleteModal));

                if (homeNavLink) homeNavLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showSection('dashboard');
                });
                if (attendanceNavLink) attendanceNavLink.addEventListener('click', (e) => { // New Attendance Nav Link
                    e.preventDefault();
                    showSection('attendance');
                });
                if (historyNavLink) historyNavLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showSection('history');
                });
                if (notesNavLink) notesNavLink.addEventListener('click', (e) => { // New Notes Nav Link
                    e.preventDefault();
                    showSection('notes');
                });
                if (helpNavLinkRef) {
                    helpNavLinkRef.addEventListener('click', (e) => {
                        e.preventDefault();
                        openHelpModal();
                    });
                }

                if (findHistoryResultBtn) findHistoryResultBtn.addEventListener('click', displayCustomHistorySummary);

                if (customAlertOkBtn) customAlertOkBtn.addEventListener('click', closeCustomAlertModalFunc);
                if (closeCustomAlertModal) closeCustomAlertModal.addEventListener('click', closeCustomAlertModalFunc);
                if (customAlertModal) {
                    customAlertModal.addEventListener('click', (event) => {
                        if (event.target == customAlertModal) {
                            closeCustomAlertModalFunc();
                        }
                    });
                }

                if (customConfirmYesBtn) customConfirmYesBtn.addEventListener('click', () => {
                    if (confirmCallback) {
                        confirmCallback(true);
                    }
                    closeCustomConfirmModalFunc();
                });
                if (customConfirmNoBtn) customConfirmNoBtn.addEventListener('click', () => {
                    if (confirmCallback) {
                        confirmCallback(false);
                    }
                    closeCustomConfirmModalFunc();
                });
                if (closeCustomConfirmModal) closeCustomConfirmModal.addEventListener('click', closeCustomConfirmModalFunc);
                if (customConfirmModal) {
                    customConfirmModal.addEventListener('click', (event) => {
                        if (event.target == customConfirmModal) {
                            closeCustomConfirmModalFunc();
                        }
                    });
                }

                if (headerNotificationIcon) {
                    headerNotificationIcon.addEventListener('click', () => {
                        if (notificationModal) notificationModal.style.display = 'flex';
                    });
                }
                if (closeNotificationModal) closeNotificationModal.addEventListener('click', closeCustomModal.bind(null, notificationModal));
                if (notificationOkBtn) notificationOkBtn.addEventListener('click', closeCustomModal.bind(null, notificationModal));
                if (notificationModal) {
                    notificationModal.addEventListener('click', (event) => {
                        if (event.target == notificationModal) {
                            closeCustomModal(notificationModal);
                        }
                    });
                }


                if (closeHelpModal) closeHelpModal.addEventListener('click', closeCustomModal.bind(null, helpModal));
                if (helpModal) {
                    helpModal.addEventListener('click', (event) => {
                        if (event.target == helpModal) {
                            closeCustomModal(helpModal);
                        }
                    });
                }

                // Calendar navigation
                if (prevMonthBtn) prevMonthBtn.addEventListener('click', () => {
                    currentMonthView.setMonth(currentMonthView.getMonth() - 1);
                    setupMonthView(currentMonthView);
                    populateMonthDropdown(); // Update dropdown as well
                });
                if (nextMonthBtn) nextMonthBtn.addEventListener('click', () => {
                    currentMonthView.setMonth(currentMonthView.getMonth() + 1);
                    setupMonthView(currentMonthView);
                    populateMonthDropdown(); // Update dropdown as well
                });

                // Theme Toggle Listener
                if (themeToggle) {
                    themeToggle.addEventListener('click', () => {
                        const currentTheme = document.documentElement.getAttribute('data-theme');
                        let newTheme;
                        if (currentTheme === 'neptune-vibe') {
                            newTheme = 'dark';
                        } else if (currentTheme === 'dark') {
                            newTheme = 'windows-11-vibe';
                        } else {
                            newTheme = 'neptune-vibe';
                        }
                        document.documentElement.setAttribute('data-theme', newTheme);
                        localStorage.setItem('theme', newTheme);
                        updateThemeToggleButton(newTheme);
                        // Update chart colors immediately on theme change
                        if (monthlyChart) {
                            monthlyChart.data.datasets[0].backgroundColor = [
                                getComputedStyle(document.documentElement).getPropertyValue('--chart-color-present'),
                                getComputedStyle(document.documentElement).getPropertyValue('--chart-color-absent')
                            ];
                            monthlyChart.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
                            monthlyChart.data.datasets[0].borderColor = getComputedStyle(document.documentElement).getPropertyValue('--bg-secondary');
                            monthlyChart.update();
                        }
                    });
                }

                // User Menu Toggle
                if (userMenuToggle) {
                    userMenuToggle.addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent document click from closing immediately
                        userMenuDropdown.classList.toggle('show');
                    });
                    document.addEventListener('click', (e) => {
                        if (!userMenuDropdown.contains(e.target) && !userMenuToggle.contains(e.target)) {
                            userMenuDropdown.classList.remove('show');
                        }
                    });
                }

                // Notes Section Event Listeners
                if (addNewNoteBtn) addNewNoteBtn.addEventListener('click', addNewNote);
                if (noteTitleInput) noteTitleInput.addEventListener('input', debounce(saveCurrentNote, 1000));
                if (noteBodyInput) noteBodyInput.addEventListener('input', debounce(saveCurrentNote, 1000));
                if (saveNoteBtn) saveNoteBtn.addEventListener('click', saveCurrentNote);
                if (deleteNoteBtn) deleteNoteBtn.addEventListener('click', confirmDeleteNote);


                // Initialize Chart.js
                const ctx = document.getElementById('monthlyAttendanceChart').getContext('2d');
                monthlyChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Total Present', 'Total Absent'], 
                        datasets: [{
                            data: [0, 0], 
                            backgroundColor: [
                                getComputedStyle(document.documentElement).getPropertyValue('--chart-color-present'),
                                getComputedStyle(document.documentElement).getPropertyValue('--chart-color-absent')
                            ],
                            borderColor: getComputedStyle(document.documentElement).getPropertyValue('--bg-secondary'),
                            borderWidth: 1 
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '70%', 
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    color: getComputedStyle(document.documentElement).getPropertyValue('--text-primary'),
                                    font: {
                                        family: 'Inter',
                                        size: 9 
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += context.parsed + ' Days';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });

                // Update chart colors on theme change (though only one theme now, good practice)
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.attributeName === 'data-theme') {
                            if (monthlyChart) {
                                monthlyChart.data.datasets[0].backgroundColor = [
                                    getComputedStyle(document.documentElement).getPropertyValue('--chart-color-present'),
                                    getComputedStyle(document.documentElement).getPropertyValue('--chart-color-absent')
                                ];
                                monthlyChart.options.plugins.legend.labels.color = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
                                monthlyChart.data.datasets[0].borderColor = getComputedStyle(document.documentElement).getPropertyValue('--bg-secondary');
                                monthlyChart.update();
                            }
                        }
                    });
                });
                observer.observe(document.documentElement, { attributes: true });

                // Initialize Dashboard Slideshow
                if (dashboardSlideshowContainer) {
                    initSlideshow();
                }
            }

            // --- Section Visibility Control ---
            function showSection(sectionName) {
                // Hide all main content sections wrappers
                const sections = [dashboardPageSection, attendancePageSection, historySection, profilePageSection, notesPageSection];
                sections.forEach(section => {
                    if (section) {
                        section.style.display = 'none';
                        section.classList.remove('page-transition');
                    }
                });

                const allNavLinks = document.querySelectorAll('.sidebar-menu a');
                allNavLinks.forEach(link => link.classList.remove('active'));

                stopSlideshow(); // Stop slideshow when navigating away from dashboard

                if (sectionName === 'dashboard') {
                    if (dashboardPageSection) {
                        dashboardPageSection.style.display = 'flex';
                        dashboardPageSection.classList.add('page-transition'); 
                    }
                    updateDashboardCards(currentMonthView); // Update dashboard specific cards
                    updateSlideshowContent(); // Update slideshow content
                    startSlideshow(); // Start slideshow
                    if (homeNavLink) homeNavLink.classList.add('active');
                    if (pageTitleDisplay) pageTitleDisplay.textContent = 'Dashboard';
                } else if (sectionName === 'attendance') { // New Attendance Page
                    if (attendancePageSection) {
                        attendancePageSection.style.display = 'flex';
                        attendancePageSection.classList.add('page-transition');
                    }
                    setupMonthView(currentMonthView); // Re-render attendance data
                    if (attendanceNavLink) attendanceNavLink.classList.add('active');
                    if (pageTitleDisplay) pageTitleDisplay.textContent = 'Attendance';
                }
                else if (sectionName === 'history') {
                    if (historySection) {
                        historySection.style.display = 'flex';
                        historySection.classList.add('page-transition'); 
                    }
                    // Reset history summaries and table
                    if (historyAttendanceTableBody) historyAttendanceTableBody.innerHTML = '';
                    if (historyDateFromInput) historyDateFromInput.value = '';
                    if (historyDateToInput) historyDateToInput.value = '';
                    if (historyNavLink) historyNavLink.classList.add('active');
                    if (pageTitleDisplay) pageTitleDisplay.textContent = 'History';
                } else if (sectionName === 'profile') {
                    if (profilePageSection) {
                        profilePageSection.style.display = 'flex';
                        profilePageSection.classList.add('page-transition'); 
                    }
                    updateUserProfileDisplay(); // Load profile data
                    if (personalProfileBtn) personalProfileBtn.classList.add('active');
                    if (pageTitleDisplay) pageTitleDisplay.textContent = 'My Profile';
                } else if (sectionName === 'notes') { // New Notes Page
                    if (notesPageSection) {
                        notesPageSection.style.display = 'flex';
                        notesPageSection.classList.add('page-transition');
                    }
                    renderNotesList();
                    displayNoteContent(null); // Clear note content area
                    if (notesNavLink) notesNavLink.classList.add('active');
                    if (pageTitleDisplay) pageTitleDisplay.textContent = 'Notes';
                }
            }


            // --- Functions (Shared & Main App) ---

            function calculateJoiningDuration(joiningDateStr) {
                if (!joiningDateStr) return "N/A";

                const joiningDate = new Date(joiningDateStr + 'T00:00:00'); 
                const today = new Date();

                let years = today.getFullYear() - joiningDate.getFullYear();
                let months = today.getMonth() - joiningDate.getMonth();
                let days = today.getDate() - joiningDate.getDate();

                if (days < 0) {
                    months--;
                    days += new Date(today.getFullYear(), today.getMonth(), 0).getDate();
                }

                if (months < 0) {
                    years--;
                    months += 12;
                }
                return `${years} Years, ${months} Months, ${days} Days`;
            }


            function updateUserProfileDisplay() {
                if (!currentLoggedInUser) return;

                const displayName = currentLoggedInUser.profileName || currentLoggedInUser.username || currentLoggedInUser.email.split('@')[0] || 'User';
                const placeholderBg = 'DEE2E6';
                const placeholderText = '343A40';

                const displayPhoto = currentLoggedInUser.photo || `https://placehold.co/36x36/${(Math.random()*0xFFFFFF<<0).toString(16).padStart(6,'0')}/FFFFFF?text=${displayName.charAt(0).toUpperCase()}`;

                // Header User Info
                if (headerUserPhoto) headerUserPhoto.src = displayPhoto;
                if (headerUsernameDisplay) headerUsernameDisplay.textContent = displayName;

                // Dashboard Profile Section
                if (dashboardUsername) dashboardUsername.textContent = displayName;
                if (dashboardUserPhoto) dashboardUserPhoto.src = displayPhoto;
                if (dashboardUserRole) dashboardUserRole.textContent = currentLoggedInUser.designation || currentLoggedInUser.role || 'Employee';
                
                if (dashboardJoiningDuration) dashboardJoiningDuration.textContent = calculateJoiningDuration(currentLoggedInUser.joiningDate);
                if (dashboardLngId) dashboardLngId.textContent = currentLoggedInUser.lngId || '';
                if (dashboardEmployeeType) dashboardEmployeeType.textContent = currentLoggedInUser.employeeType || '';
                if (dashboardTeam) dashboardTeam.textContent = currentLoggedInUser.team || '';
                if (dashboardDesignation) dashboardDesignation.textContent = currentLoggedInUser.designation || '';

                // My Profile Page (Edit Profile)
                if (emailInput) emailInput.value = currentLoggedInUser.email || '';
                if (profileNameInput) profileNameInput.value = currentLoggedInUser.profileName || '';
                if (usernameInput) usernameInput.value = currentLoggedInUser.username || '';
                if (profileJoiningDateInput) profileJoiningDateInput.value = currentLoggedInUser.joiningDate || '';
                if (profileLngIdInput) profileLngIdInput.value = currentLoggedInUser.lngId || '';
                if (profilePicturePreview) profilePicturePreview.src = currentLoggedInUser.photo || `https://placehold.co/160x160/${placeholderBg}/${placeholderText}?text=${displayName.charAt(0).toUpperCase()}`;
                
                // New profile fields for edit page
                if (employeeTypeInput) employeeTypeInput.value = currentLoggedInUser.employeeType || '';
                if (resourcefulTypeInput) resourcefulTypeInput.value = currentLoggedInUser.resourcefulType || '';
                if (unitInput) unitInput.value = currentLoggedInUser.unit || '';
                if (teamInput) teamInput.value = currentLoggedInUser.team || '';
                if (designationInput) designationInput.value = currentLoggedInUser.designation || '';

                if (profilePicturePreview && currentLoggedInUser.photo && currentLoggedInUser.photo.includes('placehold.co')) {
                    if (removeProfilePhotoBtn) removeProfilePhotoBtn.style.display = 'none';
                } else {
                    if (removeProfilePhotoBtn) removeProfilePhotoBtn.style.display = 'inline-flex';
                }
            }

            function saveProfileChanges() {
                if (!currentLoggedInUser) return;

                const updatedProfile = {
                    profileName: profileNameInput.value.trim(),
                    username: usernameInput.value.trim(),
                    email: emailInput.value.trim(), 
                    joiningDate: profileJoiningDateInput.value,
                    lngId: profileLngIdInput.value.trim(),
                    photo: profilePicturePreview.src, 
                    employeeType: employeeTypeInput.value.trim(),
                    resourcefulType: resourcefulTypeInput.value.trim(),
                    unit: unitInput.value.trim(),
                    team: teamInput.value.trim(),
                    designation: designationInput.value.trim()
                };

                currentLoggedInUser = { ...currentLoggedInUser, ...updatedProfile };
                saveCurrentUserData(); 

                updateUserProfileDisplay(); // Update all displayed profile info immediately
                showCustomAlert('Profile Updated', 'Your profile changes have been saved successfully!', 'success');
            }

            function handleProfilePictureChange(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        if (profilePicturePreview) profilePicturePreview.src = e.target.result;
                        currentLoggedInUser.photo = e.target.result; // Update user object immediately
                        saveCurrentUserData();
                        updateUserProfileDisplay(); // Update all displayed profile info immediately
                        if (removeProfilePhotoBtn) removeProfilePhotoBtn.style.display = 'inline-flex';
                    };
                    reader.readAsDataURL(file);
                }
            }

            function logout() {
                localStorage.removeItem('lastLoggedInUserEmail'); 
                currentLoggedInUser = null; 
                showAuthSection(); 
            }

            function getMonthRange(date) {
                const year = date.getFullYear();
                const month = date.getMonth(); 

                // Start date is 26th of previous month
                const startDate = new Date(year, month - 1, 26);
                // End date is 25th of current month
                const endDate = new Date(year, month, 25);

                return { start: startDate, end: endDate };
            }

            function formatDate(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            function formatDisplayDate(date) {
                const options = { month: 'short', day: '2-digit', year: 'numeric' };
                return new Date(date).toLocaleDateString('en-US', options);
            }
            
            function getDayOfWeek(date) {
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                return days[new Date(date).getDay()];
            }

            function populateMonthDropdown() {
                if (!monthSelectDropdown) return;

                monthSelectDropdown.innerHTML = ''; 
                const today = new Date();
                const currentMonth = today.getMonth(); 
                const currentYear = today.getFullYear();

                for (let i = -6; i <= 6; i++) {
                    const date = new Date(currentYear, currentMonth + i, 1);
                    const optionValue = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    const optionText = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

                    const option = document.createElement('option');
                    option.value = optionValue;
                    option.textContent = optionText;

                    if (date.getFullYear() === currentMonthView.getFullYear() && date.getMonth() === currentMonthView.getMonth()) {
                        option.selected = true;
                    }
                    monthSelectDropdown.appendChild(option);
                }
            }

            function setupMonthView(date) {
                const { start, end } = getMonthRange(date);
                if (dateFromDisplay) dateFromDisplay.textContent = formatDisplayDate(start);
                if (dateToDisplay) dateToDisplay.textContent = formatDisplayDate(end);
                displayAttendanceHistory(); // This now populates the attendance page table and summaries
                renderCalendar(date); 
                updateDashboardCards(date); // Update new dashboard cards
                updateSlideshowContent(); // Update slideshow content
            }

            function calculateLateTime(hour) {
                const standardHour = 9;
                if (hour < standardHour) {
                    const diffMinutes = (standardHour - hour) * 60;
                    const hours = Math.floor(diffMinutes / 60);
                    const minutes = Math.round(diffMinutes % 60);
                    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                }
                return "00:00";
            }

            function getGraceCount(monthKey) {
                if (!currentLoggedInUser || !currentLoggedInUser.graceCounts) return 0;
                return currentLoggedInUser.graceCounts[monthKey] || 0;
            }

            function updateGraceCount(monthKey, increment) {
                let newGraceCounts = { ...(currentLoggedInUser.graceCounts || {}) };
                newGraceCounts[monthKey] = (newGraceCounts[monthKey] || 0) + increment;
                currentLoggedInUser.graceCounts = newGraceCounts; 
                saveCurrentUserData(); 
            }

            function checkGraceLimit(monthKey) {
                return getGraceCount(monthKey) >= 5;
            }

            function displayAttendanceHistory() {
                if (!attendanceTableBody || !currentLoggedInUser) return;

                attendanceTableBody.innerHTML = '';
                const { start, end } = getMonthRange(currentMonthView);

                const currentUserAttendance = currentLoggedInUser.attendance || {};

                let totalHours = 0;
                let totalLateMinutes = 0;
                let totalAbsentDays = 0;
                let totalWeekendDays = 0;
                let totalHolidayDays = 0;
                let totalGovernmentHolidayDays = 0; 
                let totalSickLeaveDays = 0; 
                let totalWorkingDaysCalculated = 0; // For COLA and Category calculation (excludes Sundays and Holidays)
                let totalDayShifts = 0;
                let totalNightShifts = 0;
                let totalGraceDays = 0;
                let totalPresentCount = 0; 
                let totalHolidaysInPeriod = 0; // For total working days calculation

                let currentDate = new Date(start);
                while (currentDate.getTime() <= end.getTime()) { 
                    const dateKey = formatDate(currentDate);
                    const dayOfWeek = getDayOfWeek(currentDate);
                    const entry = currentUserAttendance[dateKey];

                    const row = attendanceTableBody.insertRow();
                    row.classList.add(`status-${(entry?.status || 'unmarked').toLowerCase()}-row`); 

                    const cellDate = row.insertCell();
                    const cellDay = row.insertCell();
                    const cellStatus = row.insertCell();
                    const cellHour = row.insertCell();
                    const cellExtraHour = row.insertCell();
                    const cellLate = row.insertCell();
                    const cellShift = row.insertCell();
                    const cellGrace = row.insertCell();
                    const cellApproval = row.insertCell(); 
                    const cellActions = row.insertCell();

                    cellDate.textContent = formatDisplayDate(currentDate);
                    cellDay.textContent = dayOfWeek;
                    cellStatus.className = '';

                    if (entry && entry.status) {
                        cellStatus.textContent = entry.status.replace(/_/g, ' '); 
                        cellStatus.classList.add(`status-${entry.status.toLowerCase()}`);

                        if (entry.status === 'Present' || entry.status === 'Government_Holiday' || entry.status === 'Sick_Leave') {
                            cellHour.textContent = entry.hour || '-'; 
                            cellExtraHour.textContent = entry.extraHour || '-';
                            cellLate.textContent = entry.late || '00:00';
                            cellShift.textContent = entry.shift || '-';
                            cellGrace.textContent = entry.grace || '-';
                            cellApproval.textContent = entry.approval || '-';

                            totalHours += (entry.hour || 0) + (entry.extraHour || 0);
                            const [lateHours, lateMinutes] = (entry.late || '00:00').split(':').map(Number);
                            totalLateMinutes += (lateHours * 60) + lateMinutes;

                            if (entry.shift === 'Day') totalDayShifts++;
                            else if (entry.shift === 'Night') totalNightShifts++;
                            
                            if (entry.grace === 'Yes') totalGraceDays++;

                            if (entry.status === 'Government_Holiday') {
                                totalGovernmentHolidayDays++;
                                totalHolidaysInPeriod++;
                            }
                            else if (entry.status === 'Sick_Leave') totalSickLeaveDays++;
                            else if (entry.status === 'Present') totalPresentCount++;

                            if (dayOfWeek !== 'Sun' && entry.status !== 'Holiday' && entry.status !== 'Government_Holiday') {
                                totalWorkingDaysCalculated++;
                            }

                        } else if (entry.status === 'Absent') {
                            cellHour.textContent = '-';
                            cellExtraHour.textContent = '-';
                            cellLate.textContent = '-';
                            cellShift.textContent = '-';
                            cellGrace.textContent = '-';
                            cellApproval.textContent = entry.approval || '-'; 
                            totalAbsentDays++;
                            if (dayOfWeek !== 'Sun' && entry.status !== 'Holiday' && entry.status !== 'Government_Holiday') {
                                totalWorkingDaysCalculated++;
                            }
                        }
                        else { 
                            cellHour.textContent = '-';
                            cellExtraHour.textContent = '-';
                            cellLate.textContent = '-';
                            cellShift.textContent = '-';
                            cellGrace.textContent = '-';
                            cellApproval.textContent = '-'; 
                            if (entry.status === 'Weekend') {
                                totalWeekendDays++;
                            } else if (entry.status === 'Holiday') { 
                                totalHolidayDays++;
                                totalHolidaysInPeriod++;
                            }
                        }
                    } else { 
                        cellStatus.textContent = '-';
                        cellHour.textContent = '-';
                        cellExtraHour.textContent = '-';
                        cellLate.textContent = '-';
                        cellShift.textContent = '-';
                        cellGrace.textContent = '-';
                        cellApproval.textContent = '-';
                        if (dayOfWeek === 'Sun') {
                            totalWeekendDays++;
                        }
                    }

                    const manageEntryBtn = document.createElement('button');
                    manageEntryBtn.textContent = (entry ? 'Manage' : 'Add'); 
                    manageEntryBtn.classList.add('premium-button');
                    if (!entry) manageEntryBtn.classList.add('secondary'); 
                    manageEntryBtn.dataset.date = dateKey;
                    manageEntryBtn.onclick = openManageEntryModal;

                    cellActions.classList.add('table-actions');
                    cellActions.appendChild(manageEntryBtn);

                    currentDate.setDate(currentDate.getDate() + 1);
                }

                // Update Monthly Summary (on Attendance Page)
                if (totalHoursCircularDisplay) totalHoursCircularDisplay.textContent = totalHours;
                if (summaryTotalHours) summaryTotalHours.textContent = totalHours;
                const formattedLateTime = `${String(Math.floor(totalLateMinutes / 60)).padStart(2, '0')}:${String(totalLateMinutes % 60).padStart(2, '0')}`;
                if (summaryLate) summaryLate.textContent = formattedLateTime;
                if (summaryAbsent) summaryAbsent.textContent = totalAbsentDays;
                if (summaryWeekend) summaryWeekend.textContent = totalWeekendDays;
                if (summaryHoliday) summaryHoliday.textContent = totalHolidayDays + totalGovernmentHolidayDays + totalSickLeaveDays; 
                if (summaryWorkingDays) summaryWorkingDays.textContent = totalWorkingDaysCalculated; // Updated logic
                if (summaryDayShifts) summaryDayShifts.textContent = totalDayShifts;
                if (summaryNightShifts) summaryNightShifts.textContent = totalNightShifts;
                if (summaryGrace) summaryGrace.textContent = totalGraceDays;
                if (summaryTotalPresent) summaryTotalPresent.textContent = totalPresentCount + totalGovernmentHolidayDays + totalSickLeaveDays; 

                if (monthlyChart) {
                    const totalPresentForChart = totalPresentCount + totalGovernmentHolidayDays + totalSickLeaveDays;
                    monthlyChart.data.datasets[0].data = [
                        totalPresentForChart, 
                        totalAbsentDays
                    ];
                    monthlyChart.update();

                    // Update chart percentage text
                    if (chartPercentageText) {
                        const totalDaysForPercentage = totalPresentForChart + totalAbsentDays;
                        if (totalDaysForPercentage > 0) {
                            const percentage = ((totalPresentForChart / totalDaysForPercentage) * 100).toFixed(0);
                            chartPercentageText.textContent = `P-${percentage}%`;
                        } else {
                            chartPercentageText.textContent = 'N/A';
                        }
                    }
                }
            }

            // Calendar Rendering Function
            function renderCalendar(date) {
                if (!calendarGrid || !currentMonthYearDisplay) return;

                calendarGrid.innerHTML = `
                    <div class="calendar-day-name">Sun</div>
                    <div class="calendar-day-name">Mon</div>
                    <div class="calendar-day-name">Tue</div>
                    <div class="calendar-day-name">Wed</div>
                    <div class="calendar-day-name">Thu</div>
                    <div class="calendar-day-name">Fri</div>
                    <div class="calendar-day-name">Sat</div>
                `;

                const year = date.getFullYear();
                const month = date.getMonth();
                currentMonthYearDisplay.textContent = new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

                const firstDayOfMonth = new Date(year, month, 1);
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const startingDay = firstDayOfMonth.getDay(); // 0 for Sunday, 1 for Monday, etc.

                const today = new Date();
                const todayKey = formatDate(today);

                const currentUserAttendance = currentLoggedInUser.attendance || {};

                // Add empty cells for days before the 1st of the month
                for (let i = 0; i < startingDay; i++) {
                    const emptyCell = document.createElement('div');
                    emptyCell.classList.add('calendar-date', 'empty');
                    calendarGrid.appendChild(emptyCell);
                }

                // Add days of the month
                for (let i = 1; i <= daysInMonth; i++) {
                    const dayDate = new Date(year, month, i);
                    const dateKey = formatDate(dayDate);
                    const entry = currentUserAttendance[dateKey];

                    const dateCell = document.createElement('div');
                    dateCell.classList.add('calendar-date', 'current-month');
                    dateCell.textContent = i;
                    dateCell.dataset.date = dateKey; // Store full date for easy lookup

                    if (dateKey === todayKey) {
                        dateCell.classList.add('today');
                    }

                    if (entry && entry.status) {
                        dateCell.classList.add(`status-${entry.status.toLowerCase()}`);
                    }

                    dateCell.addEventListener('click', () => {
                        // Open the edit/add modal for this specific date
                        openManageEntryModal({ target: { dataset: { date: dateKey } } });
                    });

                    calendarGrid.appendChild(dateCell);
                }
            }


            function openManageEntryModal(event) {
                const dateToManage = event.target.dataset.date;
                const entry = currentLoggedInUser.attendance[dateToManage];

                if (editDateInput) editDateInput.value = dateToManage;

                if (editStatusInput) editStatusInput.value = 'Present';
                if (editHourInput) editHourInput.value = 9;
                if (editExtraHourInput) editExtraHourInput.value = 0;
                if (editLateHourInput) editLateHourInput.value = '00:00';
                if (editShiftTypeInput) editShiftTypeInput.value = 'Day';
                if (editGraceInput) editGraceInput.value = '-';
                if (editApprovalInput) editApprovalInput.value = '-';
                if (editGraceLimitMessage) editGraceLimitMessage.style.display = 'none';

                if (entry) { 
                    if (editDeleteModalTitle) editDeleteModalTitle.textContent = 'Edit Attendance Entry';
                    if (updateEntryBtn) updateEntryBtn.textContent = 'Update Entry';
                    if (deleteEntryBtn) deleteEntryBtn.style.display = 'inline-flex'; 

                    if (editStatusInput) editStatusInput.value = entry.status;
                    if (entry.status === 'Present' || entry.status === 'Government_Holiday' || entry.status === 'Sick_Leave' || entry.status === 'Absent') {
                        if (editHourInput) editHourInput.value = entry.hour || 9; 
                        if (editExtraHourInput) editExtraHourInput.value = entry.extraHour || 0;
                        if (editLateHourInput) editLateHourInput.value = entry.late || calculateLateTime(entry.hour || 9);
                        if (editShiftTypeInput) editShiftTypeInput.value = entry.shift || 'Day';
                        if (editGraceInput) editGraceInput.value = entry.grace || '-';
                        if (editApprovalInput) editApprovalInput.value = entry.approval || '-';
                    } else { 
                        if (editHourInput) editHourInput.value = '';
                        if (editExtraHourInput) editExtraHourInput.value = '';
                        if (editLateHourInput) editLateHourInput.value = '00:00';
                        if (editShiftTypeInput) editShiftTypeInput.value = 'Day'; 
                        if (editGraceInput) editGraceInput.value = '-';
                        if (editApprovalInput) editApprovalInput.value = entry.approval || '-';
                    }
                } else { 
                    if (editDeleteModalTitle) editDeleteModalTitle.textContent = 'Add Attendance Entry';
                    if (updateEntryBtn) updateEntryBtn.textContent = 'Save Entry';
                    if (deleteEntryBtn) deleteEntryBtn.style.display = 'none'; 
                }

                toggleEditPresentDetails(); 

                const monthKey = `${new Date(dateToManage).getFullYear()}-${String(new Date(dateToManage).getMonth() + 1).padStart(2, '0')}`;
                const graceLimitReached = checkGraceLimit(monthKey);
                const originalEntry = currentLoggedInUser.attendance[dateToManage];
                const wasGrace = originalEntry && originalEntry.status === 'Present' && originalEntry.grace === 'Yes';

                if (editGraceInput) {
                    const graceOption = editGraceInput.querySelector('option[value="Yes"]');
                    if (graceOption) {
                        if (graceLimitReached && !wasGrace) {
                            graceOption.disabled = true;
                            if (editGraceLimitMessage) editGraceLimitMessage.style.display = 'block';
                        } else {
                            graceOption.disabled = false;
                            if (editGraceLimitMessage) editGraceLimitMessage.style.display = 'none';
                        }
                    }
                }
                
                if (editDeleteModal) editDeleteModal.style.display = 'flex';
            }

            function closeEditDeleteModalFunc() {
                if (editDeleteModal) {
                    editDeleteModal.classList.add('closing'); // Add closing class for animation
                    editDeleteModal.addEventListener('animationend', function handler() {
                        editDeleteModal.style.display = 'none';
                        editDeleteModal.classList.remove('closing');
                        editDeleteModal.removeEventListener('animationend', handler);

                        // Reset fields for next open to a truly clean state
                        if (editDateInput) editDateInput.value = '';
                        if (editStatusInput) editStatusInput.value = 'Present'; 
                        if (editHourInput) editHourInput.value = '9'; 
                        if (editExtraHourInput) editExtraHourInput.value = '0';
                        if (editLateHourInput) editLateHourInput.value = '00:00';
                        if (editShiftTypeInput) editShiftTypeInput.value = 'Day';
                        if (editGraceInput) editGraceInput.value = '-';
                        if (editApprovalInput) editApprovalInput.value = '-';
                        if (editGraceLimitMessage) editGraceLimitMessage.style.display = 'none';
                        toggleEditPresentDetails(); 
                    });
                }
            }

            function toggleEditPresentDetails() {
                const status = editStatusInput.value;
                const isPresentLike = (status === 'Present' || status === 'Government_Holiday' || status === 'Sick_Leave');
                const requiresApproval = (status === 'Sick_Leave' || status === 'Holiday' || status === 'Government_Holiday' || (isPresentLike && (parseFloat(editExtraHourInput.value || 0) > 0)));

                // Control visibility of hour/shift related fields
                if (editHourGroup) editHourGroup.style.display = isPresentLike ? 'block' : 'none';
                if (editExtraHourGroup) editExtraHourGroup.style.display = isPresentLike ? 'block' : 'none';
                if (editLateHourGroup) editLateHourGroup.style.display = isPresentLike ? 'block' : 'none';
                if (editShiftTypeGroup) editShiftTypeGroup.style.display = isPresentLike ? 'block' : 'none';
                
                // Grace is only for "Present" status
                if (editGraceGroup) editGraceGroup.style.display = (status === 'Present') ? 'block' : 'none'; 
                
                // Approval is shown for Sick Leave, Holidays, and Present with Extra Hours
                if (editApprovalGroup) editApprovalGroup.style.display = requiresApproval ? 'block' : 'none';

                // Set default hours for some statuses if empty, and clear for "Absent"
                if (status === 'Sick_Leave' || status === 'Government_Holiday') {
                    if (editHourInput) editHourInput.value = 9; 
                    if (editExtraHourInput) editExtraHourInput.value = 0; 
                    if (editLateHourInput) editLateHourInput.value = '00:00'; 
                } else if (status === 'Absent') {
                    // When absent, clear the hour/shift related fields
                    if (editHourInput) editHourInput.value = ''; 
                    if (editExtraHourInput) editExtraHourInput.value = '';
                    if (editLateHourInput) editLateHourInput.value = '00:00'; 
                    if (editShiftTypeInput) editShiftTypeInput.value = 'Day'; 
                    if (editGraceInput) editGraceInput.value = '-'; 
                }

                if (editApprovalInput) { 
                    if (requiresApproval) {
                        if (editApprovalInput.value === '-') { 
                            editApprovalInput.value = 'Approved';
                        }
                    } else {
                         editApprovalInput.value = '-';
                    }
                }
            }

            function handleSaveOrUpdateEntry() {
                const date = editDateInput.value;
                if (!date || !currentLoggedInUser) return;

                const status = editStatusInput.value;
                const monthKey = `${new Date(date).getFullYear()}-${String(new Date(date).getMonth() + 1).padStart(2, '0')}`;
                const existingEntry = currentLoggedInUser.attendance[date];
                const wasPresent = existingEntry && existingEntry.status === 'Present';
                const wasGrace = wasPresent && existingEntry.grace === 'Yes';

                let updatedEntry = { status: status, approval: editApprovalInput.value || '-' };

                if (status === 'Present' || status === 'Government_Holiday' || status === 'Sick_Leave') {
                    const updatedHour = parseFloat(editHourInput.value || 0); 
                    const updatedExtraHour = parseFloat(editExtraHourInput.value || 0); 
                    const updatedShift = editShiftTypeInput.value;
                    const updatedGrace = editGraceInput.value;
                    const updatedLate = calculateLateTime(updatedHour);

                    if (isNaN(updatedHour) || updatedHour < 0 || updatedHour > 24 ||
                        isNaN(updatedExtraHour) || updatedExtraHour < 0 || updatedExtraHour > 24) {
                        showCustomAlert('Input Error', "Please enter valid hour and extra hour values (0-24) for this status.", 'error');
                        return;
                    }

                    const isGraceNow = updatedGrace === 'Yes';
                    if (status === 'Present' && isGraceNow && !wasGrace && checkGraceLimit(monthKey)) {
                        showCustomAlert('Grace Limit Reached', "Cannot apply grace. Monthly limit (5) reached.", 'warning');
                        return;
                    }

                    updatedEntry = {
                        status: status,
                        hour: updatedHour,
                        extraHour: updatedExtraHour,
                        late: updatedLate,
                        shift: updatedShift,
                        grace: updatedGrace,
                        approval: editApprovalInput.value || '-'
                    };

                    if (status === 'Present') {
                        if (isGraceNow && !wasGrace) { 
                            updateGraceCount(monthKey, 1);
                        } else if (!isGraceNow && wasGrace) { 
                            updateGraceCount(monthKey, -1);
                        }
                    } else if (wasPresent && wasGrace) { 
                        updateGraceCount(monthKey, -1);
                    }
                } else if (status === 'Absent') {
                     updatedEntry = {
                        status: status,
                        hour: 0, 
                        extraHour: 0,
                        late: '00:00',
                        shift: 'Day', 
                        grace: '-',
                        approval: editApprovalInput.value || '-'
                    };
                    if (wasPresent && wasGrace) { 
                        updateGraceCount(monthKey, -1);
                    }
                }
                else { 
                    if (wasPresent && wasGrace) { 
                        updateGraceCount(monthKey, -1);
                    }
                    // For Weekend/Holiday, remove hour, extraHour, late, shift, grace from entry
                    delete updatedEntry.hour;
                    delete updatedEntry.extraHour;
                    delete updatedEntry.late;
                    delete updatedEntry.shift;
                    delete updatedEntry.grace;
                }

                currentLoggedInUser.attendance = { ...currentLoggedInUser.attendance, [date]: updatedEntry };
                saveCurrentUserData(); 

                closeCustomModal(editDeleteModal);
                displayAttendanceHistory();
                renderCalendar(currentMonthView); // Update calendar after entry change
                updateDashboardCards(currentMonthView); // Update new dashboard cards
                updateSlideshowContent(); // Update slideshow content
            }

            function confirmDeleteEntry() {
                const dateToDelete = editDateInput.value;
                showCustomConfirm('Confirm Delete', `Are you sure you want to delete the entry for ${formatDisplayDate(dateToDelete)}?`, (confirmed) => {
                    if (confirmed) {
                        deleteAttendanceEntry(dateToDelete);
                    }
                });
            }

            function deleteAttendanceEntry(dateToDelete) {
                if (!currentLoggedInUser || !currentLoggedInUser.attendance[dateToDelete]) return;

                const existingEntry = currentLoggedInUser.attendance[dateToDelete];
                const wasPresent = existingEntry && existingEntry.status === 'Present';
                const wasGrace = wasPresent && existingEntry.grace === 'Yes';
                const monthKey = `${new Date(dateToDelete).getFullYear()}-${String(new Date(dateToDelete).getMonth() + 1).padStart(2, '0')}`;

                const updatedAttendance = { ...currentLoggedInUser.attendance };
                delete updatedAttendance[dateToDelete];
                currentLoggedInUser.attendance = updatedAttendance; 
                saveCurrentUserData(); 

                if (wasPresent && wasGrace) {
                    updateGraceCount(monthKey, -1);
                }

                closeCustomModal(editDeleteModal);
                displayAttendanceHistory(); 
                renderCalendar(currentMonthView); // Update calendar after entry change
                updateDashboardCards(currentMonthView); // Update new dashboard cards
                updateSlideshowContent(); // Update slideshow content
            }

            // --- History Page Functions ---
            function displayCustomHistorySummary() {
                const startDateStr = historyDateFromInput.value;
                const endDateStr = historyDateToInput.value;

                if (!startDateStr || !endDateStr) {
                    showCustomAlert('Input Error', "Please select both 'From Date' and 'To Date'.", 'warning');
                    if (historyAttendanceTableBody) historyAttendanceTableBody.innerHTML = '';
                    return;
                }

                const startDate = new Date(startDateStr + 'T00:00:00');
                const endDate = new Date(endDateStr + 'T00:00:00');

                if (startDate > endDate) {
                    showCustomAlert('Input Error', "'From Date' cannot be after 'To Date'.", 'error');
                    if (historyAttendanceTableBody) historyAttendanceTableBody.innerHTML = '';
                    return;
                }

                const currentUserAttendance = currentLoggedInUser.attendance || {};

                let totalHours = 0;
                let totalLateMinutes = 0;
                let totalAbsentDays = 0;
                let totalWeekendDays = 0;
                let totalHolidayDays = 0;
                let totalGovernmentHolidayDays = 0; 
                let totalSickLeaveDays = 0; 
                let totalWorkingDays = 0; 
                let totalDayShifts = 0;
                let totalNightShifts = 0;
                let totalGraceDays = 0;
                let totalPresentCount = 0; 

                if (historyAttendanceTableBody) historyAttendanceTableBody.innerHTML = '';

                let currentDate = new Date(startDate);
                while (currentDate.getTime() <= endDate.getTime()) { 
                    const dateKey = formatDate(currentDate);
                    const dayOfWeek = getDayOfWeek(currentDate);
                    const entry = currentUserAttendance[dateKey];

                    const row = historyAttendanceTableBody.insertRow();
                    row.classList.add(`status-${(entry?.status || 'unmarked').toLowerCase()}-row`); 

                    const cellDate = row.insertCell();
                    const cellDay = row.insertCell();
                    const cellStatus = row.insertCell();
                    const cellHour = row.insertCell();
                    const cellExtraHour = row.insertCell();
                    const cellLate = row.insertCell();
                    const cellShift = row.insertCell();
                    const cellGrace = row.insertCell();
                    const cellApproval = row.insertCell(); 

                    cellDate.textContent = formatDisplayDate(currentDate);
                    cellDay.textContent = dayOfWeek;
                    cellStatus.className = '';

                    if (entry && entry.status) {
                        cellStatus.textContent = entry.status.replace(/_/g, ' '); 
                        cellStatus.classList.add(`status-${entry.status.toLowerCase()}`);

                        if (entry.status === 'Present' || entry.status === 'Government_Holiday' || entry.status === 'Sick_Leave') {
                            cellHour.textContent = entry.hour || '-';
                            cellExtraHour.textContent = entry.extraHour || '-';
                            cellLate.textContent = entry.late || '00:00';
                            cellShift.textContent = entry.shift || '-';
                            cellGrace.textContent = entry.grace || '-';
                            cellApproval.textContent = entry.approval || '-';

                            totalHours += (entry.hour || 0) + (entry.extraHour || 0);
                            const [lateHours, lateMinutes] = (entry.late || '00:00').split(':').map(Number);
                            totalLateMinutes += (lateHours * 60) + lateMinutes;

                            if (entry.shift === 'Day') totalDayShifts++;
                            else if (entry.shift === 'Night') totalNightShifts++;
                            totalWorkingDays++; 
                            if (entry.grace === 'Yes') totalGraceDays++;

                            if (entry.status === 'Government_Holiday') totalGovernmentHolidayDays++;
                            else if (entry.status === 'Sick_Leave') totalSickLeaveDays++;
                            else if (entry.status === 'Present') totalPresentCount++;

                        } else if (entry.status === 'Absent') {
                             cellHour.textContent = '-';
                            cellExtraHour.textContent = '-';
                            cellLate.textContent = '-';
                            cellShift.textContent = '-';
                            cellGrace.textContent = '-';
                            cellApproval.textContent = entry.approval || '-';
                            totalAbsentDays++;
                            totalWorkingDays++; 
                        }
                        else {
                            cellHour.textContent = '-';
                            cellExtraHour.textContent = '-';
                            cellLate.textContent = '-';
                            cellShift.textContent = '-';
                            cellGrace.textContent = '-';
                            cellApproval.textContent = '-';
                            if (entry.status === 'Weekend') {
                                totalWeekendDays++;
                            } else if (entry.status === 'Holiday') {
                                totalHolidayDays++;
                            }
                        }
                    } else {
                        cellStatus.textContent = '-';
                        cellHour.textContent = '-';
                        cellExtraHour.textContent = '-';
                        cellLate.textContent = '-';
                        cellShift.textContent = '-';
                        cellGrace.textContent = '-';
                        cellApproval.textContent = '-';
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }
            }

            // --- Notification Modal Functions ---
            function closeNotificationModalFunc() {
                closeCustomModal(notificationModal);
            }


            // --- Help Modal Functions ---
            function openHelpModal() {
                if (helpModal) {
                    helpModal.style.display = 'flex';
                }
            }

            function closeHelpModalFunc() {
                closeCustomModal(helpModal);
            }

            // --- New Dashboard Card Functions ---

           function updateDashboardCards(date) {
                const { start, end } = getMonthRange(date);
                let totalDaysInPeriod = 0;
                let totalSundaysInPeriod = 0;
                let totalHolidaysInPeriod = 0; // Includes General and Government Holidays
                let calculatedWorkingDays = 0; // Excludes Sundays and Holidays

                const currentUserAttendance = currentLoggedInUser.attendance || {};

                let currentDate = new Date(start);
                while (currentDate.getTime() <= end.getTime()) {
                    totalDaysInPeriod++;
                    const dateKey = formatDate(currentDate);
                    const entry = currentUserAttendance[dateKey];
                    const dayOfWeek = currentDate.getDay(); // 0 for Sunday

                    if (dayOfWeek === 0) { // Sunday
                        totalSundaysInPeriod++;
                    }

                    if (entry && (entry.status === 'Holiday' || entry.status === 'Government_Holiday')) {
                        totalHolidaysInPeriod++;
                    }

                    // Calculate working days excluding Sundays and Holidays
                    if (dayOfWeek !== 0 && !(entry && (entry.status === 'Holiday' || entry.status === 'Government_Holiday'))) {
                        calculatedWorkingDays++;
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                if (totalWorkingDaysDisplay) totalWorkingDaysDisplay.textContent = `${calculatedWorkingDays} Days`;

                // COLA Eligibility
                let requiredPresentDays;
                if (calculatedWorkingDays >= 26) { // 27-26 days
                    requiredPresentDays = 22;
                } else if (calculatedWorkingDays >= 24) { // 25-24 days
                    requiredPresentDays = 21;
                } else { // Below 24 days
                    requiredPresentDays = 20;
                }

                let presentDaysCount = 0;
                currentDate = new Date(start); // Reset currentDate for this loop
                while (currentDate.getTime() <= end.getTime()) {
                    const dateKey = formatDate(currentDate);
                    const entry = currentUserAttendance[dateKey];
                    if (entry && (entry.status === 'Present' || entry.status === 'Government_Holiday' || entry.status === 'Sick_Leave')) {
                        presentDaysCount++;
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                if (colaEligibilityDisplay) colaEligibilityDisplay.textContent = `Need present ${requiredPresentDays} days`;
                
                const progressPercentage = (presentDaysCount / requiredPresentDays) * 100;
                if (colaProgressBar) colaProgressBar.style.width = `${Math.min(progressPercentage, 100)}%`;
                if (colaEligibilityStatus) {
                    if (presentDaysCount >= requiredPresentDays) {
                        colaEligibilityStatus.innerHTML = '<i class="fas fa-check-circle"></i> COLA Eligibility Met!';
                        colaEligibilityStatus.style.color = 'var(--status-present)';
                    } else {
                        colaEligibilityStatus.innerHTML = `Present: ${presentDaysCount} / ${requiredPresentDays} Days`;
                        colaEligibilityStatus.style.color = 'var(--text-secondary)';
                    }
                }

                // Category Employee Treated As
                // This calculation needs the total hours from displayAttendanceHistory, which is updated in summaryTotalHours
                // We need to re-calculate total hours for the current month range here, as displayAttendanceHistory is for the Attendance page.
                let totalHoursForCategory = 0;
                currentDate = new Date(start);
                while (currentDate.getTime() <= end.getTime()) {
                    const dateKey = formatDate(currentDate);
                    const entry = currentUserAttendance[dateKey];
                    if (entry && (entry.status === 'Present' || entry.status === 'Government_Holiday' || entry.status === 'Sick_Leave')) {
                        totalHoursForCategory += (entry.hour || 0) + (entry.extraHour || 0);
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                const totalPossibleHours = calculatedWorkingDays * 9; // Assuming 9 hours per working day
                let workingHoursPercentage = 0;
                if (totalPossibleHours > 0) {
                    workingHoursPercentage = (totalHoursForCategory / totalPossibleHours) * 100;
                }

                let category = 'E';
                let treatedAs = 'Failure';
                if (workingHoursPercentage >= 90) {
                    category = 'A';
                    treatedAs = 'Excellent';
                } else if (workingHoursPercentage >= 85) {
                    category = 'B';
                    treatedAs = 'Very Good';
                } else if (workingHoursPercentage >= 80) {
                    category = 'C';
                    treatedAs = 'Good';
                } else if (workingHoursPercentage >= 75) {
                    category = 'D';
                    treatedAs = 'Need Improvement';
                }

                if (employeeCategoryDisplay) employeeCategoryDisplay.textContent = `Category: ${category}, ${treatedAs}`;

                // Update slideshow content with these calculated values
                updateSlideshowContent();
            }

            // --- Dashboard Slideshow Functions ---
            function initSlideshow() {
                if (!slideshowCards || slideshowCards.length === 0) return;

                slideshowNavDots.innerHTML = '';
                slideshowCards.forEach((_, index) => {
                    const dot = document.createElement('span');
                    dot.classList.add('slideshow-dot');
                    if (index === 0) dot.classList.add('active');
                    dot.addEventListener('click', () => showSlide(index));
                    slideshowNavDots.appendChild(dot);
                });

                showSlide(currentSlideIndex);
            }

            function showSlide(index) {
                if (!slideshowCards || slideshowCards.length === 0) return;

                // Determine direction for animation
                const direction = index > currentSlideIndex ? 'next' : 'prev';

                slideshowCards.forEach((card, i) => {
                    card.classList.remove('active', 'prev');
                    if (i === index) {
                        card.classList.add('active');
                    } else if (i === currentSlideIndex) {
                        // Apply 'prev' class to the currently active card if it's moving out
                        card.classList.add(direction === 'next' ? 'prev' : 'next'); // 'next' for moving right, 'prev' for moving left
                    }
                });

                const dots = document.querySelectorAll('.slideshow-dot');
                dots.forEach((dot, i) => {
                    dot.classList.toggle('active', i === index);
                });

                currentSlideIndex = index;
            }

            function nextSlide() {
                if (!slideshowCards || slideshowCards.length === 0) return;
                let newIndex = (currentSlideIndex + 1) % slideshowCards.length;
                showSlide(newIndex);
            }

            function startSlideshow() {
                stopSlideshow(); // Clear any existing interval
                slideshowInterval = setInterval(nextSlide, 10000); // Change slide every 10 seconds
            }

            function stopSlideshow() {
                clearInterval(slideshowInterval);
            }

            function updateSlideshowContent() {
                const { start, end } = getMonthRange(currentMonthView);
                let totalDaysInPeriod = 0;
                let totalSundaysInPeriod = 0;
                let totalHolidaysInPeriod = 0;
                let calculatedWorkingDays = 0;

                const currentUserAttendance = currentLoggedInUser.attendance || {};

                let currentDate = new Date(start);
                while (currentDate.getTime() <= end.getTime()) {
                    totalDaysInPeriod++;
                    const dateKey = formatDate(currentDate);
                    const entry = currentUserAttendance[dateKey];
                    const dayOfWeek = currentDate.getDay(); // 0 for Sunday

                    if (dayOfWeek === 0) { // Sunday
                        totalSundaysInPeriod++;
                    }

                    if (entry && (entry.status === 'Holiday' || entry.status === 'Government_Holiday')) {
                        totalHolidaysInPeriod++;
                    }

                    if (dayOfWeek !== 0 && !(entry && (entry.status === 'Holiday' || entry.status === 'Government_Holiday'))) {
                        calculatedWorkingDays++;
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                // Update Total Working Days slide
                const twdMonthDisplay = document.querySelector('#slideshowCard1 #twdMonthDisplay');
                const twdTotalDays = document.querySelector('#slideshowCard1 #twdTotalDays');
                const twdTotalSundays = document.querySelector('#slideshowCard1 #twdTotalSundays');
                const twdTotalHolidays = document.querySelector('#slideshowCard1 #twdTotalHolidays');
                const twdCalculatedWorkingDays = document.querySelector('#slideshowCard1 #twdCalculatedWorkingDays');

                if (twdMonthDisplay) twdMonthDisplay.textContent = currentMonthView.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                if (twdTotalDays) twdTotalDays.textContent = totalDaysInPeriod;
                if (twdTotalSundays) twdTotalSundays.textContent = totalSundaysInPeriod;
                if (twdTotalHolidays) twdTotalHolidays.textContent = totalHolidaysInPeriod;
                if (twdCalculatedWorkingDays) twdCalculatedWorkingDays.textContent = calculatedWorkingDays;

                // Update COLA Eligibility slide
                const colaMonthDisplay = document.querySelector('#slideshowCard2 #colaMonthDisplay');
                const colaTotalWorkingDays = document.querySelector('#slideshowCard2 #colaTotalWorkingDays');
                const colaRequiredPresentDays = document.querySelector('#slideshowCard2 #colaRequiredPresentDays');
                const colaYourPresentDays = document.querySelector('#slideshowCard2 #colaYourPresentDays');
                const colaModalProgressBar = document.querySelector('#slideshowCard2 #colaModalProgressBar');
                const colaModalEligibilityStatus = document.querySelector('#slideshowCard2 #colaModalEligibilityStatus');

                let requiredPresentDays;
                if (calculatedWorkingDays >= 26) {
                    requiredPresentDays = 22;
                } else if (calculatedWorkingDays >= 24) {
                    requiredPresentDays = 21;
                } else {
                    requiredPresentDays = 20;
                }

                let presentDaysCount = 0;
                currentDate = new Date(start);
                while (currentDate.getTime() <= end.getTime()) {
                    const dateKey = formatDate(currentDate);
                    const entry = currentUserAttendance[dateKey];
                    if (entry && (entry.status === 'Present' || entry.status === 'Government_Holiday' || entry.status === 'Sick_Leave')) {
                        presentDaysCount++;
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                if (colaMonthDisplay) colaMonthDisplay.textContent = currentMonthView.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                if (colaTotalWorkingDays) colaTotalWorkingDays.textContent = calculatedWorkingDays;
                if (colaRequiredPresentDays) colaRequiredPresentDays.textContent = requiredPresentDays;
                if (colaYourPresentDays) colaYourPresentDays.textContent = presentDaysCount;

                const progressPercentage = (presentDaysCount / requiredPresentDays) * 100;
                if (colaModalProgressBar) colaModalProgressBar.style.width = `${Math.min(progressPercentage, 100)}%`;
                if (colaModalEligibilityStatus) {
                    if (presentDaysCount >= requiredPresentDays) {
                        colaModalEligibilityStatus.innerHTML = '<i class="fas fa-check-circle"></i> COLA Eligibility Met!';
                        colaModalEligibilityStatus.style.color = 'var(--status-present)';
                    } else {
                        colaModalEligibilityStatus.innerHTML = `Present: ${presentDaysCount} / ${requiredPresentDays} Days`;
                        colaModalEligibilityStatus.style.color = 'var(--text-secondary)';
                    }
                }

                // Category Employee Treated As (Slide 3)
                let totalHoursForCategory = 0;
                currentDate = new Date(start);
                while (currentDate.getTime() <= end.getTime()) {
                    const dateKey = formatDate(currentDate);
                    const entry = currentUserAttendance[dateKey];
                    if (entry && (entry.status === 'Present' || entry.status === 'Government_Holiday' || entry.status === 'Sick_Leave')) {
                        totalHoursForCategory += (entry.hour || 0) + (entry.extraHour || 0);
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }

                const totalPossibleHours = calculatedWorkingDays * 9;
                let workingHoursPercentage = 0;
                if (totalPossibleHours > 0) {
                    workingHoursPercentage = (totalHoursForCategory / totalPossibleHours) * 100;
                }

                let category = 'E';
                let treatedAs = 'Failure';
                if (workingHoursPercentage >= 90) {
                    category = 'A';
                    treatedAs = 'Excellent';
                } else if (workingHoursPercentage >= 85) {
                    category = 'B';
                    treatedAs = 'Very Good';
                } else if (workingHoursPercentage >= 80) {
                    category = 'C';
                    treatedAs = 'Good';
                } else if (workingHoursPercentage >= 75) {
                    category = 'D';
                    treatedAs = 'Need Improvement';
                }
                // The table in slideshowCard3 is static, but if there were dynamic elements, they would be updated here.
                // For now, the category and treatedAs are displayed in the summary card above.
            }

            // --- Theme Toggle Button Update ---
            function updateThemeToggleButton(theme) {
                if (themeToggle) {
                    const icon = themeToggle.querySelector('i');
                    const text = themeToggle.querySelector('span');
                    if (theme === 'dark') {
                        icon.className = 'fas fa-sun';
                        text.textContent = 'Light Mode';
                    } else if (theme === 'windows-11-vibe') {
                        icon.className = 'fas fa-desktop'; // Or another suitable icon
                        text.textContent = 'Neptune Vibe';
                    } else { // neptune-vibe
                        icon.className = 'fas fa-moon';
                        text.textContent = 'Dark Mode';
                    }
                }
            }

            // --- User Menu Dropdown Functions ---
            function updateUserMenuDropdown() {
                if (!userMenuDropdown || !currentLoggedInUser) return;

                userMenuDropdown.innerHTML = ''; // Clear existing items

                // Add current logged-in user at the top
                const currentUserItem = document.createElement('div');
                currentUserItem.classList.add('user-menu-item');
                currentUserItem.innerHTML = `
                    <img src="${currentLoggedInUser.photo}" alt="Profile Picture">
                    <div class="user-info">
                        <h4>${currentLoggedInUser.profileName || currentLoggedInUser.username}</h4>
                        <p>${currentLoggedInUser.team || 'N/A'} - ${currentLoggedInUser.lngId || 'N/A'}</p>
                    </div>
                `;
                userMenuDropdown.appendChild(currentUserItem);

                // Add other registered users (excluding current)
                registeredUsers.filter(user => user.email !== currentLoggedInUser.email).forEach(user => {
                    const userItem = document.createElement('div');
                    userItem.classList.add('user-menu-item');
                    userItem.innerHTML = `
                        <img src="${user.photo}" alt="Profile Picture">
                        <div class="user-info">
                            <h4>${user.profileName || user.username}</h4>
                            <p>${user.team || 'N/A'} - ${user.lngId || 'N/A'}</p>
                        </div>
                    `;
                    userItem.addEventListener('click', () => switchUser(user.email));
                    userMenuDropdown.appendChild(userItem);
                });
            }

            function switchUser(email) {
                const user = registeredUsers.find(u => u.email === email);
                if (user) {
                    currentLoggedInUser = user;
                    localStorage.setItem('lastLoggedInUserEmail', email);
                    userMenuDropdown.classList.remove('show'); // Close dropdown
                    showMainActivitySection(); // Re-initialize main app for new user
                    showCustomAlert('User Switched', `Switched to ${user.profileName || user.username}'s account.`, 'info');
                } else {
                    showCustomAlert('Error', 'User not found.', 'error');
                }
            }

            // --- Notes Section Functions ---
            function renderNotesList() {
                if (!notesList || !currentLoggedInUser) return;

                notesList.innerHTML = '';
                const notes = currentLoggedInUser.notes || [];

                // Sort notes by lastEdited date, newest first
                notes.sort((a, b) => new Date(b.lastEdited) - new Date(a.lastEdited));

                if (notes.length === 0) {
                    notesList.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">No notes yet. Click "Add New Note" to create one.</p>';
                    displayNoteContent(null); // Clear content area if no notes
                    return;
                }

                notes.forEach(note => {
                    const noteItem = document.createElement('div');
                    noteItem.classList.add('note-item');
                    if (currentEditingNoteId === note.id) {
                        noteItem.classList.add('active');
                    }
                    noteItem.dataset.noteId = note.id;
                    noteItem.innerHTML = `
                        <h4>${note.title || 'Untitled Note'}</h4>
                        <p>Last edited: ${new Date(note.lastEdited).toLocaleString()}</p>
                    `;
                    noteItem.addEventListener('click', () => displayNoteContent(note.id));
                    notesList.appendChild(noteItem);
                });
            }

            function displayNoteContent(noteId) {
                currentEditingNoteId = noteId;
                clearTimeout(autoSaveTimeout); // Clear any pending auto-save

                if (!noteId) {
                    noteContentTitle.textContent = 'Add New Note';
                    noteTitleInput.value = '';
                    noteBodyInput.value = '';
                    saveNoteBtn.style.display = 'inline-flex';
                    saveNoteBtn.textContent = 'Create Note';
                    deleteNoteBtn.style.display = 'none';
                    noteTitleInput.readOnly = false;
                    noteBodyInput.readOnly = false;
                    return;
                }

                const note = (currentLoggedInUser.notes || []).find(n => n.id === noteId);

                if (note) {
                    noteContentTitle.textContent = note.title || 'Untitled Note';
                    noteTitleInput.value = note.title || '';
                    noteBodyInput.value = note.body || '';
                    saveNoteBtn.style.display = 'inline-flex';
                    saveNoteBtn.textContent = 'Save Changes';
                    deleteNoteBtn.style.display = 'inline-flex';
                    noteTitleInput.readOnly = false;
                    noteBodyInput.readOnly = false;
                } else {
                    // Note not found, reset to add new
                    displayNoteContent(null);
                }

                // Update active state in notes list
                document.querySelectorAll('.note-item').forEach(item => {
                    item.classList.toggle('active', item.dataset.noteId === noteId);
                });
            }

            function addNewNote() {
                displayNoteContent(null); // Clear current content to prepare for new note
                noteTitleInput.focus();
            }

            function saveCurrentNote() {
                if (!currentLoggedInUser) return;

                const title = noteTitleInput.value.trim();
                const body = noteBodyInput.value.trim();
                const lastEdited = new Date().toISOString();

                if (!title && !body) {
                    // If both are empty, and it's a new note, don't save. If existing, delete.
                    if (currentEditingNoteId) {
                        confirmDeleteNote(); // Ask to delete empty existing note
                    } else {
                        showCustomAlert('Empty Note', 'Cannot save an empty note. Please add a title or body.', 'warning');
                    }
                    return;
                }

                let notes = currentLoggedInUser.notes || [];

                if (currentEditingNoteId) {
                    // Update existing note
                    const noteIndex = notes.findIndex(n => n.id === currentEditingNoteId);
                    if (noteIndex !== -1) {
                        notes[noteIndex] = { ...notes[noteIndex], title, body, lastEdited };
                        showCustomAlert('Note Saved', 'Your note has been updated automatically.', 'success');
                    }
                } else {
                    // Create new note
                    const newNote = {
                        id: Date.now().toString(), // Simple unique ID
                        title,
                        body,
                        lastEdited
                    };
                    notes.push(newNote);
                    currentEditingNoteId = newNote.id; // Set as currently editing
                    showCustomAlert('Note Created', 'New note saved automatically.', 'success');
                }

                currentLoggedInUser.notes = notes;
                saveCurrentUserData();
                renderNotesList();
                // Re-display content to update title/last edited date if it was a new note
                displayNoteContent(currentEditingNoteId); 
            }

            function confirmDeleteNote() {
                if (!currentEditingNoteId) return;

                showCustomConfirm('Confirm Delete', 'Are you sure you want to delete this note?', (confirmed) => {
                    if (confirmed) {
                        deleteNote(currentEditingNoteId);
                    }
                });
            }

            function deleteNote(noteId) {
                if (!currentLoggedInUser) return;

                let notes = currentLoggedInUser.notes || [];
                notes = notes.filter(n => n.id !== noteId);
                currentLoggedInUser.notes = notes;
                saveCurrentUserData();

                currentEditingNoteId = null; // No note is being edited after deletion
                renderNotesList();
                displayNoteContent(null); // Clear content area
                showCustomAlert('Note Deleted', 'The note has been successfully deleted.', 'success');
            }

            // Debounce function for auto-save
            function debounce(func, delay) {
                return function(...args) {
                    const context = this;
                    clearTimeout(autoSaveTimeout);
                    autoSaveTimeout = setTimeout(() => func.apply(context, args), delay);
                };
            }


            // Initial call
            initializeApp();
        });
    </script>
</body>
</html>
