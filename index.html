<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Attendance Tracker Pro - Colorful</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Global Styles - Deep Colorful UI */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

    :root {
      --bg-deep-indigo: #1A1A2E; /* Deep indigo for main background */
      --bg-content-indigo: #24243E; /* Slightly lighter for content areas */
      --bg-modal-indigo: #2A2A4A; /* Modal background */
      --text-primary-light: #E0E0E0; /* Light gray for primary text */
      --text-secondary-light: #B0B0C0; /* Softer light gray */
      --accent-teal: #00F5A0;
      --accent-magenta: #FF00FF;
      --accent-orange: #FFA500;
      --accent-yellow: #FFFF00;
      --border-dark: #3A3A5A; /* Darker border for separation */
      --shadow-color: rgba(0, 245, 160, 0.1); /* Tealish shadow */
      --success-color: #28a745;
      --error-color: #dc3545;
      --info-color: #17a2b8;
      --present-bg: rgba(0, 245, 160, 0.15); /* Tealish green for present */
      --present-text: #00F5A0;
      --absent-bg: rgba(255, 0, 0, 0.15); /* Reddish for absent */
      --absent-text: #FF4D4F;
      --holiday-bg: rgba(0, 123, 255, 0.15); /* Bluish for holiday */
      --holiday-text: #007BFF;
    }

    body {
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      margin: 0;
      background: var(--bg-deep-indigo);
      overflow-x: hidden;
      color: var(--text-primary-light);
      display: flex;
      flex-direction: column;
    }

    /* Modals - Colorful & Modern */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(10, 10, 20, 0.6); /* Darker, slightly colored backdrop */
      backdrop-filter: blur(5px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .modal-backdrop.show {
      opacity: 1;
      pointer-events: auto;
    }

    .modal-content {
      background: var(--bg-modal-indigo);
      border-radius: 10px;
      padding: 2.5rem 3rem;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3), 0 0 15px var(--shadow-color);
      width: 420px;
      color: var(--text-primary-light);
      text-align: center;
      position: relative;
      transform: translateY(-20px) scale(0.95);
      transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease;
      border: 1px solid var(--border-dark);
    }

    .modal-backdrop.show .modal-content {
      transform: translateY(0) scale(1);
    }

    .modal-content h2 {
      margin-bottom: 1.5rem;
      font-weight: 700;
      font-size: 1.75rem;
      color: var(--accent-teal); /* Teal for modal titles */
      text-shadow: 0 0 5px rgba(0, 245, 160, 0.5);
    }

    .modal-content label {
      color: var(--text-secondary-light);
      font-weight: 500;
      font-size: 0.9rem;
      display: block;
      text-align: left;
      margin-bottom: 0.3rem;
    }

    .modal-content input,
    .modal-content select {
      width: 100%;
      padding: 0.75rem 1rem;
      border-radius: 6px;
      border: 1px solid var(--border-dark);
      margin-bottom: 1.25rem;
      background: rgba(255, 255, 255, 0.05); /* Very subtle light background for inputs */
      color: var(--text-primary-light);
      font-size: 1rem;
      font-weight: 400;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
    }

    .modal-content input::placeholder,
    .modal-content select option {
      color: var(--text-secondary-light);
    }
     .modal-content select option {
      background-color: var(--bg-modal-indigo); /* Ensure dropdown options are themed */
      color: var(--text-primary-light);
    }


    .modal-content input:focus,
    .modal-content select:focus {
      outline: none;
      border-color: var(--accent-teal);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 2px rgba(0, 245, 160, 0.3);
    }

    .modal-content button {
      background-image: linear-gradient(to right, var(--accent-teal), var(--accent-magenta));
      color: #11111E; /* Dark text on bright buttons */
      font-weight: 600; /* Bolder text */
      padding: 0.8rem 1.3rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      width: 100%;
      font-size: 1.05rem;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .modal-content button:hover {
      transform: translateY(-2px) scale(1.02);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3), 0 0 10px var(--accent-teal);
    }

    .modal-content button.bg-gray-500 { /* For cancel/secondary buttons */
      background-image: none;
      background-color: rgba(255,255,255,0.1);
      color: var(--text-secondary-light);
      border: 1px solid var(--border-dark);
    }

    .modal-content button.bg-gray-500:hover {
      background-color: rgba(255,255,255,0.15);
      color: var(--text-primary-light);
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    .modal-footer {
      margin-top: 1.25rem;
      font-size: 0.9rem;
      font-weight: 400;
      color: var(--text-secondary-light);
    }

    .modal-footer a {
      color: var(--accent-teal);
      cursor: pointer;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease, text-shadow 0.2s ease;
    }

    .modal-footer a:hover {
      color: var(--accent-magenta);
      text-shadow: 0 0 5px var(--accent-magenta);
    }

    .message {
      margin-top: 0.85rem;
      font-weight: 500;
      font-size: 0.95rem;
    }

    .message.success { color: var(--success-color); }
    .message.error { color: var(--error-color); }

    /* App Container & Navbar */
    #appContainer {
      display: none;
      min-height: 100vh;
      flex-direction: column;
    }

    #navbar {
      background: rgba(36, 36, 62, 0.85); /* Semi-transparent dark navbar */
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.25);
      color: var(--text-primary-light);
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-dark);
    }

    #navbar.scrolled {
      background: rgba(30, 30, 50, 0.9);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    #navbar .font-bold { /* App Title */
      color: var(--accent-teal);
      font-size: 1.4rem;
      font-weight: 700;
      text-shadow: 0 0 3px var(--accent-teal);
      display: flex;
     justify-content: center;
     align-items: center;
    }

    #userPhoto {
      border-radius: 50%;
      border: 2px solid var(--accent-teal);
      box-shadow: 0 0 8px var(--accent-teal);
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    #userPhoto:hover {
      transform: scale(1.1);
      box-shadow: 0 0 12px var(--accent-magenta);
    }

    /* Dropdown Menu */
    .dropdown-menu {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      background: var(--bg-modal-indigo);
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      min-width: 190px;
      z-index: 1000;
      opacity: 0;
      transform: translateY(10px) scale(0.95);
      pointer-events: none;
      transition: opacity 0.25s ease, transform 0.25s ease;
      padding: 0.5rem;
      border: 1px solid var(--border-dark);
    }

    .dropdown-menu.show {
      opacity: 1;
      transform: translateY(0) scale(1);
      pointer-events: auto;
    }

    .dropdown-menu a {
      display: block;
      padding: 0.7rem 1rem;
      color: var(--text-secondary-light);
      text-decoration: none;
      font-weight: 500;
      font-size: 0.95rem;
      transition: background-color 0.2s ease, color 0.2s ease;
      border-radius: 4px;
    }

    .dropdown-menu a:hover {
      background-color: rgba(0, 245, 160, 0.1); /* Teal highlight */
      color: var(--accent-teal);
    }

    /* Main Content Area */
    #mainContent {
      flex-grow: 1;
      background: var(--bg-content-indigo);
      border-radius: 12px;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.2), 0 5px 20px rgba(0,0,0,0.15);
      padding: 2.5rem 3rem;
      margin-top: 6.5rem; /* Ensure space below fixed navbar */
      margin-bottom: 2.5rem;
      color: var(--text-primary-light);
      border: 1px solid var(--border-dark);
    }

    #mainContent h1 { /* Page Title */
      color: var(--text-primary-light);
      font-weight: 700;
      font-size: 2.25rem;
      margin-bottom: 2.5rem;
      text-align: center;
      letter-spacing: 0.5px;
    }

    #monthSelect {
      border: 1px solid var(--border-dark);
      border-radius: 6px;
      background-color: rgba(255,255,255,0.05);
      color: var(--text-primary-light);
      padding: 0.6rem 1rem;
      font-weight: 500;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.1);
    }
    #monthSelect:focus {
        border-color: var(--accent-teal);
        outline: none;
        background-color: rgba(255,255,255,0.08);
    }
    #monthSelect option {
      background-color: var(--bg-modal-indigo);
      color: var(--text-primary-light);
    }


    /* Summary Section */
    .summary-grid {
      background-color: rgba(0,0,0,0.1); /* Darker, transparent summary */
      padding: 1.5rem;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      font-size: 0.95rem;
      border: 1px solid var(--border-dark);
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
    }

    .summary-grid div {
      padding: 0.2rem 0;
     background-image: linear-gradient(to right, #111878, #100710);    border: 1px solid #06099185;
      border-radius: 8px;
      box-shadow: 1px 1px 10px black;
    }

    .summary-grid span {
      font-weight: 700;
      color: var(--accent-teal); /* Teal for summary numbers */
    }

    /* Table Styles */
    #attendanceTable {
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--border-dark);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    #attendanceTable thead th {
      background-color: rgba(0,0,0, 0.25); /* Dark, semi-transparent header */
      color: var(--accent-teal); /* Teal header text */
      font-weight: 600;
      padding: 1rem 0.8rem;
      border-bottom: 1px solid var(--border-dark);
      border-left: 1px solid rgba(58, 58, 90, 0.5);
      text-align: center;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
     #attendanceTable thead th:first-child { border-left: none; }


    #attendanceTbody tr {
      background-color: transparent; /* Rows transparent against content background */
      transition: background-color 0.2s ease;
      border-bottom: 1px solid var(--border-dark);
    }
     #attendanceTbody tr:last-child { border-bottom: none; }


    /* Row coloring based on status - vivid backgrounds */
    #attendanceTbody tr.row-present { background-color: var(--present-bg); }
    #attendanceTbody tr.row-absent { background-color: var(--absent-bg); }
    #attendanceTbody tr.row-holiday { background-color: var(--holiday-bg); }

    /* No striping needed with distinct status backgrounds */
    /* #attendanceTbody tr:nth-child(even) { background-color: rgba(255,255,255,0.02); } */
    /* #attendanceTbody tr.row-present:nth-child(even) { background-color: var(--present-bg); } */
    /* #attendanceTbody tr.row-absent:nth-child(even) { background-color: var(--absent-bg); } */
    /* #attendanceTbody tr.row-holiday:nth-child(even) { background-color: var(--holiday-bg); } */


    #attendanceTbody tr:hover {
      background-color: rgba(0, 245, 160, 0.1) !important; /* Tealish hover */
    }

    #attendanceTbody td {
      padding: 0.8rem 0.7rem;
      /* border-bottom handled by tr border */
      border-left: 1px solid rgba(58, 58, 90, 0.5);
      color: var(--text-primary-light);
      text-align: center;
      font-size: 0.9rem;
    }
    #attendanceTbody td:first-child { border-left: none; }

    /* Status Column Specific Styling */
    .status-cell {
      cursor: pointer;
      font-weight: 600; /* Bold status text */
      transition: text-shadow 0.2s ease;
      font-size: 0.95rem;
    }
    .status-cell button { /* For the "Set" button */
        background-image: linear-gradient(to right, var(--accent-teal), var(--accent-magenta));
        color: #11111E;
        font-weight: 600;
        padding: 0.35rem 0.9rem;
        border-radius: 4px;
        font-size: 0.85rem;
        border: none;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
    }
    .status-cell button:hover {
        transform: scale(1.05);
        box-shadow: 0 0 8px var(--accent-teal);
    }

    .status-cell.present-p { color: var(--present-text); text-shadow: 0 0 3px var(--present-text); }
    .status-cell.absent-a { color: var(--absent-text); text-shadow: 0 0 3px var(--absent-text); }
    .status-cell.holiday-h { color: var(--holiday-text); text-shadow: 0 0 3px var(--holiday-text); }


    .status-cell.disabled-status {
      cursor: not-allowed;
      opacity: 0.4;
      color: var(--text-secondary-light);
      text-shadow: none;
    }

    /* Footer Styles */
    #app-footer {
      margin-top: auto;
      padding: 1.5rem;
      text-align: center;
      color: var(--text-secondary-light);
      font-size: 0.9rem;
      font-weight: 400;
      background: var(--bg-deep-indigo);
      border-top: 1px solid var(--border-dark);
    }
     #app-footer a { /* If any links in footer */
        color: var(--accent-teal);
        text-decoration: none;
     }
     #app-footer a:hover {
        color: var(--accent-magenta);
     }


    /* User List on Create Account Modal */
    #existingUsersList {
        max-height: 140px;
        overflow-y: auto;
        border: 1px solid var(--border-dark);
        border-radius: 6px;
        padding: 0.5rem;
        margin-top: 1rem;
        background-color: rgba(0,0,0,0.1); /* Darker background */
        text-align: left;
    }
    #existingUsersList .user-item {
        display: flex;
        align-items: center;
        padding: 0.4rem 0.6rem;
        border-bottom: 1px solid var(--border-dark);
        color: var(--text-secondary-light);
        font-size: 0.9rem;
    }
    #existingUsersList .user-item:last-child { border-bottom: none; }
    #existingUsersList .user-item img {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        margin-right: 0.5rem;
        border: 1px solid var(--accent-teal); /* Teal border for user pics */
    }
    #existingUsersList .user-item span { font-weight: 500; color: var(--text-primary-light); }

    /* Profile Picture Selection Modal */
    #selectProfilePicModal .profile-pic-options {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
        margin-top: 1.5rem;
        margin-bottom: 1.5rem;
    }
    #selectProfilePicModal .profile-pic-options img {
        width: 55px;
        height: 55px;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid transparent;
        transition: border-color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
    }
    #selectProfilePicModal .profile-pic-options img.selected {
        border-color: var(--accent-magenta);
        transform: scale(1.1);
        box-shadow: 0 0 10px var(--accent-magenta);
    }
    #selectProfilePicModal .profile-pic-options img:hover {
        transform: scale(1.08);
        border-color: var(--accent-teal);
    }
  </style>
</head>

<body>
  <div id="loginModal" class="modal-backdrop show" aria-modal="true" role="dialog" aria-labelledby="loginTitle">
    <div class="modal-content">
      <h2 id="loginTitle">Welcome Back</h2>
      <input type="text" id="loginUser" placeholder="Username or Email" autocomplete="username" />
      <input type="password" id="loginPass" placeholder="Password" autocomplete="current-password" />
      <button id="loginBtn">Login Securely</button>
      <div class="message" id="loginMessage"></div>
      <div class="modal-footer">
        <a id="showCreateAccount" tabindex="0">Create New Account</a> | <a id="showForgotPass" tabindex="0">Forgot Password?</a>
      </div>
    </div>
  </div>

  <div id="createAccountModal" class="modal-backdrop" aria-modal="true" role="dialog"
    aria-labelledby="createAccountTitle" style="display:none;">
    <div class="modal-content">
      <h2 id="createAccountTitle">Join Us</h2>
      <input type="text" id="createUsername" placeholder="Choose a Username" autocomplete="username" />
      <input type="email" id="createEmail" placeholder="Your Email Address" autocomplete="email" />
      <input type="password" id="createPassword" placeholder="Create a Secure Password" autocomplete="new-password" />
      <input type="password" id="createConfirmPassword" placeholder="Confirm Your Password" autocomplete="new-password" />
      <button id="createAccountBtn">Create My Account</button>
      <div class="message" id="createAccountMessage"></div>
      <div class="mt-4 text-left">
          <h3 class="text-md font-semibold text-teal-400 mb-2">Active Accounts:</h3>
          <div id="existingUsersList">
              <p class="text-sm text-gray-400 p-2">No accounts found.</p>
          </div>
      </div>
      <div class="modal-footer">
        <a id="backToLoginFromCreate" tabindex="0">Already have an account? Login</a>
      </div>
    </div>
  </div>

  <div id="forgotPassModal" class="modal-backdrop" aria-modal="true" role="dialog" aria-labelledby="forgotPassTitle"
    style="display:none;">
    <div class="modal-content">
      <h2 id="forgotPassTitle">Reset Password</h2>
      <input type="text" id="forgotUserEmail" placeholder="Enter Username or Email" autocomplete="username" />
      <button id="forgotPassBtn">Send Reset Link</button>
      <div class="message" id="forgotPassMessage"></div>
      <div class="modal-footer">
        <a id="backToLoginFromForgot" tabindex="0">Back to Login</a>
      </div>
    </div>
  </div>

  <div id="statusModal" class="modal-backdrop" aria-modal="true" role="dialog" aria-labelledby="statusTitle"
    style="display:none;">
    <div class="modal-content">
      <h2 id="statusTitle">Update Status</h2>
      <select id="statusSelector">
        <option value="present">Present</option>
        <option value="absent">Absent</option>
        <option value="holiday">Holiday</option>
      </select>
      <div class="flex gap-4 mt-4">
        <button id="saveStatusBtn" class="w-1/2">Save Status</button>
        <button id="cancelStatusBtn" class="w-1/2 bg-gray-500">Cancel</button>
      </div>
      <div class="message" id="statusMessage"></div>
    </div>
  </div>

  <div id="editDetailsModal" class="modal-backdrop" aria-modal="true" role="dialog"
    aria-labelledby="editDetailsTitle" style="display:none;">
    <div class="modal-content">
      <h2 id="editDetailsTitle">Edit Day Details</h2>
      <label for="editHours">Hours Worked:</label>
      <input type="number" id="editHours" placeholder="e.g., 9" min="0" step="0.5" />

      <label for="editExtraHours">Extra Hours:</label>
      <input type="number" id="editExtraHours" placeholder="e.g., 1" min="0" step="0.5" />

      <div class="flex items-center justify-start mb-4 text-left">
        <input type="checkbox" id="editGrace" class="mr-2 h-4 w-4 rounded accent-teal-500 focus:ring-teal-400 border-gray-600 bg-gray-700">
        <label for="editGrace" class="text-sm font-medium !mb-0">Use Grace Period</label>
      </div>

      <label for="editShift">Shift:</label>
      <select id="editShift">
        <option value="">Select Shift</option>
        <option value="day">Day</option>
        <option value="night">Night</option>
      </select>

      <div class="flex gap-4 mt-4">
        <button id="saveEditDetailsBtn" class="w-1/2">Save Details</button>
        <button id="cancelEditDetailsBtn" class="w-1/2 bg-gray-500">Cancel</button>
      </div>
      <div class="message" id="editDetailsMessage"></div>
    </div>
  </div>

  <div id="selectProfilePicModal" class="modal-backdrop" aria-modal="true" role="dialog"
    aria-labelledby="selectProfilePicTitle" style="display:none;">
    <div class="modal-content">
      <h2 id="selectProfilePicTitle">Choose Your Avatar</h2>
      <div class="profile-pic-options">
        </div>
      <div class="flex gap-4 mt-4">
        <button id="saveProfilePicBtn" class="w-1/2">Set Avatar</button>
        <button id="cancelProfilePicBtn" class="w-1/2 bg-gray-500">Cancel</button>
      </div>
      <div class="message" id="profilePicMessage"></div>
    </div>
  </div>

  <div id="appContainer">
    <nav id="navbar" class="flex justify-between items-center px-6 py-3 fixed w-full top-0 left-0 right-0 z-50">
      <div class="font-bold text-xl select-none"><img width="38" height="38" src="https://img.icons8.com/fluency/48/animated.png" alt="animated"/>KEEP YOUR INFORMATION. PAGE WILL BE UPDATED ON 28th July.</div>
      <div class="relative flex items-center gap-4">
        <span id="usernameDisplay" class="font-semibold text-lg mr-2 text-teal-300"></span>
        <img id="userPhoto" src="https://placehold.co/40x40/1A1A2E/00F5A0?text=U" alt="User Photo" class="user-photo" />
        <div id="userDropdown" class="dropdown-menu">
          <a href="#" id="profileLink">My Profile</a>
          <a href="#" id="attendanceHistoryLink">View History</a>
          <a href="#" id="changeProfilePicLink">Change Avatar</a>
          <a href="#" id="logoutBtnDropdown">Logout</a>
        </div>
      </div>
    </nav>

    <main id="mainContent" class="max-w-7xl mx-auto pt-24 px-4 sm:px-6 lg:px-8 rounded-xl mb-10">
      <div class="mb-10 flex justify-center items-center">
        <label for="monthSelect" class="mr-3 font-semibold text-lg text-teal-300">Month Period:</label>
        <select id="monthSelect"></select>
      </div>

      <div class="mb-10 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 text-center summary-grid">
        <div>Total Present: <span id="totalPresent">0</span></div>
        <div>Total Hours: <span id="totalHours">0</span></div>
        <div>Extra Hours: <span id="totalExtraHours">0</span></div>
        <div>Late: <span id="totalLate">0</span></div>
        <div>Absent: <span id="totalAbsent">0</span></div>
        <div>Holiday: <span id="totalHoliday">0</span></div>
        <div>Working Days: <span id="totalWorkingDays">0</span></div>
        <div>Grace Used: <span id="graceUsedCount">0</span></div>
        <div>Shifts (Day): <span id="totalDayShifts">0</span></div>
        <div>Shifts (Night): <span id="totalNightShifts">0</span></div>
      </div>

      <div class="overflow-x-auto">
        <table class="min-w-full" id="attendanceTable">
          <thead>
            <tr>
              <th>Date</th>
              <th>Day</th>
              <th>Status</th>
              <th>Hours</th>
              <th>Extra Hours</th>
              <th>Late (9-Hrs)</th>
              <th>Grace</th>
              <th>Shift</th>
            </tr>
          </thead>
          <tbody id="attendanceTbody">
            </tbody>
        </table>
      </div>
    </main>

    <footer id="app-footer">
      Crafted by <a href="#" target="_blank" rel="noopener noreferrer">@Pranto_Anthony_Rodrix</a>
    </footer>
  </div>

  <script>
    /* =============== LOGIN SYSTEM LOGIC (UNCHANGED from previous version) =============== */
    const USER_DB_KEY = "attendance_users_colorful";
    const LOGGED_IN_USER_KEY = "attendance_logged_in_user_colorful";

    function getUsers() { const users = localStorage.getItem(USER_DB_KEY); return users ? JSON.parse(users) : {}; }
    function saveUsers(users) { localStorage.setItem(USER_DB_KEY, JSON.stringify(users)); }
    function saveLoggedInUser(username) { localStorage.setItem(LOGGED_IN_USER_KEY, username); }
    function removeLoggedInUser() { localStorage.removeItem(LOGGED_IN_USER_KEY); }
    function getLoggedInUser() { return localStorage.getItem(LOGGED_IN_USER_KEY); }
    function validateEmail(email) { const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; return re.test(email.toLowerCase());}

    const loginModal = document.getElementById("loginModal");
    const createAccountModal = document.getElementById("createAccountModal");
    const forgotPassModal = document.getElementById("forgotPassModal");
    const statusModal = document.getElementById("statusModal");
    const editDetailsModal = document.getElementById("editDetailsModal");
    const selectProfilePicModal = document.getElementById("selectProfilePicModal");
    const appContainer = document.getElementById("appContainer");
    const loginUserInput = document.getElementById("loginUser");
    const loginPassInput = document.getElementById("loginPass");
    const loginBtn = document.getElementById("loginBtn");
    const loginMessage = document.getElementById("loginMessage");
    const createUsernameInput = document.getElementById("createUsername");
    const createEmailInput = document.getElementById("createEmail");
    const createPasswordInput = document.getElementById("createPassword");
    const createConfirmPasswordInput = document.getElementById("createConfirmPassword");
    const createAccountBtn = document.getElementById("createAccountBtn");
    const createAccountMessage = document.getElementById("createAccountMessage");
    const existingUsersList = document.getElementById("existingUsersList");
    const forgotUserEmailInput = document.getElementById("forgotUserEmail");
    const forgotPassBtn = document.getElementById("forgotPassBtn");
    const forgotPassMessage = document.getElementById("forgotPassMessage");
    const statusSelector = document.getElementById("statusSelector");
    const saveStatusBtn = document.getElementById("saveStatusBtn");
    const cancelStatusBtn = document.getElementById("cancelStatusBtn");
    const statusMessage = document.getElementById("statusMessage");
    let currentEditingDate = null;
    const editHoursInput = document.getElementById("editHours");
    const editExtraHoursInput = document.getElementById("editExtraHours");
    const editGraceCheckbox = document.getElementById("editGrace");
    const editShiftSelect = document.getElementById("editShift");
    const saveEditDetailsBtn = document.getElementById("saveEditDetailsBtn");
    const cancelEditDetailsBtn = document.getElementById("cancelEditDetailsBtn");
    const editDetailsMessage = document.getElementById("editDetailsMessage");
    const userPhoto = document.getElementById("userPhoto");
    const usernameDisplay = document.getElementById("usernameDisplay");
    const userDropdown = document.getElementById("userDropdown");
    const logoutBtnDropdown = document.getElementById("logoutBtnDropdown");
    const changeProfilePicLink = document.getElementById("changeProfilePicLink");
    const profilePicOptionsContainer = selectProfilePicModal.querySelector('.profile-pic-options');
    const saveProfilePicBtn = document.getElementById('saveProfilePicBtn');
    const cancelProfilePicBtn = document.getElementById('cancelProfilePicBtn');
    const profilePicMessage = document.getElementById('profilePicMessage');
    let selectedProfilePicUrl = '';

    document.getElementById("showCreateAccount").addEventListener("click", () => { hideModal(loginModal); showModal(createAccountModal); clearMessages(); clearCreateAccountFields(); populateExistingUsersList(); });
    document.getElementById("showForgotPass").addEventListener("click", () => { hideModal(loginModal); showModal(forgotPassModal); clearMessages(); forgotUserEmailInput.value = ""; });
    document.getElementById("backToLoginFromCreate").addEventListener("click", () => { hideModal(createAccountModal); showModal(loginModal); clearMessages(); clearLoginFields(); });
    document.getElementById("backToLoginFromForgot").addEventListener("click", () => { hideModal(forgotPassModal); showModal(loginModal); clearMessages(); clearLoginFields(); });

    function clearMessages() { loginMessage.textContent = ""; loginMessage.className = "message"; createAccountMessage.textContent = ""; createAccountMessage.className = "message"; forgotPassMessage.textContent = ""; forgotPassMessage.className = "message"; statusMessage.textContent = ""; statusMessage.className = "message"; editDetailsMessage.textContent = ""; editDetailsMessage.className = "message"; profilePicMessage.textContent = ""; profilePicMessage.className = "message"; }
    function clearLoginFields() { loginUserInput.value = ""; loginPassInput.value = ""; }
    function clearCreateAccountFields() { createUsernameInput.value = ""; createEmailInput.value = ""; createPasswordInput.value = ""; createConfirmPasswordInput.value = ""; }

    function showModal(modalElement) { modalElement.style.display = "flex"; requestAnimationFrame(() => { modalElement.classList.add("show"); }); }
    function hideModal(modalElement) { modalElement.classList.remove("show"); modalElement.addEventListener('transitionend', function handler() { if (!modalElement.classList.contains('show')) { modalElement.style.display = "none"; } modalElement.removeEventListener('transitionend', handler); }); }

    function populateExistingUsersList() {
        existingUsersList.innerHTML = ''; const users = getUsers(); const userCount = Object.keys(users).length;
        if (userCount === 0) { existingUsersList.innerHTML = '<p class="text-sm text-gray-400 p-2">No accounts found.</p>'; return; }
        for (const username in users) { const userItem = document.createElement('div'); userItem.className = 'user-item'; const userPhotoUrl = users[username].profilePhotoUrl || `https://placehold.co/24x24/1A1A2E/00F5A0?text=${username.charAt(0).toUpperCase()}`; userItem.innerHTML = `<img src="${userPhotoUrl}" alt="${username} photo"><span>${username}</span>`; existingUsersList.appendChild(userItem); }
    }

    loginBtn.addEventListener("click", () => {
      clearMessages(); const userInput = loginUserInput.value.trim(); const passInput = loginPassInput.value;
      if (!userInput || !passInput) { loginMessage.textContent = "Please fill in all fields."; loginMessage.classList.add("error"); return; }
      const users = getUsers(); let foundUser = null;
      for (const username in users) { if (username.toLowerCase() === userInput.toLowerCase() || users[username].email.toLowerCase() === userInput.toLowerCase()) { foundUser = { username, ...users[username] }; break; } }
      if (!foundUser) { loginMessage.textContent = "User not found."; loginMessage.classList.add("error"); return; }
      if (foundUser.password !== passInput) { loginMessage.textContent = "Incorrect password."; loginMessage.classList.add("error"); return; }
      saveLoggedInUser(foundUser.username); loginMessage.textContent = "Login successful! Redirecting..."; loginMessage.classList.add("success");
      setTimeout(() => { hideModal(loginModal); appContainer.style.display = "flex"; initAppForUser(foundUser.username); }, 1000);
    });

    createAccountBtn.addEventListener("click", () => {
      clearMessages(); const username = createUsernameInput.value.trim(); const email = createEmailInput.value.trim(); const password = createPasswordInput.value; const confirmPassword = createConfirmPasswordInput.value;
      if (!username || !email || !password || !confirmPassword) { createAccountMessage.textContent = "Please fill in all fields."; createAccountMessage.classList.add("error"); return; }
      if (!validateEmail(email)) { createAccountMessage.textContent = "Invalid email format."; createAccountMessage.classList.add("error"); return; }
      if (password.length < 6) { createAccountMessage.textContent = "Password must be at least 6 characters."; createAccountMessage.classList.add("error"); return; }
      if (password !== confirmPassword) { createAccountMessage.textContent = "Passwords do not match."; createAccountMessage.classList.add("error"); return; }
      const users = getUsers(); if (users[username]) { createAccountMessage.textContent = "Username already exists."; createAccountMessage.classList.add("error"); return; }
      for (const user in users) { if (users[user].email.toLowerCase() === email.toLowerCase()) { createAccountMessage.textContent = "Email already registered."; createAccountMessage.classList.add("error"); return; } }
      users[username] = { email, password, profilePhotoUrl: `https://placehold.co/40x40/1A1A2E/00F5A0?text=${username.charAt(0).toUpperCase()}` }; saveUsers(users);
      createAccountMessage.textContent = "Account created successfully!"; createAccountMessage.classList.add("success"); populateExistingUsersList();
      setTimeout(() => { hideModal(createAccountModal); showModal(loginModal); clearLoginFields(); clearCreateAccountFields(); clearMessages(); }, 1500);
    });

    forgotPassBtn.addEventListener("click", () => {
      clearMessages(); const inputUser = forgotUserEmailInput.value.trim();
      if (!inputUser) { forgotPassMessage.textContent = "Please enter your username or email."; forgotPassMessage.classList.add("error"); return; }
      const users = getUsers(); let foundUser = null;
      for (const username in users) { if (username.toLowerCase() === inputUser.toLowerCase() || users[username].email.toLowerCase() === inputUser.toLowerCase()) { foundUser = { username, ...users[username] }; break; } }
      if (!foundUser) { forgotPassMessage.textContent = "User not found."; forgotPassMessage.classList.add("error"); return; }
      forgotPassMessage.textContent = `Password reset link would be sent to ${foundUser.email} (simulated).`; forgotPassMessage.classList.add("success");
      setTimeout(() => { hideModal(forgotPassModal); showModal(loginModal); forgotUserEmailInput.value = ""; clearMessages(); }, 2500);
    });

    logoutBtnDropdown.addEventListener("click", () => { removeLoggedInUser(); appContainer.style.display = "none"; userDropdown.classList.remove("show"); showModal(loginModal); clearLoginFields(); clearMessages(); });
    userPhoto.addEventListener("click", (event) => { event.stopPropagation(); userDropdown.classList.toggle("show"); });
    window.addEventListener("click", (event) => { if (!userPhoto.contains(event.target) && !userDropdown.contains(event.target)) { userDropdown.classList.remove("show"); } });
    changeProfilePicLink.addEventListener("click", (event) => { event.preventDefault(); userDropdown.classList.remove("show"); clearMessages(); populateProfilePicOptions(); showModal(selectProfilePicModal); });

    function populateProfilePicOptions() {
        profilePicOptionsContainer.innerHTML = ''; const currentLoggedInUser = getLoggedInUser(); const users = getUsers(); const currentUserData = users[currentLoggedInUser]; const currentProfilePhotoUrl = currentUserData ? currentUserData.profilePhotoUrl : '';
        const pravatarSeeds = [ 'orb-teal', 'orb-magenta', 'orb-yellow', 'abstract-blue', 'abstract-green', 'tech-grid', 'neon-lines', 'user-glow', 'initials-dark' ];
        pravatarSeeds.forEach(seed => {
            const img = document.createElement('img'); let url;
            if (seed === 'initials-dark' && currentLoggedInUser) { url = `https://placehold.co/55x55/1A1A2E/00F5A0?text=${currentLoggedInUser.charAt(0).toUpperCase()}&font=inter`; }
            else { url = `https://i.pravatar.cc/55?u=${encodeURIComponent(seed)}`; } // Using pravatar for variety, can be replaced
            img.src = url; img.alt = `Profile Picture Option ${seed}`; img.dataset.url = url;
            if (url === currentProfilePhotoUrl) { img.classList.add('selected'); selectedProfilePicUrl = url; }
            img.addEventListener('click', () => { profilePicOptionsContainer.querySelectorAll('img').forEach(option => option.classList.remove('selected')); img.classList.add('selected'); selectedProfilePicUrl = img.dataset.url; });
            profilePicOptionsContainer.appendChild(img);
        });
    }

    saveProfilePicBtn.addEventListener("click", () => {
        if (selectedProfilePicUrl) {
            const currentLoggedInUser = getLoggedInUser(); const users = getUsers();
            if (users[currentLoggedInUser]) { users[currentLoggedInUser].profilePhotoUrl = selectedProfilePicUrl; saveUsers(users); userPhoto.src = selectedProfilePicUrl; profilePicMessage.textContent = "Avatar updated!"; profilePicMessage.classList.add("success"); setTimeout(() => { hideModal(selectProfilePicModal); clearMessages(); }, 1000); }
            else { profilePicMessage.textContent = "Error: User not found."; profilePicMessage.classList.add("error"); }
        } else { profilePicMessage.textContent = "Please select an avatar."; profilePicMessage.classList.add("error"); }
    });

    cancelProfilePicBtn.addEventListener("click", () => { hideModal(selectProfilePicModal); clearMessages(); });

    window.addEventListener("load", () => {
      const loggedInUser = getLoggedInUser();
      if (loggedInUser) { loginModal.style.display = "none"; appContainer.style.display = "flex"; initAppForUser(loggedInUser); }
      else { showModal(loginModal); appContainer.style.display = "none"; }
    });

    window.addEventListener('scroll', () => { const navbar = document.getElementById('navbar'); if (window.scrollY > 10) { navbar.classList.add('scrolled'); } else { navbar.classList.remove('scrolled'); } });

    /* ================== ATTENDANCE TRACKER LOGIC (UNCHANGED from previous version) =================== */
    const GRACE_LIMIT_PER_MONTH = 5;
    function formatDate(d) { return d.toISOString().slice(0, 10); }
    function getDateRange(yearMonth) { const [year, month] = yearMonth.split("-").map(Number); let startDate = new Date(year, month - 1 - 1, 26); let endDate = new Date(year, month - 1, 25); return { startDate, endDate }; }

    function wouldExceedConsecutiveGraceLimit(targetDateStr, attendanceData) {
      const targetDate = new Date(targetDateStr); let consecutiveGraceCount = 0; const selectedMonth = monthSelect.value; const { startDate: periodStartDate } = getDateRange(selectedMonth);
      for (let i = 1; i <= 2; i++) { const prevDate = new Date(targetDate); prevDate.setDate(targetDate.getDate() - i); const prevDateStr = formatDate(prevDate); const prevDayData = attendanceData[prevDateStr]; if (prevDate >= periodStartDate && prevDayData && prevDayData.status === 'present' && prevDayData.graceUsed) { consecutiveGraceCount++; } else { break; } }
      return consecutiveGraceCount === 2;
    }

    function initAppForUser(username) {
      const users = getUsers(); const currentUserData = users[username];
      if (currentUserData && currentUserData.profilePhotoUrl) { userPhoto.src = currentUserData.profilePhotoUrl; } else { userPhoto.src = `https://placehold.co/40x40/1A1A2E/00F5A0?text=${username.charAt(0).toUpperCase()}&font=inter`; }
      usernameDisplay.textContent = username;
      const attendanceTbody = document.getElementById("attendanceTbody"); const monthSelect = document.getElementById("monthSelect"); const totalPresent = document.getElementById("totalPresent"); const totalHours = document.getElementById("totalHours"); const totalExtraHours = document.getElementById("totalExtraHours"); const totalLate = document.getElementById("totalLate"); const totalAbsent = document.getElementById("totalAbsent"); const totalHoliday = document.getElementById("totalHoliday"); const totalWorkingDays = document.getElementById("totalWorkingDays"); const graceUsedCount = document.getElementById("graceUsedCount"); const totalDayShifts = document.getElementById("totalDayShifts"); const totalNightShifts = document.getElementById("totalNightShifts");
      const STORAGE_KEY = "attendance_data_" + username + "_colorful";

      function loadAttendanceData() { const data = localStorage.getItem(STORAGE_KEY); return data ? JSON.parse(data) : {}; }
      function saveAttendanceData(data) { localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }
      function getGraceCountForMonth(monthKey) { const attendanceData = loadAttendanceData(); return attendanceData[monthKey + '-graceCount'] || 0; }
      function saveGraceCountForMonth(monthKey, count) { const attendanceData = loadAttendanceData(); attendanceData[monthKey + '-graceCount'] = count; saveAttendanceData(attendanceData); }
      function formatMonthYear(date) { return date.toLocaleString('default', { month: 'long', year: 'numeric' }); }

      function populateMonthSelect() {
        const select = document.getElementById('monthSelect'); select.innerHTML = ''; const today = new Date(); const currentYear = today.getFullYear(); const currentMonth = today.getMonth();
        for (let i = -11; i <= 6; i++) { const targetMonthDate = new Date(currentYear, currentMonth + i, 1); const endDate = new Date(targetMonthDate.getFullYear(), targetMonthDate.getMonth(), 25); const label = formatMonthYear(endDate); const optionText = `${label}`; const value = `${endDate.getFullYear()}-${String(endDate.getMonth() + 1).padStart(2, '0')}`; const option = document.createElement('option'); option.value = value; option.textContent = optionText; select.appendChild(option); }
      }
      function getDayName(d) { return d.toLocaleDateString(undefined, { weekday: "short" }); }

      function renderTable() {
        const selected = monthSelect.value; if (!selected) return; const { startDate, endDate } = getDateRange(selected); const currentMonthKey = selected; attendanceTbody.innerHTML = "";
        const attendanceData = loadAttendanceData(); let currentMonthGraceCount = getGraceCountForMonth(currentMonthKey);
        let sumPresent = 0, sumHours = 0, sumExtraHours = 0, sumLate = 0, sumAbsent = 0, sumHoliday = 0, sumWorkingDays = 0, sumDayShifts = 0, sumNightShifts = 0;

        for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
          const dateStr = formatDate(d); const dayName = getDayName(d);
          const dayData = attendanceData[dateStr] || { status: '', holiday: false, hoursWorked: 0, extraHours: 0, lateHours: 0, graceUsed: false, shiftType: '' };
          if (dayData.status === 'present' && !dayData.holiday) { dayData.lateHours = Math.max(0, 9 - dayData.hoursWorked); } else { dayData.lateHours = 0; }
          if (dayData.status === 'present') sumPresent++; if (dayData.status === 'absent') sumAbsent++; if (dayData.holiday) sumHoliday++; sumHours += dayData.hoursWorked; sumExtraHours += dayData.extraHours; sumLate += dayData.lateHours; if (dayData.status === 'present' || dayData.status === 'absent') sumWorkingDays++; if (dayData.shiftType === 'day') sumDayShifts++; if (dayData.shiftType === 'night') sumNightShifts++;

          const tr = document.createElement("tr");
          if (dayData.holiday) tr.classList.add("row-holiday"); else if (dayData.status === 'present') tr.classList.add("row-present"); else if (dayData.status === 'absent') tr.classList.add("row-absent");
          tr.innerHTML = `<td class="select-none">${dateStr}</td><td class="select-none">${dayName}</td><td class="status-cell" data-date="${dateStr}"></td><td>${dayData.status === 'present' ? dayData.hoursWorked.toFixed(1) : '-'}</td><td>${dayData.status === 'present' ? dayData.extraHours.toFixed(1) : '-'}</td><td class="select-none ${dayData.lateHours > 0 ? 'font-semibold' : ''}" style="color: ${dayData.lateHours > 0 ? 'var(--absent-text)' : 'inherit'}; text-shadow: ${dayData.lateHours > 0 ? '0 0 3px var(--absent-text)' : 'none'};">${dayData.lateHours > 0 ? dayData.lateHours.toFixed(1) : '-'}</td><td>${dayData.graceUsed ? 'Yes' : '-'}</td><td>${dayData.shiftType ? dayData.shiftType.charAt(0).toUpperCase() + dayData.shiftType.slice(1) : '-'}</td>`;
          const tdStatus = tr.querySelector(".status-cell");
          if (dayData.holiday) { tdStatus.textContent = "H"; tdStatus.classList.add("holiday-h"); } else if (dayData.status === 'present') { tdStatus.textContent = "P"; tdStatus.classList.add("present-p"); } else if (dayData.status === 'absent') { tdStatus.textContent = "A"; tdStatus.classList.add("absent-a"); } else { const addButton = document.createElement("button"); addButton.textContent = "Set"; tdStatus.appendChild(addButton); }
          tdStatus.addEventListener("click", (e) => { currentEditingDate = dateStr; const currentDayData = attendanceData[dateStr] || {}; statusSelector.value = currentDayData.holiday ? "holiday" : (currentDayData.status || "present"); clearMessages(); showModal(statusModal); });
          attendanceTbody.appendChild(tr);
        }
        totalPresent.textContent = sumPresent; totalHours.textContent = sumHours.toFixed(1); totalExtraHours.textContent = sumExtraHours.toFixed(1); totalLate.textContent = sumLate.toFixed(1); totalAbsent.textContent = sumAbsent; totalHoliday.textContent = sumHoliday; totalWorkingDays.textContent = sumWorkingDays; graceUsedCount.textContent = currentMonthGraceCount; totalDayShifts.textContent = sumDayShifts; totalNightShifts.textContent = sumNightShifts;
      }

      saveStatusBtn.addEventListener("click", () => {
        if (!currentEditingDate) { statusMessage.textContent = "Error: No date selected."; statusMessage.classList.add("error"); return; }
        const selectedStatus = statusSelector.value; const attendanceData = loadAttendanceData(); const oldDayData = attendanceData[currentEditingDate] || {}; let dayData = { ...oldDayData }; const currentMonthKey = currentEditingDate.substring(0, 7); let currentMonthGraceCount = getGraceCountForMonth(currentMonthKey);
        if (oldDayData.graceUsed && oldDayData.status === 'present' && selectedStatus !== 'present') { currentMonthGraceCount--; }
        dayData.hoursWorked = 0; dayData.extraHours = 0; dayData.lateHours = 0; dayData.graceUsed = false; dayData.shiftType = '';
        if (selectedStatus === "present") {
          dayData.status = 'present'; dayData.holiday = false; attendanceData[currentEditingDate] = dayData; saveAttendanceData(attendanceData); saveGraceCountForMonth(currentMonthKey, currentMonthGraceCount); renderTable(); hideModal(statusModal);
          editHoursInput.value = oldDayData.hoursWorked || ''; editExtraHoursInput.value = oldDayData.extraHours || ''; editGraceCheckbox.checked = oldDayData.graceUsed || false; editShiftSelect.value = oldDayData.shiftType || 'day';
          const monthlyGraceLimitReached = currentMonthGraceCount >= GRACE_LIMIT_PER_MONTH; const wouldBe3rdConsecutive = wouldExceedConsecutiveGraceLimit(currentEditingDate, attendanceData); editGraceCheckbox.disabled = monthlyGraceLimitReached || wouldBe3rdConsecutive; if (editGraceCheckbox.disabled) { editGraceCheckbox.checked = false; }
          showModal(editDetailsModal);
        } else {
          if (selectedStatus === "absent") { dayData.status = 'absent'; dayData.holiday = false; } else if (selectedStatus === "holiday") { dayData.status = ''; dayData.holiday = true; }
          attendanceData[currentEditingDate] = dayData; saveAttendanceData(attendanceData); saveGraceCountForMonth(currentMonthKey, currentMonthGraceCount); renderTable(); hideModal(statusModal); currentEditingDate = null; clearMessages();
        }
      });
      cancelStatusBtn.addEventListener("click", () => { hideModal(statusModal); currentEditingDate = null; clearMessages(); });

      saveEditDetailsBtn.addEventListener("click", () => {
        if (!currentEditingDate) { editDetailsMessage.textContent = "Error: No date selected."; editDetailsMessage.classList.add("error"); return; }
        const attendanceData = loadAttendanceData(); let dayData = attendanceData[currentEditingDate] || {}; const oldGraceUsed = dayData.graceUsed;
        dayData.hoursWorked = parseFloat(editHoursInput.value) || 0; dayData.extraHours = parseFloat(editExtraHoursInput.value) || 0; dayData.graceUsed = editGraceCheckbox.checked; dayData.shiftType = editShiftSelect.value || ''; dayData.lateHours = Math.max(0, 9 - dayData.hoursWorked);
        const currentMonthKey = currentEditingDate.substring(0, 7); let currentMonthGraceCount = getGraceCountForMonth(currentMonthKey);
        if (dayData.graceUsed && !oldGraceUsed) {
          if (currentMonthGraceCount >= GRACE_LIMIT_PER_MONTH) { editDetailsMessage.textContent = `Grace limit (${GRACE_LIMIT_PER_MONTH}) reached.`; editDetailsMessage.classList.add("error"); dayData.graceUsed = false; editGraceCheckbox.checked = false; return; }
          if (wouldExceedConsecutiveGraceLimit(currentEditingDate, attendanceData)) { editDetailsMessage.textContent = "Cannot apply: 3 consecutive grace not allowed."; editDetailsMessage.classList.add("error"); dayData.graceUsed = false; editGraceCheckbox.checked = false; return; }
          currentMonthGraceCount++;
        } else if (!dayData.graceUsed && oldGraceUsed) { currentMonthGraceCount--; }
        attendanceData[currentEditingDate] = dayData; saveAttendanceData(attendanceData); saveGraceCountForMonth(currentMonthKey, currentMonthGraceCount); renderTable(); hideModal(editDetailsModal); currentEditingDate = null; clearMessages();
      });
      cancelEditDetailsBtn.addEventListener("click", () => { hideModal(editDetailsModal); currentEditingDate = null; clearMessages(); });

      populateMonthSelect();
      const today = new Date();
      const currentPeriodYear = today.getDate() >= 26 ? (today.getMonth() === 11 ? today.getFullYear() + 1 : today.getFullYear()) : today.getFullYear();
      const currentPeriodMonth = today.getDate() >= 26 ? (today.getMonth() === 11 ? 1 : today.getMonth() + 2) : today.getMonth() + 1;
      monthSelect.value = `${currentPeriodYear}-${String(currentPeriodMonth).padStart(2, '0')}`;
      renderTable();
      monthSelect.addEventListener("change", renderTable);
    }
  </script>
</body>
</html>
