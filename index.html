<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Dashboard</title>
    
    <!-- Google Font: Roboto -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        /* --- Base & Typography --- */
        :root {
            /* Fonts */
            --bs-body-font-family: 'Roboto', sans-serif;
            --bs-heading-font-family: 'Roboto', sans-serif;
            
            /* Custom light theme colors */
            --bs-light-bg-subtle: #f8f9fa;
            --bs-body-bg-light: #f8f9fa;
            --bs-tertiary-bg-light: #ffffff;
            --bs-secondary-bg-light: #e9ecef;
            --bs-border-color-light: #dee2e6;

            /* Custom dark theme colors */
            --bs-body-bg-dark: #121212; /* Darker body */
            --bs-body-color-dark: #e0e0e0;
            --bs-tertiary-bg-dark: #1e1e1e; /* Card backgrounds */
            --bs-secondary-bg-dark: #2a2a2a; /* Hover, table headers */
            --bs-border-color-dark: #3a3a3a;
            --bs-light-bg-subtle-dark: #1e1e1e;
            
            /* Status Colors (Gradients) */
            --status-present-gradient: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.05));
            --status-present-text: #198754;
            --status-absent-gradient: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.05));
            --status-absent-text: #dc3545;
            --status-weekend-gradient: linear-gradient(135deg, rgba(13, 110, 253, 0.1), rgba(13, 110, 253, 0.05));
            --status-weekend-text: #0d6efd;
            --status-holiday-gradient: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.05));
            --status-holiday-text: #ffc107;
            --status-default-bg: transparent;

            /* Dark Status Colors (Gradients) */
            --status-present-gradient-dark: linear-gradient(135deg, rgba(40, 167, 69, 0.2), rgba(40, 167, 69, 0.1));
            --status-present-text-dark: #34c356;
            --status-absent-gradient-dark: linear-gradient(135deg, rgba(220, 53, 69, 0.2), rgba(220, 53, 69, 0.1));
            --status-absent-text-dark: #ea5462;
            --status-weekend-gradient-dark: linear-gradient(135deg, rgba(13, 110, 253, 0.2), rgba(13, 110, 253, 0.1));
            --status-weekend-text-dark: #3c8aff;
            --status-holiday-gradient-dark: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 193, 7, 0.1));
            --status-holiday-text-dark: #ffca2c;
            --status-default-bg-dark: transparent;
        }

        /* Add smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        [data-bs-theme="light"] {
            --bs-body-bg: var(--bs-body-bg-light);
            --bs-body-color: var(--bs-body-color-light);
            --bs-tertiary-bg: var(--bs-tertiary-bg-light);
            --bs-secondary-bg: var(--bs-secondary-bg-light);
            --bs-border-color: var(--bs-border-color-light);
            --bs-light-bg-subtle: var(--bs-light-bg-subtle-light);
        }

        [data-bs-theme="dark"] {
            --bs-body-bg: var(--bs-body-bg-dark);
            --bs-body-color: var(--bs-body-color-dark);
            --bs-tertiary-bg: var(--bs-tertiary-bg-dark);
            --bs-secondary-bg: var(--bs-secondary-bg-dark);
            --bs-border-color: var(--bs-border-color-dark);
            --bs-light-bg-subtle: var(--bs-light-bg-subtle-dark);

            --status-present-gradient: var(--status-present-gradient-dark);
            --status-present-text: var(--status-present-text-dark);
            --status-absent-gradient: var(--status-absent-gradient-dark);
            --status-absent-text: var(--status-absent-text-dark);
            --status-weekend-gradient: var(--status-weekend-gradient-dark);
            --status-weekend-text: var(--status-weekend-text-dark);
            --status-holiday-gradient: var(--status-holiday-gradient-dark);
            --status-holiday-text: var(--status-holiday-text-dark);
            --status-default-bg: var(--status-default-bg-dark);
        }

        body {
            font-family: var(--bs-body-font-family);
            background-color: var(--bs-body-bg);
            transition: background-color 0.3s ease;
        }
        
        /* Elegant Headers */
        h1, h2, h3, h4, h5, h6, .display-4, .sidebar-title, .fw-bold {
            font-family: var(--bs-heading-font-family);
            font-weight: 700;
        }

        /* General Animations */
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn-primary:hover {
            transform: scale(1.03);
            box-shadow: 0 4px 15px rgba(var(--bs-primary-rgb), 0.3);
        }
        .btn-outline-primary:hover {
            transform: scale(1.03);
        }
        .btn-outline-danger:hover {
            transform: scale(1.03);
        }
        .btn-outline-secondary:hover {
            transform: scale(1.03);
        }


        /* --- Page Sections --- */
        .page-section {
            padding-top: 2.5rem;
        }
        #profile-section {
            padding-top: 0;
        }

        /* --- NEW: Gorgeous Login Page --- */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #login-page {
            min-height: 100vh;
            display: flex; /* Shown/hidden by JS */
            align-items: center;
            justify-content: center;
            padding: 1rem;
            /* Full-page animated gradient */
            background: linear-gradient(-45deg, #0d6efd, #6f42c1, #d63384, #fd7e14);
            background-size: 400% 400%;
            animation: fadeIn 1s ease-out, gradientBG 20s ease infinite;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .login-form-container {
            width: 100%;
            max-width: 420px;
            /* Glassmorphism Card */
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 2.5rem;
            color: #ffffff;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            animation: slideUp 0.8s ease-out forwards;
        }

        .login-form-container .form-label {
            font-weight: 500;
            color: rgba(255, 255, 255, 0.9);
        }
        .login-form-container .form-control {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: #ffffff;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .login-form-container .form-control:focus {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.2);
            color: #ffffff;
        }
        .login-form-container .form-control::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        .login-form-container .btn-primary {
            background: #ffffff;
            color: #0d6efd;
            border: none;
            padding: 0.75rem;
            font-weight: 700;
        }
        .login-form-container .btn-primary:hover {
            background: #f0f0f0;
            color: #0056b3;
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .login-icon {
            font-size: 3.5rem;
            color: #fff;
            margin-bottom: 1rem;
            text-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .login-title {
            font-weight: 700;
            margin-bottom: 1.5rem;
        }

        /* --- Dashboard Layout --- */
        #dashboard-page {
            min-height: 100vh;
            display: none; /* Hidden by default, shown by JS on login */
        }

        /* --- Sidebar --- */
        #sidebar {
            width: 280px;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background-color: var(--bs-tertiary-bg);
            border-right: 1px solid var(--bs-border-color);
            transition: width 0.3s ease;
            z-index: 1020;
        }
        #sidebar .nav-link {
            color: var(--bs-secondary-color);
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }
        #sidebar .nav-link i {
            font-size: 1.25rem;
            margin-right: 1rem;
            width: 20px;
            transition: margin 0.3s ease;
        }
        #sidebar .nav-link:hover {
            background-color: var(--bs-secondary-bg);
            color: var(--bs-primary);
            transform: translateX(5px);
        }
        #sidebar .nav-link.active {
            background-color: var(--bs-primary);
            color: #fff;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(var(--bs-primary-rgb), 0.3);
        }
        .sidebar-title {
            transition: opacity 0.3s ease;
        }
        .nav-link-text {
            transition: opacity 0.3s ease;
            opacity: 1;
            white-space: nowrap;
        }

        /* Sidebar Minimized State */
        #sidebar.minimized {
            width: 90px;
        }
        #sidebar.minimized .sidebar-title,
        #sidebar.minimized .nav-link-text {
            opacity: 0;
            width: 0;
            overflow: hidden;
            display: none;
        }
        #sidebar.minimized .nav-link {
            justify-content: center;
        }
        #sidebar.minimized .nav-link i {
            margin-right: 0;
        }
        #sidebar.minimized .nav-link:hover {
            transform: translateX(0);
        }
        #sidebar.minimized #sidebar-toggle-button {
            transform: rotate(180deg);
        }
        #sidebar-toggle-button {
            transition: transform 0.3s ease;
        }

        /* --- Main Content --- */
        #main-content {
            margin-left: 280px;
            width: calc(100% - 280px);
            transition: margin-left 0.3s ease, width 0.3s ease;
            padding: 2.5rem;
            overflow-x: hidden;
        }
        #main-content.sidebar-minimized {
            margin-left: 90px;
            width: calc(100% - 90px);
        }

        /* --- Profile Section --- */
        .profile-pic {
            width: 300px;
            height: Auto;
            object-fit: cover;
            border: 5px solid var(--bs-primary);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* --- Gradient Cards (Performance & Dashboard) --- */
        .gradient-card {
            border: none;
            transition: all 0.3s ease;
            background-size: 200% 200%;
        }
        .gradient-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        [data-bs-theme="dark"] .gradient-card:hover {
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }
        .grad-1 { background-image: linear-gradient(to right, #d1e7dd, #cce3de, var(--bs-tertiary-bg)); }
        .grad-2 { background-image: linear-gradient(to right, #cff4fc, #d6dffc, var(--bs-tertiary-bg)); }
        .grad-3 { background-image: linear-gradient(to right, #fff3cd, #fde4e4, var(--bs-tertiary-bg)); }
        .grad-4 { background-image: linear-gradient(to right, #f8d7da, #e2e3e5, var(--bs-tertiary-bg)); }
        
        [data-bs-theme="dark"] .grad-1 { background-image: linear-gradient(to right, #0d1a13, #0c151e, var(--bs-tertiary-bg-dark)); }
        [data-bs-theme="dark"] .grad-2 { background-image: linear-gradient(to right, #03151f, #0f1325, var(--bs-tertiary-bg-dark)); }
        [data-bs-theme="dark"] .grad-3 { background-image: linear-gradient(to right, #241c0a, #231118, var(--bs-tertiary-bg-dark)); }
        [data-bs-theme="dark"] .grad-4 { background-image: linear-gradient(to right, #2b1114, #1c1d1e, var(--bs-tertiary-bg-dark)); }


        /* --- Slideshow --- */
        .carousel-item {
            height: 400px;
            transition: opacity 0.8s ease-in-out; /* Smoother fade transition */
        }
        .carousel-item::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.4);
            z-index: 1;
            transition: background 0.3s ease;
        }
        [data-bs-theme="dark"] .carousel-item::before {
            background: rgba(0,0,0,0.6);
        }
        .slide-content {
            position: relative;
            z-index: 2;
        }
        .slide-table {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            transition: background 0.3s ease;
        }
        [data-bs-theme="dark"] .slide-table {
            background: rgba(0,0,0,0.2);
        }

        /* --- Calendar --- */
        .calendar-wrapper {
            position: relative;
            background-color: var(--bs-tertiary-bg);
        }
        .calendar-wrapper::before {
            content: '\F28B';
            font-family: "bootstrap-icons" !important;
            font-size: 10rem;
            color: var(--bs-secondary-bg);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.5;
            z-index: 0;
        }
        #calendar-grid {
            z-index: 1;
            position: relative;
        }
        .calendar-day-item {
            height: 35px;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s ease;
            background-color: var(--bs-secondary-bg);
            opacity: 0.8;
        }
        .calendar-day-item.today {
            border: 2px solid var(--bs-primary);
            box-shadow: 0 0 5px var(--bs-primary);
        }
        .calendar-day-item.has-data {
            opacity: 1;
        }
        
        /* --- Monthly Summary Boxes --- */
        .summary-card {
            /* Now uses gradient-card styles */
            border: 1px solid var(--bs-border-color);
        }
        .summary-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.07);
        }
        [data-bs-theme="dark"] .summary-card:hover {
             box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .summary-card .icon {
            font-size: 1.5rem;
        }
        .summary-card .value {
            font-size: 1.75rem;
            font-weight: 700;
        }

        /* --- Attendance Input (Table View) --- */
        .table-responsive-wrapper {
            max-height: 70vh;
            overflow-y: auto;
            border: 1px solid var(--bs-border-color);
            background-color: var(--bs-tertiary-bg);
        }
        .attendance-table {
            font-size: 0.9rem;
            width: 100%; /* Force table to 100% width */
            table-layout: fixed; /* Respect column widths */
            border-collapse: separate;
            border-spacing: 0;
        }
        .attendance-table thead th {
            background-color: var(--bs-secondary-bg);
            position: sticky;
            top: 0;
            z-index: 1;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }
        .attendance-table tbody tr {
            transition: background-image 0.3s ease, background-color 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        .attendance-table tbody tr:hover {
            transform: scale(1.01); /* Subtle hover zoom on X-axis only */
            transform-origin: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 2;
            position: relative;
        }
        [data-bs-theme="dark"] .attendance-table tbody tr:hover {
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .attendance-table .form-control,
        .attendance-table .form-select,
        .attendance-table .btn {
            font-size: 0.9rem;
            height: 34px;
        }
        .attendance-table td {
            white-space: nowrap; /* Prevent content from wrapping */
            overflow: hidden;
            text-overflow: ellipsis; /* Add ... for overflow */
        }
        /* Allow comments to wrap */
        .attendance-table td:last-child,
        .attendance-table th:last-child {
            white-space: normal;
        }
        /* Ensure inputs in wrapping cells are 100% width */
        .attendance-table td:last-child input {
            width: 100%;
        }


        /* Status Gradient Backgrounds for Rows */
        .status-present-bg { background-image: var(--status-present-gradient); color: var(--status-present-text); }
        .status-absent-bg { background-image: var(--status-absent-gradient); color: var(--status-absent-text); }
        .status-weekend-bg { background-image: var(--status-weekend-gradient); color: var(--status-weekend-text); }
        .status-holiday-bg { background-image: var(--status-holiday-gradient); color: var(--status-holiday-text); }
        .status--bg { background-color: var(--status-default-bg) !important; color: var(--bs-body-color); }
        
        /* Status buttons */
        .status-present { background-color: var(--bs-success); color: white; }
        .status-absent { background-color: var(--bs-danger); color: white; }
        .status-weekend { background-color: var(--bs-primary); color: white; }
        .status-holiday { background-color: var(--bs-warning); color: #000; }
        .status-default { background-color: var(--bs-secondary); color: white; }
        
        /* --- Footer --- */
        #main-footer {
            background-color: var(--bs-tertiary-bg);
            border-top: 1px solid var(--bs-border-color);
            padding: 3rem 1rem;
            margin-top: 3rem;
            color: var(--bs-secondary-color);
        }
        #main-footer h5 {
            color: var(--bs-body-color);
            font-weight: 600;
        }
        #main-footer .footer-links {
            list-style: none;
            padding-left: 0;
        }
        #main-footer .footer-links li {
            margin-bottom: 0.5rem;
        }
        #main-footer .footer-links a {
            text-decoration: none;
            color: var(--bs-secondary-color);
            transition: all 0.2s ease;
        }
        #main-footer .footer-links a:hover {
            color: var(--bs-primary);
            text-decoration: underline;
        }
        #main-footer .social-links a {
            font-size: 1.5rem;
            color: var(--bs-secondary-color);
            margin-right: 1rem;
            transition: all 0.2s ease;
        }
        #main-footer .social-links a:hover {
            color: var(--bs-primary);
            transform: scale(1.1);
        }

        /* --- Modal Zoom Animation --- */
        .modal.zoom .modal-dialog {
            transition: transform 0.3s ease-out, opacity 0.3s ease-out;
            transform: scale(0.5);
            opacity: 0;
        }
        .modal.zoom.show .modal-dialog {
            transform: scale(1);
            opacity: 1;
        }

        /* Responsive */
        @media (max-width: 992px) {
            #main-content {
                padding: 1.5rem;
            }
        }
        @media (max-width: 768px) {
            #sidebar {
                width: 90px;
                z-index: 1030;
            }
            #sidebar .sidebar-title,
            #sidebar .nav-link-text {
                display: none;
                opacity: 0;
            }
            #sidebar .nav-link {
                justify-content: center;
            }
            #sidebar .nav-link i {
                margin-right: 0;
            }
            #main-content {
                margin-left: 90px;
                width: calc(100% - 90px);
                padding: 1rem;
            }
            #main-content.sidebar-minimized {
                margin-left: 90px;
                width: calc(100% - 90px);
            }
            .profile-col-img {
                text-align: center;
            }
            .profile-col-info {
                text-align: center;
            }
            #main-footer {
                padding: 2rem 1rem;
            }
            #main-footer .text-center-md {
                text-align: center !important;
                margin-bottom: 1.5rem;
            }
            /* Allow table to scroll on mobile */
            .attendance-table {
                table-layout: auto; /* Let table resize on mobile */
                width: auto;
            }
        }
    </style>
</head>

<body>

    <!-- ======== LOGIN PAGE (New Design) ======== -->
    <div id="login-page" class="container-fluid p-0">
        <!-- Centered Glassmorphism Card -->
        <div class="login-form-container">
            <div class="text-center">
                <i class="bi bi-bar-chart-line-fill login-icon"></i>
                <h2 class="text-center login-title">My Portfolio</h2>
            </div>
            <form id="login-form">
                <div id="login-alert" class="alert alert-danger d-none" role="alert">
                    Invalid credentials. Please try again.
                </div>
                <div class="mb-3">
                    <label for="email-input" class="form-label">Email address</label>
                    <input type="email" class="form-control form-control-lg" id="email-input" placeholder="user@leverngear.com" required>
                </div>
                <div class="mb-3">
                    <label for="password-input" class="form-label">Password: <b>pranto</b></label>
                    <input type="password" class="form-control form-control-lg" id="password-input" placeholder="Password" required>
                </div>
                <div class="d-grid mt-4">
                    <button type="submit" class="btn btn-primary btn-lg fw-semibold">Login</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ======== DASHBOARD PAGE ======== -->
    <div id="dashboard-page" style="display: none;">
        
        <!-- ======== SIDEBAR ======== -->
        <div id="sidebar" class="d-flex flex-column p-3 shadow-sm">
            <!-- Header -->
            <div class="d-flex align-items-center justify-content-between mb-4">
                <a href="#" class="d-flex align-items-center text-decoration-none text-body">
                    <i class="bi bi-bar-chart-line-fill fs-2 text-primary"></i>
                    <span class="fs-4 ms-2 sidebar-title">Portfolio</span>
                </a>
                <button id="sidebar-toggle-button" class="btn btn-light d-none d-md-block">
                    <i class="bi bi-chevron-left"></i>
                </button>
            </div>
            
            <!-- Navigation -->
            <ul class="nav nav-pills flex-column flex-grow-1">
                <li class="nav-item mb-1">
                    <a href="#profile-section" class="nav-link active">
                        <i class="bi bi-person-circle"></i>
                        <span class="nav-link-text">Profile</span>
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="#performance-section" class="nav-link">
                        <i class="bi bi-activity"></i>
                        <span class="nav-link-text">Performance</span>
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="#details-section" class="nav-link">
                        <i class="bi bi-clipboard2-data"></i>
                        <span class="nav-link-text">Detailed Data</span>
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="#dashboard-section" class="nav-link">
                        <i class="bi bi-grid-1x2"></i>
                        <span class="nav-link-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="#summary-section" class="nav-link">
                        <i class="bi bi-bar-chart"></i>
                        <span class="nav-link-text">Monthly Summary</span>
                    </a>
                </li>
                <li class="nav-item mb-1">
                    <a href="#attendance-section" class="nav-link">
                        <i class="bi bi-calendar-check"></i>
                        <span class="nav-link-text">Attendance Input</span>
                    </a>
                </li>
            </ul>
            
            <!-- Footer -->
            <div class="mt-auto pt-3 border-top border-2">
                <button id="theme-toggle" class="btn btn-outline-secondary w-100 mb-2 d-flex align-items-center justify-content-center">
                    <i id="theme-icon" class="bi bi-sun-fill me-2"></i>
                    <span id="theme-text" class="nav-link-text fw-medium">Light Mode</span>
                </button>
                <button id="logout-button" class="btn btn-outline-danger w-100 d-flex align-items-center justify-content-center">
                    <i class="bi bi-box-arrow-left me-2"></i>
                    <span class="nav-link-text fw-medium">Logout</span>
                </button>
            </div>
        </div>

        <!-- ======== MAIN CONTENT ======== -->
        <div id="main-content">
            
            <!-- ======== 1. PROFILE SECTION ======== -->
            <section id="profile-section" class="page-section">
                <div class="card shadow-sm border-0 rounded-3">
                    <div class="card-body p-4 p-md-5">
                        <div class="row align-items-center">
                            <!-- Profile Picture -->
                            <div class="col-12 col-md-4 col-lg-3 text-center profile-col-img mb-4 mb-md-0">
                                <img id="profile-pic" src="https://placehold.co/150x150/0d6efd/ffffff?text=PA" alt="Profile Picture" class="img-fluid profile-pic" style="border-radius: 15%;">
                            </div>
                            <!-- Profile Info -->
                            <div class="col-12 col-md-8 col-lg-9 profile-col-info">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div>
                                        <h2 id="name-display" class="card-title mb-1">PrantoAnthony</h2>
                                        <p id="designation-short-display" class="text-primary fs-5 fw-medium">Junior Associate</p>
                                    </div>
                                    <button id="edit-button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#edit-modal">
                                        <i class="bi bi-pencil me-1"></i> Edit
                                    </button>
                                </div>
                                <div class="row g-3">
                                    <div class="col-6 col-lg-4">
                                        <h6 class="text-muted small text-uppercase mb-1">Joining Duration</h6>
                                        <p id="joining-duration-display" class="fw-semibold mb-0">4 Years, 0 Months, 28 Days</p>
                                    </div>
                                    <div class="col-6 col-lg-4">
                                        <h6 class="text-muted small text-uppercase mb-1">LnG ID</h6>
                                        <p id="lng-id-display" class="fw-semibold mb-0">LnG2110R0218</p>
                                    </div>
                                    <div class="col-6 col-lg-4">
                                        <h6 class="text-muted small text-uppercase mb-1">Emp. Type</h6>
                                        <p id="emp-type-display" class="fw-semibold mb-0">Resource pool</p>
                                    </div>
                                    <div class="col-6 col-lg-4">
                                        <h6 class="text-muted small text-uppercase mb-1">Team</h6>
                                        <p id="team-display" class="fw-semibold mb-0">BCBS</p>
                                    </div>
                                    <div class="col-12 col-lg-8">
                                        <h6 class="text-muted small text-uppercase mb-1">Designation (Full)</h6>
                                        <p id="designation-full-display" class="fw-semibold mb-0">Junior Associate</l>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ======== 2. PERFORMANCE SECTION ======== -->
            <section id="performance-section" class="page-section">
                <h2 class="mb-4">Performance (Monthly Data)</h2>
                <div class="row g-4">
                    <!-- Box 1: Total Working Days -->
                    <div class="col-12 col-md-4">
                        <div class="card h-100 gradient-card grad-1 rounded-3">
                            <div class="card-body p-4">
                                <h5 class="card-title fw-semibold text-success-emphasis">Total Working Days</h5>
                                <div id="data-box-working-days" class="fs-1 fw-bold text-success-emphasis my-2">26</div>
                                <p class="card-text text-muted mb-0">* For the selected month (Excl. Sundays)</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Box 2: COLA Eligibility -->
                    <div class="col-12 col-md-4">
                        <div class="card h-100 gradient-card grad-2 rounded-3">
                            <div class="card-body p-4">
                                <h5 class="card-title fw-semibold text-primary-emphasis">COLA Eligibility</h5>
                                <div id="data-box-cola" class="fs-1 fw-bold text-primary-emphasis my-2">0 / 22</div>
                                <!-- Progress Bar -->
                                <div class="progress" role="progressbar" aria-label="COLA progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="height: 10px;">
                                    <div id="cola-progress-bar" class="progress-bar bg-primary" style="width: 0%"></div>
                                </div>
                                <p id="data-box-cola-needed" class="card-text text-muted mb-0 mt-2 small">Need present: 22 days</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Box 3: Category -->
                    <div class="col-12 col-md-4">
                        <div class="card h-100 gradient-card grad-3 rounded-3">
                            <div class="card-body p-4">
                                <h5 class="card-title fw-semibold text-warning-emphasis">Category</h5>
                                <div id="data-box-category" class="fs-1 fw-bold text-warning-emphasis my-2">N/A</div>
                                <p id="data-box-category-desc" class="card-text text-muted mb-0 small">* Based on Total Present %</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ======== 3. DETAILED DATA (SLIDESHOW) ======== -->
            <section id="details-section" class="page-section">
                <h2 class="mb-4">Detailed Data & Rules</h2>
                <div id="slideshow" class="carousel slide carousel-fade rounded-3 overflow-hidden shadow-lg" data-bs-ride="carousel" data-bs-interval="5000">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#slideshow" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                        <button type="button" data-bs-target="#slideshow" data-bs-slide-to="1" aria-label="Slide 2"></button>
                        <button type="button" data-bs-target="#slideshow" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    </div>
                    <div class="carousel-inner">
                        <!-- Slide 1: Total Working Days Details -->
                        <div class="carousel-item active bg-primary">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <div class="slide-content text-center text-white p-4">
                                    <h3 class="mb-3 border-bottom border-light-subtle pb-2">Total Working Days Details</h3>
                                    <div class="fs-5 space-y-2">
                                        <p>Selected Month: <span id="slide-selected-month" class="fw-bolder">November 2025</span></p>
                                        <p>Total Days in Period: <span id="slide-total-days" class="fw-bolder">31</span></p>
                                        <p>Total Sundays: <span id="slide-total-sundays" class="fw-bolder">5</span></p>
                                        <p>Total Holidays: <span id="slide-total-holidays" class="fw-bolder">0</span></p>
                                        <p class="text-warning fw-bolder fs-4">Calculated Working Days: <span id="slide-working-days">26</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Slide 2: COLA Eligibility Details -->
                        <div class="carousel-item bg-success">
                             <div class="d-flex align-items-center justify-content-center h-100">
                                <div class="slide-content text-center text-white p-4">
                                    <h3 class="mb-3 border-bottom border-light-subtle pb-2">COLA Eligibility Details (Rules)</h3>
                                    <div class="fs-5 text-start mx-auto" style="max-width: 400px;">
                                        <p class="fw-bolder text-warning">COLA Rules:</p>
                                        <ul class="list-unstyled">
                                            <li class="mb-2"><i class="bi bi-check-circle-fill me-2"></i>If Working days <strong>26-27</strong>, Need present <strong>22 days</strong>.</li>
                                            <li class="mb-2"><i class="bi bi-check-circle-fill me-2"></i>If working days <strong>24-25</strong>, Need present <strong>21 days</strong>.</li>
                                            <li class="mb-2"><i class="bi bi-check-circle-fill me-2"></i>If working days <strong>&lt; 24</strong>, Need Present <strong>20 days</strong>.</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Slide 3: Employee Category Details -->
                        <div class="carousel-item bg-info">
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <div class="slide-content text-center text-white p-4 w-100">
                                    <h3 class="mb-3 border-bottom border-light-subtle pb-2">Employee Category Details</h3>
                                    <div class="overflow-x-auto">
                                        <table class="table table-dark table-striped table-bordered slide-table m-0">
                                            <thead>
                                                <tr>
                                                    <th>Category</th>
                                                    <th>Treated As</th>
                                                    <th>Eligibility (Present %)</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr><td>A</td><td>Excellent</td><td>90% - 100%</td></tr>
                                                <tr><td>B</td><td>Very Good</td><td>85% - 89%</td></tr>
                                                <tr><td>C</td><td>Good</td><td>80% - 84%</td></tr>
                                                <tr><td>D</td><td>Need Improvement</td><td>75% - 79%</td></tr>
                                                <tr class="table-danger fw-bold"><td>E</td><td>Failure</td><td>Below 74%</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" type="button" data-bs-target="#slideshow" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#slideshow" data-bs-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </section>
            
            <!-- ======== 4. MONTHLY DASHBOARD ======== -->
            <section id="dashboard-section" class="page-section">
                <h2 class="mb-4">Monthly Dashboard</h2>
                <div class="row g-4">
                    <!-- Box 1: Month Selector -->
                    <div class="col-12 col-md-6 col-lg-3">
                        <div class="card h-100 shadow-sm gradient-card grad-1 rounded-3">
                            <div class="card-body p-4 text-center d-flex flex-column justify-content-center">
                                <label for="month-selector" class="form-label fw-semibold text-success-emphasis">Select Month:</label>
                                <select id="month-selector" class="form-select form-select-lg mb-2">
                                    <!-- Options added by JS -->
                                </select>
                                <div class="text-muted small">
                                    <p class="mb-0">From: <span id="date-from" class="fw-bold text-success-emphasis">Oct 26, 2025</span></p>
                                    <p class="mb-0">To: <span id="date-to" class="fw-bold text-success-emphasis">Nov 25, 2025</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Box 2: Total Present % -->
                    <div class="col-12 col-md-6 col-lg-3">
                        <div class="card h-100 shadow-sm gradient-card grad-2 rounded-3">
                            <div class="card-body p-4 text-center d-flex flex-column justify-content-center">
                                <h6 class="card-title fw-semibold text-primary-emphasis">Total Present (vs Duty)</h6>
                                <div id="dashboard-present-percentage" class="display-4 fw-bolder text-primary-emphasis my-2">0%</div>
                                <p class="text-muted small mb-0">Present / (Present + Absent)</p>
                            </div>
                        </div>
                    </div>
                    <!-- Box 3: Total Present Days -->
                    <div class="col-12 col-md-6 col-lg-3">
                        <div class="card h-100 shadow-sm gradient-card grad-3 rounded-3">
                            <div class="card-body p-4 text-center d-flex flex-column justify-content-center">
                                <h6 class="card-title fw-semibold text-warning-emphasis">Total Present Days</h6>
                                <div id="dashboard-total-present" class="display-4 fw-bolder text-warning-emphasis my-2">0</div>
                                <p class="text-muted small mb-0">Total days marked as "Present"</p>

                            </div>
                        </div>
                    </div>
                    <!-- Box 4: Calendar -->
                    <div class="col-12 col-md-6 col-lg-3">
                        <div class="card h-100 shadow-sm rounded-3 calendar-wrapper overflow-hidden">
                            <div class="card-body p-3">
                                <h6 id="calendar-month-display" class="fw-bold text-center mb-2"></h6>
                                <div class="grid-container" id="calendar-grid-header" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;">
                                    <span class="p-1 text-center small fw-bold text-danger">S</span>
                                    <span class="p-1 text-center small fw-bold text-muted">M</span>
                                    <span class="p-1 text-center small fw-bold text-muted">T</span>
                                    <span class="p-1 text-center small fw-bold text-muted">W</span>
                                    <span class="p-1 text-center small fw-bold text-muted">T</span>
                                    <span class="p-1 text-center small fw-bold text-muted">F</span>
                                    <span class="p-1 text-center small fw-bold text-muted">S</span>
                                </div>
                                <div id="calendar-grid" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 2px;">
                                    <!-- Calendar days will be rendered by JS -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- ======== 5. MONTHLY SUMMARY ======== -->
            <section id="summary-section" class="page-section">
                <h2 class="mb-4">Monthly Summary</h2>
                
                <!-- Grid Container -->
                <div class="row g-3 row-cols-2 row-cols-md-3 row-cols-lg-5">
                    <!-- 1. Total Hours -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-1 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-clock-history icon text-primary mb-1"></i>
                                <p class="small text-muted mb-1">Total Hours</p>
                                <p id="summary-total-hours" class="value text-primary mb-0">0</p>
                            </div>
                        </div>
                    </div>
                    <!-- 2. Late -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-2 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-alarm icon text-danger mb-1"></i>
                                <p class="small text-muted mb-1">Late</p>
                                <p id="summary-late" class="value text-danger mb-0">0</p>
                            </div>
                        </div>
                    </div>
                    <!-- 3. Absent -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-3 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-person-x icon text-danger mb-1"></i>
                                <p class="small text-muted mb-1">Absent</p>
                                <p id="summary-absent" class="value text-danger mb-0">0</p>
                            </div>
                        </div>
                    </div>
                    <!-- 4. Weekends -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-4 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-calendar3-week icon text-info mb-1"></i>
                                <p class="small text-muted mb-1">Weekends</p>
                                <p id="summary-weekends" class="value text-info mb-0">0</p>
                            </div>
                        </div>
                    </div>
                    <!-- 5. Holidays -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-1 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-brightness-high icon text-warning mb-1"></i>
                                <p class="small text-muted mb-1">Holidays</p>
                                <p id="summary-holidays" class="value text-warning mb-0">0</p>
                            </div>
                        </div>
                    </div>
                    <!-- 6. Working Days -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-2 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-briefcase icon text-success mb-1"></i>
                                <p class="small text-muted mb-1">Working Days</p>
                                <p id="summary-working-days" class="value text-success mb-0">0</p>
                            </div>
                        </div>
                    </div>
                    <!-- 7. Total Present -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-3 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-person-check icon text-success mb-1"></i>
                                <p class="small text-muted mb-1">Total Present</p>
                                <p id="summary-total-present" class="value text-success mb-0">0</p>
                            </div>
                        </div>
                    </div>
                    <!-- 8. Night Shift -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-4 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-moon-stars icon text-secondary mb-1"></i>
                                <p class="small text-muted mb-1">Night Shift</p>
                                <p id="summary-night-shifts" class="value text-secondary mb-0">0</p>
                            </div>
                        </div>
                    </div>
                    <!-- 9. Day Shifts -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-1 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-sun icon text-warning-emphasis mb-1"></i>
                                <p class="small text-muted mb-1">Day Shifts</p>
                                <p id="summary-day-shifts" class="value text-warning-emphasis mb-0">0</p>
                            </div>
                        </div>
                    </div>
                    <!-- 10. Grace Used -->
                    <div class="col">
                        <div class="card summary-card gradient-card grad-2 rounded-3 h-100">
                            <div class="card-body p-3 text-center d-flex flex-column justify-content-center">
                                <i class="bi bi-shield-check icon text-primary-emphasis mb-1"></i>
                                <p class="small text-muted mb-1">Grace Used</p>
                                <p id="summary-grace-used" class="value text-primary-emphasis mb-0">0</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comments Summary Section -->
                <div id="comments-summary-section" class="mt-4">
                    <h3 class="fw-semibold mb-3">Comments Summary</h3>
                    <div id="comments-summary-list" class="card card-body shadow-sm border-0 rounded-3" style="min-height: 100px; max-height: 250px; overflow-y: auto;">
                        <!-- Comments will be dynamically added here by JS -->
                    </div>
                </div>
            </section>
            
            <!-- ======== 6. DAILY ATTENDANCE INPUT ======== -->
            <section id="attendance-section" class="page-section">
                <div class="container-fluid px-lg-5">
                    <h2 class="mb-4 text-center text-lg-start">
                        Daily Attendance Input
                        <span id="attendance-date-range" class="fs-6 fw-normal text-primary ms-2 d-block d-lg-inline"></span>
                    </h2>
                    
                    <div class="table-responsive-wrapper shadow-sm rounded-3">
                        <table class="table table-hover align-middle attendance-table">
                            <thead class="sticky-top">
                                <tr class="text-nowrap">
                                    <th scope="col" style="width: 10%;">Date</th>
                                    <th scope="col" style="width: 8%;">Day</th>
                                    <th scope="col" style="width: 14%;">Status</th>
                                    <th scope="col" style="width: 8%;">Hour</th>
                                    <th scope="col" style="width: 8%;">Late</th>
                                    <th scope="col" style="width: 12%;">Shift</th>
                                    <th scope="col" style="width: 10%;">Grace</th>
                                    <th scope="col" style="width: 30%;">Comments</th>
                                </tr>
                            </thead>
                            <tbody id="attendance-table-body">
                                <!-- Attendance rows will be generated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- ======== FOOTER ======== -->
            <footer id="main-footer">
                <div class="container-fluid">
                    <div class="row g-4">
                        <!-- Column 1: About -->
                        <div class="col-lg-4 col-md-6 text-center-md">
                            <h5><i class="bi bi-bar-chart-line-fill me-2 text-primary"></i>My Portfolio</h5>
                            <p class="small">
                                Your personal dashboard for tracking monthly performance, attendance, and career milestones.
                            </p>
                            <div class="mt-3 social-links">
                                <a href="https://www.linkedin.com/in/pranto-rodrix-90463615b/" target="blank" title="LinkedIn"><i class="bi bi-linkedin"></i></a>
                                <a href="https://github.com/prantorodrix/Attendance-Tracker" target="blank" title="GitHub"><i class="bi bi-github"></i></a>
                                <a href="https://x.com/pranto83945" target="blank" title="Twitter"><i class="bi bi-twitter-x"></i></a>
                            </div>
                        </div>
                        
                        <!-- Column 2: Quick Links -->
                        <div class="col-lg-2 col-md-6 text-center-md">
                            <h5>Quick Links</h5>
                            <ul class="footer-links">
                                <li><a href="#profile-section">Profile</a></li>
                                <li><a href="#performance-section">Performance</a></li>
                                <li><a href="#dashboard-section">Dashboard</a></li>
                                <li><a href="#attendance-section">Attendance</a></li>
                            </ul>
                        </div>

                        <!-- Column 3: Help & Support -->
                        <div class="col-lg-3 col-md-6 text-center-md">
                            <h5>Help & Support</h5>
                            <ul class="footer-links">
                                <li><a href="#">FAQs</a></li>
                                <li><a href="#">Report an Issue</a></li>
                                <li><a href="#">Documentation</a></li>
                                <li><a href="#">Contact Support</a></li>
                            </ul>
                        </div>
                        
                        <!-- Column 4: Contact Info -->
                        <div class="col-lg-3 col-md-6 text-center-md">
                            <h5>Contact</h5>
                            <ul class="footer-links">
                                <li class="d-flex align-items-center justify-content-center justify-content-md-start">
                                    <i class="bi bi-telephone-fill me-2"></i>
                                    <a href="tel:+8801700000000">+8801318138951</a>
                                </li>
                                <li class="d-flex align-items-center justify-content-center justify-content-md-start">
                                    <i class="bi bi-envelope-fill me-2"></i>
                                    <a href="mailto:prantorodrix@example.com">prantorodrix9@gmail.com</a>
                                </li>
                                <li class="d-flex align-items-center justify-content-center justify-content-md-start">
                                    <i class="bi bi-geo-alt-fill me-2"></i>
                                    <span>Dhaka, Bangladesh</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <hr class="my-4">
                    <div class="text-center small">
                        <p class="mb-0">Made by <span class="fw-semibold text-primary"><a href="https://www.facebook.com/pranto.anthony1/" target="black" title="Facebook">@PrantoRodrix</a></span></p>
                        <p class="mb-0">&copy; <span id="footer-year">2025</span> My Portfolio. All rights reserved.</p>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- ======== PROFILE EDIT MODAL ======== -->
    <div class="modal fade zoom" id="edit-modal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <form id="profile-edit-form">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editModalLabel">Edit Profile</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row g-3">
                            <div class="col-12">
                                <label for="input-photo" class="form-label">Update Profile Photo</label>
                                <input type="file" id="input-photo" class="form-control" accept="image/*">
                            </div>
                            <div class="col-12 col-md-6">
                                <label for="input-name" class="form-label">Name</label>
                                <input type="text" id="input-name" class="form-control">
                            </div>
                            <div class="col-12 col-md-6">
                                <label for="input-designation-short" class="form-label">Designation (Short)</label>
                                <input type="text" id="input-designation-short" class="form-control">
                            </div>
                            <div class="col-12 col-md-6">
                                <label for="input-lng-id" class="form-label">LnG ID</label>
                                <input type="text" id="input-lng-id" class="form-control">
                            </div>
                            <div class="col-12 col-md-6">
                                <label for="input-team" class="form-label">Team</label>
                                <input type="text" id="input-team" class="form-control">
                            </div>
                            <!-- Joining Date Input -->
                            <div class="col-12 col-md-6">
                                <label for="input-joining-date" class="form-label">Joining Date</label>
                                <input type="date" id="input-joining-date" class="form-control">
                                <small id="joining-duration-preview" class="form-text text-muted mt-1 d-block"></small>
                            </div>
                            <div class="col-12">
                                <label for="input-designation-full" class="form-label">Designation (Full)</label>
                                <input type="text" id="input-designation-full" class="form-control">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="modal-cancel" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <script>
        // --- GLOBAL APP STATE ---
        let appState = {
            currentUser: null,
            profile: {
                name: 'PrantoAnthony',
                designationShort: 'Junior Associate',
                joiningDate: '2021-10-03', 
                lngId: 'LnG2110R0218',
                empType: 'Resource pool',
                team: 'BCBS',
                designationFull: 'Junior Associate',
                photoSrc: null
            },
            attendanceData: []
        };

        let currentPeriodInfo = {
            workingDays: 0,
            colaNeeded: 20
        };
        
        const monthNames = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        const daysInEnglish = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        const statusCycle = ['-', 'Present', 'Absent', 'Weekend', 'Holiday'];
        
        // --- DOM Elements ---
        const htmlEl = document.documentElement;
        const loginPage = document.getElementById('login-page');
        const dashboardPage = document.getElementById('dashboard-page');
        const loginForm = document.getElementById('login-form');
        const loginAlert = document.getElementById('login-alert');
        const emailInput = document.getElementById('email-input');
        const passwordInput = document.getElementById('password-input');
        const logoutButton = document.getElementById('logout-button');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');
        const sidebarToggleButton = document.getElementById('sidebar-toggle-button');
        const navLinks = document.querySelectorAll('#sidebar .nav-link');
        const pageSections = document.querySelectorAll('.page-section');
        const themeToggle = document.getElementById('theme-toggle');
        const themeIcon = document.getElementById('theme-icon');
        const themeText = document.getElementById('theme-text');
        const monthSelector = document.getElementById('month-selector');
        const editForm = document.getElementById('profile-edit-form');
        const editModal = new bootstrap.Modal(document.getElementById('edit-modal'));
        const photoInput = document.getElementById('input-photo');
        const profilePic = document.getElementById('profile-pic');
        const joiningDateInput = document.getElementById('input-joining-date');
        const joiningDurationPreview = document.getElementById('joining-duration-preview');

        // --- DATA PERSISTENCE (LocalStorage per User) ---
        function loadData() {
            const savedData = localStorage.getItem(appState.currentUser);
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                appState.profile = { ...appState.profile, ...parsedData.profile };
                appState.attendanceData = parsedData.attendanceData || [];
            } else {
                appState.profile = {
                    name: 'PrantoAnthony',
                    designationShort: 'Junior Associate',
                    joiningDate: '2021-10-03',
                    lngId: 'LnG2110R0218',
                    empType: 'Resource pool',
                    team: 'BCBS',
                    designationFull: 'Junior Associate',
                    photoSrc: null
                };
                appState.attendanceData = [];
            }
            updateProfileUI();
        }

        function saveData() {
            if (!appState.currentUser) return;
            const dataToSave = {
                profile: appState.profile,
                attendanceData: appState.attendanceData
            };
            localStorage.setItem(appState.currentUser, JSON.stringify(dataToSave));
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('footer-year').textContent = new Date().getFullYear();

            const loggedInUser = sessionStorage.getItem('currentUser');
            if (loggedInUser) {
                appState.currentUser = loggedInUser;
                showDashboard();
                initializeApp();
            } else {
                showLogin();
            }

            setupEventListeners();
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
        });

        function initializeApp() {
            loadData();
            populateMonthSelector();
            const currentMonthValue = monthSelector.value;
            updateDateRange(currentMonthValue);
            setupScrollObserver(); // Activate scroll spying
        }

        // --- PAGE/VIEW MANAGEMENT ---
        function showLogin() {
            loginPage.style.display = 'flex';
            dashboardPage.style.display = 'none';
        }

        function showDashboard() {
            loginPage.style.display = 'none';
            dashboardPage.style.display = 'flex';
        }

        // --- EVENT LISTENERS ---
        function setupEventListeners() {
            // Login
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = emailInput.value;
                const password = passwordInput.value;
                
                if (email.endsWith('@leverngear.com') && password === 'pranto') {
                    appState.currentUser = email;
                    sessionStorage.setItem('currentUser', email);
                    loginAlert.classList.add('d-none');
                    showDashboard();
                    initializeApp();
                } else {
                    loginAlert.classList.remove('d-none');
                }
            });

            // Logout
            logoutButton.addEventListener('click', () => {
                appState.currentUser = null;
                sessionStorage.removeItem('currentUser');
                emailInput.value = '';
                passwordInput.value = '';
                showLogin();
            });

            // Sidebar Toggle
            sidebarToggleButton.addEventListener('click', () => {
                sidebar.classList.toggle('minimized');
                mainContent.classList.toggle('sidebar-minimized');
            });

            // Sidebar Navigation (Smooth Scroll)
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // --- FIX for Active State Bug ---
                    // 1. Immediately update active class on click
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 2. Perform smooth scroll
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Theme Toggle
            themeToggle.addEventListener('click', () => {
                const newTheme = htmlEl.getAttribute('data-bs-theme') === 'dark' ? 'light' : 'dark';
                setTheme(newTheme);
            });

            // Month Selector
            monthSelector.addEventListener('change', (e) => {
                updateDateRange(e.target.value);
            });

            // Profile Photo Upload
            photoInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (event) => {
                    const dataUrl = event.target.result;
                    profilePic.src = dataUrl;
                    appState.profile.photoSrc = dataUrl;
                };
                reader.readAsDataURL(file);
            });

            // Profile Edit Form Submit
            editForm.addEventListener('submit', (e) => {
                e.preventDefault();
                appState.profile.name = document.getElementById('input-name').value.trim();
                appState.profile.designationShort = document.getElementById('input-designation-short').value.trim();
                appState.profile.lngId = document.getElementById('input-lng-id').value.trim();
                appState.profile.team = document.getElementById('input-team').value.trim();
                appState.profile.designationFull = document.getElementById('input-designation-full').value.trim();
                appState.profile.joiningDate = joiningDateInput.value;
                
                updateProfileUI();
                saveData();
                editModal.hide();
            });
            
            // Populate modal on show
            document.getElementById('edit-modal').addEventListener('show.bs.modal', () => {
                document.getElementById('input-name').value = appState.profile.name;
                document.getElementById('input-designation-short').value = appState.profile.designationShort;
                document.getElementById('input-lng-id').value = appState.profile.lngId;
                document.getElementById('input-team').value = appState.profile.team;
                document.getElementById('input-designation-full').value = appState.profile.designationFull;
                joiningDateInput.value = appState.profile.joiningDate;
                
                const duration = calculateJoiningDuration(appState.profile.joiningDate);
                joiningDurationPreview.textContent = duration.full;
                
                photoInput.value = null; 
            });

            // Listener for date input change
            joiningDateInput.addEventListener('input', (e) => {
                const duration = calculateJoiningDuration(e.target.value);
                joiningDurationPreview.textContent = duration.full;
            });
        }

        // --- Intersection Observer for Scroll Spying ---
        function setupScrollObserver() {
            const observerOptions = {
                root: null,
                rootMargin: '-10% 0px -85% 0px', // Activate when section is 10% from top
                threshold: 0
            };

            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const id = entry.target.id;
                        // This check prevents the observer from overriding the
                        // "click" handler's immediate "active" class setting
                        if (document.activeElement.tagName !== 'A') {
                            navLinks.forEach(link => {
                                link.classList.remove('active');
                                if (link.getAttribute('href') === `#${id}`) {
                                    link.classList.add('active');
                                }
                            });
                        }
                    }
                });
            }, observerOptions);

            pageSections.forEach(section => {
                observer.observe(section);
            });
        }

        // --- THEME ---
        function setTheme(theme) {
            htmlEl.setAttribute('data-bs-theme', theme);
            localStorage.setItem('theme', theme);
            if (theme === 'dark') {
                themeIcon.classList.remove('bi-sun-fill');
                themeIcon.classList.add('bi-moon-fill');
                themeText.textContent = 'Dark Mode';
            } else {
                themeIcon.classList.remove('bi-moon-fill');
                themeIcon.classList.add('bi-sun-fill');
                themeText.textContent = 'Light Mode';
            }
        }

        // --- Joining Date Calculation ---
        function calculateJoiningDuration(joiningDateString) {
            if (!joiningDateString) {
                return { full: 'Please select a date.', days: 0 };
            }

            try {
                const joiningDate = new Date(joiningDateString);
                const today = new Date();
                joiningDate.setUTCHours(12, 0, 0, 0);
                today.setUTCHours(12, 0, 0, 0);

                if (joiningDate > today) {
                    return { full: 'Joining date cannot be in the future.', days: 0 };
                }

                let years = today.getUTCFullYear() - joiningDate.getUTCFullYear();
                let months = today.getUTCMonth() - joiningDate.getUTCMonth();
                let days = today.getUTCDate() - joiningDate.getUTCDate();

                if (days < 0) {
                    months--;
                    const prevMonth = new Date(today.getUTCFullYear(), today.getUTCMonth(), 0);
                    days += prevMonth.getUTCDate();
                }

                if (months < 0) {
                    years--;
                    months += 12;
                }

                const totalDays = Math.floor((today - joiningDate) / (1000 * 60 * 60 * 24));
                
                const yearStr = years > 0 ? `${years} ${years > 1 ? 'Years' : 'Year'}` : '';
                const monthStr = months > 0 ? `${months} ${months > 1 ? 'Months' : 'Month'}` : '';
                const dayStr = days > 0 ? `${days} ${days > 1 ? 'Days' : 'Day'}` : '';
                
                const parts = [yearStr, monthStr, dayStr].filter(Boolean);
                let fullString = parts.join(', ');

                if (parts.length === 0) {
                    fullString = (totalDays === 0) ? 'Joined today' : `${totalDays} ${totalDays > 1 ? 'Days' : 'Day'}`;
                }
                
                return { full: fullString, days: totalDays };

            } catch (error) {
                return { full: 'Invalid date format.', days: 0 };
            }
        }

        // --- UI UPDATERS ---
        function updateProfileUI() {
            document.getElementById('name-display').textContent = appState.profile.name;
            document.getElementById('designation-short-display').textContent = appState.profile.designationShort;
            
            const duration = calculateJoiningDuration(appState.profile.joiningDate);
            document.getElementById('joining-duration-display').textContent = duration.full;

            document.getElementById('lng-id-display').textContent = appState.profile.lngId;
            document.getElementById('emp-type-display').textContent = appState.profile.empType;
            document.getElementById('team-display').textContent = appState.profile.team;
            document.getElementById('designation-full-display').textContent = appState.profile.designationFull;

            if (appState.profile.photoSrc) {
                profilePic.src = appState.profile.photoSrc;
            } else {
                const initials = appState.profile.name.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                profilePic.src = `https://placehold.co/150x150/0d6efd/ffffff?text=${initials || 'PA'}`;
            }
        }

        function populateMonthSelector() {
            monthSelector.innerHTML = '';
            const now = new Date();
            for (let i = -6; i <= 6; i++) {
                const date = new Date(now.getFullYear(), now.getMonth() + i, 1);
                const monthName = monthNames[date.getMonth()];
                const year = date.getFullYear();
                
                const option = document.createElement('option');
                option.value = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                option.textContent = `${monthName} ${year}`;
                if (i === 0) option.selected = true;
                monthSelector.appendChild(option);
            }
        }

        // --- CORE LOGIC & RENDERING ---
        function updateDateRange(selectedMonthYear) {
            const [year, month] = selectedMonthYear.split('-').map(Number);
            
            const fromDate = new Date(year, month - 2, 26);
            const toDate = new Date(year, month - 1, 25);
            
            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            const fromDateStr = fromDate.toLocaleDateString('en-US', options);
            const toDateStr = toDate.toLocaleDateString('en-US', options);

            document.getElementById('date-from').textContent = fromDateStr;
            document.getElementById('date-to').textContent = toDateStr;
            document.getElementById('attendance-date-range').textContent = `(${fromDateStr} - ${toDateStr})`;

            generateAttendanceData(fromDate, toDate);
            renderAttendanceTable();
            runAllCalculations();
            renderCalendar(year, month);
        }

        function generateAttendanceData(fromDate, toDate) {
            let currentDate = new Date(fromDate);
            let calculatedWorkingDays = 0;
            let totalSundays = 0;
            let totalDaysInPeriod = 0;
            let newAttendanceData = [];
            let rowId = 0;

            const dateOptions = { month: 'short', day: 'numeric' };

            while (currentDate <= toDate) {
                const dayName = daysInEnglish[currentDate.getDay()];
                const dateString = currentDate.toLocaleDateString('en-US', dateOptions).replace(',', '');
                const isoDate = currentDate.toISOString().split('T')[0];
                const isWeekend = currentDate.getDay() === 0;

                const existingData = appState.attendanceData.find(d => d.isoDate === isoDate);

                let rowData;
                if (existingData) {
                    rowData = { ...existingData, id: rowId };
                } else {
                    rowData = {
                        id: rowId,
                        isoDate: isoDate,
                        dateString: dateString,
                        dayName: dayName,
                        status: '-', 
                        hour: '-',
                        late: '-',
                        shift: 'Day',
                        grace: '-',
                        comments: '',
                        isWeekend: isWeekend
                    };
                }
                newAttendanceData.push(rowData);
                
                totalDaysInPeriod++;
                if (isWeekend) totalSundays++;
                else calculatedWorkingDays++;

                currentDate.setDate(currentDate.getDate() + 1);
                rowId++;
            }
            
            appState.attendanceData = newAttendanceData;
            
            let colaNeeded = 20;
            if (calculatedWorkingDays >= 26) colaNeeded = 22;
            else if (calculatedWorkingDays >= 24) colaNeeded = 21;
            
            currentPeriodInfo = {
                workingDays: calculatedWorkingDays,
                colaNeeded: colaNeeded,
                totalDays: totalDaysInPeriod,
                totalSundays: totalSundays,
                totalHolidays: 0
            };
            
            saveData();
        }

        // Renders the attendance table
        function renderAttendanceTable() {
            const tableBody = document.getElementById('attendance-table-body');
            tableBody.innerHTML = '';
            
            appState.attendanceData.forEach(row => {
                const tr = document.createElement('tr');
                tr.id = `row-card-${row.id}`;
                
                // --- FIX for Row Backgrounds ---
                const statusClass = row.status === '-' ? '--' : row.status.toLowerCase();
                tr.className = `status-${statusClass}-bg`;
                
                const weekendClass = row.isWeekend ? 'text-danger' : '';
                
                tr.innerHTML = `
                    <td class="fw-medium ${weekendClass}">${row.dateString}</td>
                    <td class="${weekendClass}">${row.dayName}</td>
                    <td>
                        <button id="status-${row.id}" class="btn w-100 btn-sm status-${row.status.toLowerCase()}" onclick="cycleStatus(${row.id})">
                            ${row.status}
                        </button>
                    </td>
                    <td>
                        <input type="text" id="hour-${row.id}" class="form-control form-control-sm text-center" value="${row.hour}" disabled>
                    </td>
                    <td>
                        <!-- FIX: Changed step to "1" for whole numbers -->
                        <input type="number" step="1" id="late-${row.id}" class="form-control form-control-sm text-center" value="${row.late}" oninput="updateHourFromLate(${row.id})">
                    </td>
                    <td>
                        <button id="shift-${row.id}" class="btn btn-outline-secondary btn-sm w-100" onclick="toggleShift(${row.id})">
                            ${row.shift}
                        </button>
                    </td>
                    <td>
                        <button id="grace-${row.id}" class="btn btn-outline-secondary btn-sm w-100" onclick="toggleGrace(${row.id})">
                            ${row.grace}
                        </button>
                    </td>
                    <td>
                        <input type="text" id="comments-${row.id}" class="form-control form-control-sm" value="${row.comments}" oninput="updateData(${row.id}, 'comments', this.value)">
                    </td>
                `;
                tableBody.appendChild(tr);
                
                updateRowState(row.id, row.status, false);
            });
        }
        
        // --- DATA HANDLERS (CALLED FROM UI) ---

        function cycleStatus(rowId) {
            const rowData = appState.attendanceData.find(d => d.id === rowId);
            if (!rowData) return;

            const currentIndex = statusCycle.indexOf(rowData.status);
            const nextIndex = (currentIndex + 1) % statusCycle.length;
            const nextStatus = statusCycle[nextIndex];
            
            rowData.status = nextStatus;

            const statusBtn = document.getElementById(`status-${rowId}`);
            statusBtn.textContent = nextStatus;
            statusBtn.className = `btn w-100 btn-sm status-${nextStatus.toLowerCase()}`;
            
            // --- FIX for Row Backgrounds ---
            const tr = document.getElementById(`row-card-${rowId}`);
            const nextStatusClass = nextStatus === '-' ? '--' : nextStatus.toLowerCase();
            tr.className = `status-${nextStatusClass}-bg`;

            updateRowState(rowId, nextStatus, true);
            runAllCalculations();
            saveData();
        }
        window.cycleStatus = cycleStatus;

        function toggleShift(rowId) {
            const rowData = appState.attendanceData.find(d => d.id === rowId);
            if (!rowData) return;
            
            rowData.shift = (rowData.shift === 'Day') ? 'Night' : 'Day';
            document.getElementById(`shift-${rowId}`).textContent = rowData.shift;
            
            runAllCalculations();
            saveData();
        }
        window.toggleShift = toggleShift; 

        function toggleGrace(rowId) {
            const rowData = appState.attendanceData.find(d => d.id === rowId);
            if (!rowData) return;
            
            rowData.grace = (rowData.grace === '-') ? 'Yes' : '-';
            document.getElementById(`grace-${rowId}`).textContent = rowData.grace;
            
            runAllCalculations();
            saveData();
        }
        window.toggleGrace = toggleGrace;

        function updateData(rowId, key, value) {
            const rowData = appState.attendanceData.find(d => d.id === rowId);
            if (!rowData) return;
            
            rowData[key] = value;
            runAllCalculations();
            saveData();
        }
        window.updateData = updateData;

        function updateHourFromLate(rowId) {
            const rowData = appState.attendanceData.find(d => d.id === rowId);
            if (!rowData) return;
            
            const lateInput = document.getElementById(`late-${rowId}`);
            const hourInput = document.getElementById(`hour-${rowId}`);
            const baseHour = 9;
            
            // --- FIX: Changed to parseInt for whole numbers ---
            let lateValue = parseInt(lateInput.value) || 0;
            let newHour;

            if (lateValue > baseHour) lateValue = baseHour;
            if (lateValue < 0) lateValue = 0;
            
            newHour = (baseHour - lateValue);
            
            lateInput.value = lateValue; // Show the sanitized whole number
            // --- FIX: Show whole number for hour ---
            hourInput.value = newHour.toFixed(0);
            
            rowData.late = lateValue;
            rowData.hour = newHour;
            
            runAllCalculations();
            saveData();
        }
        window.updateHourFromLate = updateHourFromLate; 
        
        // --- STATE/CALCULATION LOGIC ---

        function updateRowState(rowId, status, resetData) {
            const inputs = [
                document.getElementById(`late-${rowId}`),
                document.getElementById(`shift-${rowId}`),
                document.getElementById(`grace-${rowId}`),
                document.getElementById(`comments-${rowId}`)
            ];
            const hourInput = document.getElementById(`hour-${rowId}`);
            const rowData = appState.attendanceData.find(d => d.id === rowId);
            if (!rowData) return;

            const isDisabled = (status !== 'Present');
            inputs.forEach(el => { if (el) el.disabled = isDisabled; });
            
            if (resetData) {
                if (status === 'Present') {
                    rowData.hour = 9;
                    rowData.late = 0;
                    rowData.shift = 'Day';
                    rowData.grace = '-';
                    rowData.comments = '';
                } else {
                    const defaultValue = (status === '-') ? '-' : 0;
                    rowData.hour = defaultValue;
                    rowData.late = defaultValue;
                    rowData.shift = 'Day';
                    rowData.grace = '-';
                    rowData.comments = '';
                }
            }

            if(hourInput) hourInput.value = (rowData.hour === 9 || rowData.hour === 0) ? rowData.hour.toFixed(0) : rowData.hour;
            if(inputs[0]) inputs[0].value = rowData.late;
            if(inputs[1]) inputs[1].textContent = rowData.shift;
            if(inputs[2]) inputs[2].textContent = rowData.grace;
            if(inputs[3]) inputs[3].value = rowData.comments;
        }

        function runAllCalculations() {
            let totalHours = 0, totalLate = 0, totalAbsent = 0, totalWeekends = 0,
                totalHolidays = 0, totalPresent = 0, totalNightShifts = 0,
                totalDayShifts = 0, totalGrace = 0;

            for (const row of appState.attendanceData) {
                if (row.status === 'Present') {
                    totalPresent++;
                    totalHours += parseFloat(row.hour) || 0;
                    totalLate += parseInt(row.late) || 0; // --- FIX: Use parseInt ---
                    if (row.shift === 'Day') totalDayShifts++;
                    if (row.shift === 'Night') totalNightShifts++;
                    if (row.grace === 'Yes') totalGrace++;
                }
                else if (row.status === 'Absent') totalAbsent++;
                else if (row.status === 'Weekend') totalWeekends++;
                else if (row.status === 'Holiday') totalHolidays++;
            }
            
            const totalWorkingDays = totalPresent + totalAbsent;
            const totalDaysInPeriod = currentPeriodInfo.workingDays;
            const colaNeeded = currentPeriodInfo.colaNeeded;

            // 1. Performance Boxes
            document.getElementById('data-box-working-days').textContent = totalDaysInPeriod;
            document.getElementById('data-box-cola').textContent = `${totalPresent} / ${colaNeeded}`;
            document.getElementById('data-box-cola-needed').textContent = `Need present: ${colaNeeded} days`;
            const colaPerc = (colaNeeded === 0) ? 0 : (totalPresent / colaNeeded) * 100;
            document.getElementById('cola-progress-bar').style.width = `${Math.min(colaPerc, 100)}%`;
            
            const presentPercentage = (totalDaysInPeriod === 0) ? 0 : (totalPresent / totalDaysInPeriod) * 100;
            let category = 'N/A';
            let categoryDesc = 'No data';
            if (totalDaysInPeriod > 0) {
                if (presentPercentage >= 90) { category = 'A'; categoryDesc = 'Excellent Performance'; }
                else if (presentPercentage >= 85) { category = 'B'; categoryDesc = 'Very Good Performance'; }
                else if (presentPercentage >= 80) { category = 'C'; categoryDesc = 'Good Performance'; }
                else if (presentPercentage >= 75) { category = 'D'; categoryDesc = 'Needs Improvement'; }
                else { category = 'E'; categoryDesc = 'Failure'; }
            }
            document.getElementById('data-box-category').textContent = category;
            document.getElementById('data-box-category-desc').textContent = `(${presentPercentage.toFixed(0)}%) ${categoryDesc}`;

            // 2. Slideshow
            const monthName = monthNames[new Date(monthSelector.value + '-02').getMonth()];
            document.getElementById('slide-selected-month').textContent = `${monthName} ${monthSelector.value.split('-')[0]}`;
            document.getElementById('slide-total-days').textContent = currentPeriodInfo.totalDays;
            document.getElementById('slide-total-sundays').textContent = currentPeriodInfo.totalSundays;
            document.getElementById('slide-total-holidays').textContent = totalHolidays;
            document.getElementById('slide-working-days').textContent = currentPeriodInfo.workingDays;
            
            // 3. Dashboard Boxes
            const dutyDays = totalPresent + totalAbsent;
            const dashboardPresentPerc = (dutyDays === 0) ? 0 : (totalPresent / dutyDays) * 100;
            document.getElementById('dashboard-present-percentage').textContent = `${dashboardPresentPerc.toFixed(0)}%`;
            document.getElementById('dashboard-total-present').textContent = totalPresent;

            // 4. Monthly Summary
            document.getElementById('summary-total-hours').textContent = totalHours.toFixed(1); // Keep hours as decimal
            document.getElementById('summary-late').textContent = totalLate.toFixed(0); // --- FIX: Show whole number ---
            document.getElementById('summary-absent').textContent = totalAbsent;
            document.getElementById('summary-weekends').textContent = totalWeekends;
            document.getElementById('summary-holidays').textContent = totalHolidays;
            document.getElementById('summary-working-days').textContent = totalWorkingDays;
            document.getElementById('summary-total-present').textContent = totalPresent;
            document.getElementById('summary-night-shifts').textContent = totalNightShifts;
            document.getElementById('summary-day-shifts').textContent = totalDayShifts;
            document.getElementById('summary-grace-used').textContent = totalGrace;

            // 5. Comments
            updateCommentsSummary();
            
            // 6. Calendar
            const [year, month] = monthSelector.value.split('-').map(Number);
            renderCalendar(year, month);
        }

        function updateCommentsSummary() {
            const listDiv = document.getElementById('comments-summary-list');
            listDiv.innerHTML = '';
            let hasComments = false;

            for (const row of appState.attendanceData) {
                if (row.comments && row.comments.trim() !== '') {
                    hasComments = true;
                    const p = document.createElement('p');
                    p.className = 'mb-2 border-bottom pb-2';
                    
                    let presentInfo = '';
                    if (row.status === 'Present') presentInfo = `Present: ${row.hour} hrs (${row.shift}), `;
                    else if (row.status !== '-') presentInfo = `Status: ${row.status}, `;

                    p.innerHTML = `<strong class="text-primary">${row.dateString} (${row.dayName}):</strong> ${presentInfo}${row.comments}`;
                    listDiv.appendChild(p);
                }
            }

            if (!hasComments) {
                listDiv.innerHTML = '<p class="text-muted text-center italic mb-0">No comments added yet...</p>';
            }
        }

        function renderCalendar(year, month) {
            const calendarGrid = document.getElementById('calendar-grid');
            const monthDisplay = document.getElementById('calendar-month-display');
            calendarGrid.innerHTML = '';

            const firstDayOfMonth = new Date(year, month - 1, 1);
            const daysInMonth = new Date(year, month, 0).getDate();
            const startDayOfWeek = firstDayOfMonth.getDay();

            monthDisplay.textContent = firstDayOfMonth.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

            for (let i = 0; i < startDayOfWeek; i++) {
                calendarGrid.innerHTML += `<span class="calendar-day-item p-1 rounded"></span>`;
            }

            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month - 1, day);
                const isoDate = date.toISOString().split('T')[0];
                
                const rowData = appState.attendanceData.find(d => d.isoDate === isoDate);
                
                let dayClasses = 'calendar-day-item p-1 rounded d-flex align-items-center justify-content-center';
                
                if (isoDate === todayStr) {
                    dayClasses += ' today';
                }

                if (rowData) {
                    const statusClass = rowData.status === '-' ? '--' : rowData.status.toLowerCase();
                    dayClasses += ` status-${statusClass}-bg has-data`;
                } else {
                    dayClasses += ' bg-body-tertiary opacity-50';
                }
                
                calendarGrid.innerHTML += `<span class="${dayClasses}">${day}</span>`;
            }
        }

    </script>
</body>
</html>

